"use strict";exports.id=835,exports.ids=[835],exports.modules={7835:(e,t,l)=>{l.r(t),l.d(t,{default:()=>eK});var s,a,r=l(997),n=l(6689),i=l.n(n);let o=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),d=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,l)=>l?l.toUpperCase():t.toLowerCase()),c=e=>{let t=d(e);return t.charAt(0).toUpperCase()+t.slice(1)},x=(...e)=>e.filter((e,t,l)=>!!e&&""!==e.trim()&&l.indexOf(e)===t).join(" ").trim(),u=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var m={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let h=(0,n.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:l=2,absoluteStrokeWidth:s,className:a="",children:r,iconNode:i,...o},d)=>(0,n.createElement)("svg",{ref:d,...m,width:t,height:t,stroke:e,strokeWidth:s?24*Number(l)/Number(t):l,className:x("lucide",a),...!r&&!u(o)&&{"aria-hidden":"true"},...o},[...i.map(([e,t])=>(0,n.createElement)(e,t)),...Array.isArray(r)?r:[r]])),b=(e,t)=>{let l=(0,n.forwardRef)(({className:l,...s},a)=>(0,n.createElement)(h,{ref:a,iconNode:t,className:x(`lucide-${o(c(e))}`,`lucide-${e}`,l),...s}));return l.displayName=c(e),l},p=b("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),f=b("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]),g=b("map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]),w=b("book-image",[["path",{d:"m20 13.7-2.1-2.1a2 2 0 0 0-2.8 0L9.7 17",key:"q6ojf0"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["circle",{cx:"10",cy:"8",r:"2",key:"2qkj4p"}]]),j=b("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),y=b("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]]),v=window.AudioContext||window.webkitAudioContext,k=null,N=()=>(k||(k=new v),"suspended"===k.state&&k.resume(),k),C=()=>{try{let e=N(),t=e.currentTime,l=e.createOscillator(),s=e.createGain();l.connect(s),s.connect(e.destination),l.type="sine",l.frequency.setValueAtTime(400,t),l.frequency.exponentialRampToValueAtTime(600,t+.05),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.05),l.start(t),l.stop(t+.05)}catch(e){}},S=()=>C(),A=()=>{try{let e=N(),t=e.currentTime,l=e.createOscillator(),s=e.createGain();l.connect(s),s.connect(e.destination),l.type="sine",l.frequency.setValueAtTime(300,t),l.frequency.linearRampToValueAtTime(500,t+.08),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.08),l.start(t),l.stop(t+.08)}catch(e){}},z=()=>{try{let e=N(),t=e.currentTime,l=e.createOscillator(),s=e.createGain();l.connect(s),s.connect(e.destination),l.type="sine",l.frequency.setValueAtTime(660,t),s.gain.setValueAtTime(.03,t),s.gain.exponentialRampToValueAtTime(.001,t+.6),l.start(t),l.stop(t+.6)}catch(e){}},M=()=>{try{let e=N(),t=e.currentTime,l=e.createGain();l.connect(e.destination),l.gain.setValueAtTime(.02,t),l.gain.linearRampToValueAtTime(0,t+.5),[523.25,659.25,783.99].forEach((s,a)=>{let r=e.createOscillator();r.connect(l),r.type="sine",r.frequency.value=s,r.start(t+.05*a),r.stop(t+.5)})}catch(e){}},T=()=>{try{let e=N(),t=e.currentTime,l=e.createOscillator(),s=e.createGain();l.connect(s),s.connect(e.destination),l.type="sine",l.frequency.setValueAtTime(250,t),l.frequency.linearRampToValueAtTime(100,t+.1),s.gain.setValueAtTime(.08,t),s.gain.linearRampToValueAtTime(.001,t+.1),l.start(t),l.stop(t+.1)}catch(e){}},R=()=>{try{let e=N(),t=e.currentTime,l=(l,s)=>{let a=e.createOscillator(),r=e.createGain();a.connect(r),r.connect(e.destination),a.type="sine",a.frequency.value=l,r.gain.setValueAtTime(.05,t+s),r.gain.exponentialRampToValueAtTime(.001,t+s+.4),a.start(t+s),a.stop(t+s+.4)};l(523.25,0),l(659.25,.1),l(783.99,.2),l(1046.5,.3)}catch(e){}},E=()=>{try{let e=N(),t=e.currentTime,l=e.createOscillator(),s=e.createGain();l.connect(s),s.connect(e.destination),l.type="sine",l.frequency.setValueAtTime(150,t),l.frequency.linearRampToValueAtTime(100,t+.1),s.gain.setValueAtTime(.1,t),s.gain.linearRampToValueAtTime(.001,t+.1),l.start(t),l.stop(t+.1)}catch(e){}},D=()=>R(),_=()=>{try{let e=N(),t=e.currentTime,l=e.createOscillator(),s=e.createGain();l.connect(s),s.connect(e.destination),l.type="sine",l.frequency.setValueAtTime(200,t),l.frequency.linearRampToValueAtTime(400,t+.1),s.gain.setValueAtTime(.02,t),s.gain.exponentialRampToValueAtTime(.001,t+.1),l.start(t),l.stop(t+.1)}catch(e){}},O=({children:e,onHome:t,onCalendar:l,onPassport:s,onMemory:a,onVocab:n,onBack:i,isProfileSetup:o,variant:d="standard"})=>{let c="immersive"===d;return r.jsx("div",{className:"h-[100dvh] w-full bg-slate-50 flex items-center justify-center font-sans text-slate-800 md:p-4 lg:p-6 overflow-hidden",children:(0,r.jsxs)("div",{className:"w-full h-full md:max-w-[1000px] md:h-[92dvh] bg-white md:rounded-[2rem] shadow-2xl overflow-hidden relative flex flex-col md:border-[6px] md:border-white ring-1 ring-slate-200 transition-all duration-300",children:[!c&&r.jsx("div",{className:"bg-white/95 backdrop-blur-md border-b border-slate-100 flex items-center justify-between px-3 md:px-6 shrink-0 z-40 relative pt-[env(safe-area-inset-top)] pb-1 md:pb-0 min-h-[calc(3rem+env(safe-area-inset-top))] md:min-h-0 md:h-16 box-border transition-transform",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 h-10 md:h-full w-full",children:[i&&r.jsx("button",{onClick:()=>{C(),i()},className:"p-1.5 -ml-1 mr-1 rounded-full text-slate-400 hover:bg-slate-100 hover:text-brand-blue transition-colors active:scale-95",children:r.jsx(p,{size:24,strokeWidth:3})}),(0,r.jsxs)("div",{className:"flex items-center gap-2 group cursor-pointer flex-1",onClick:()=>{C(),t()},children:[r.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 bg-white rounded-full overflow-hidden shadow-sm border border-slate-200 shrink-0",children:r.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/3069/3069172.png",alt:"SnapStory Panda",className:"w-full h-full object-cover"})}),r.jsx("div",{className:"flex flex-col justify-center",children:r.jsx("h1",{className:"text-base md:text-xl font-black tracking-tight text-brand-blue leading-none",children:"SnapStory"})})]}),r.jsx("div",{className:"hidden md:block ml-auto text-xs font-bold text-slate-300 uppercase tracking-widest",children:"Adventure Awaits"})]})}),r.jsx("div",{className:"flex-1 relative w-full flex flex-col min-h-0 bg-slate-50/50 overflow-hidden",children:e}),!o&&!c&&(0,r.jsxs)("div",{className:"bg-white border-t border-slate-100 px-1 py-1 shrink-0 z-50 flex justify-around items-center md:justify-center md:gap-12 shadow-[0_-4px_20px_rgba(0,0,0,0.03)] pb-[calc(0.25rem+env(safe-area-inset-bottom))] md:pb-2 relative",children:[r.jsx(L,{onClick:()=>{C(),t()},icon:r.jsx(f,{size:22,strokeWidth:2.5}),label:"Home",activeColor:"text-brand-blue"}),r.jsx(L,{onClick:()=>{C(),s()},icon:r.jsx(g,{size:22,strokeWidth:2.5}),label:"Passport",activeColor:"text-brand-green"}),r.jsx(L,{onClick:()=>{C(),n()},icon:r.jsx(w,{size:22,strokeWidth:2.5}),label:"Words",activeColor:"text-pink-500"}),r.jsx(L,{onClick:()=>{C(),l()},icon:r.jsx(j,{size:22,strokeWidth:2.5}),label:"Library",activeColor:"text-brand-purple"}),r.jsx(L,{onClick:()=>{C(),a()},icon:r.jsx(y,{size:22,strokeWidth:2.5}),label:"Gym",activeColor:"text-brand-orange"})]})]})})},L=({onClick:e,icon:t,label:l,activeColor:s})=>(0,r.jsxs)("button",{onClick:e,className:"flex flex-col items-center justify-center w-full md:w-auto p-1.5 md:p-2 rounded-xl transition-all active:scale-95 group",children:[r.jsx("div",{className:`p-1 rounded-lg text-slate-300 group-hover:${s} transition-colors duration-200 mb-0.5`,children:t}),r.jsx("span",{className:"text-[9px] md:text-[10px] font-bold text-slate-300 uppercase tracking-wide group-hover:text-slate-500 transition-colors",children:l})]}),U=b("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]),I=b("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),P=({onStart:e})=>(0,r.jsxs)("div",{className:"h-[100dvh] w-full bg-gradient-to-br from-blue-400 via-blue-500 to-indigo-600 flex flex-col items-center justify-center relative overflow-hidden text-white p-6",children:[r.jsx("div",{className:"absolute top-10 left-10 text-white/20 animate-bounce-slow text-6xl",children:"☁️"}),r.jsx("div",{className:"absolute bottom-20 right-10 text-white/20 animate-pulse text-6xl",children:"✨"}),r.jsx("div",{className:"absolute top-1/4 right-1/4 w-64 h-64 bg-white/10 rounded-full blur-3xl animate-pulse"}),(0,r.jsxs)("div",{className:"relative z-10 flex flex-col items-center text-center max-w-md w-full",children:[r.jsx("div",{className:"w-32 h-32 md:w-40 md:h-40 bg-white rounded-[2.5rem] shadow-[0_20px_50px_rgba(0,0,0,0.3)] flex items-center justify-center mb-8 rotate-3 hover:rotate-6 transition-transform duration-500 border-4 border-white/50",children:r.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/3069/3069172.png",alt:"Panda",className:"w-24 h-24 md:w-32 md:h-32 object-contain"})}),(0,r.jsxs)("h1",{className:"text-5xl md:text-6xl font-black tracking-tight mb-2 drop-shadow-md",children:["Snap",r.jsx("span",{className:"text-yellow-300",children:"Story"})]}),(0,r.jsxs)("p",{className:"text-xl md:text-2xl font-medium text-blue-100 mb-10 max-w-xs leading-relaxed",children:["The magical world where",r.jsx("br",{}),r.jsx("span",{className:"font-bold text-white",children:"photos become stories!"})]}),(0,r.jsxs)("button",{onClick:()=>{C(),D(),e()},className:"w-full py-5 bg-yellow-400 text-yellow-900 rounded-full font-black text-2xl shadow-[0_6px_0_0_#b45309] active:shadow-none active:translate-y-2 transition-all flex items-center justify-center gap-3 group",children:[r.jsx(U,{className:"group-hover:rotate-12 transition-transform"}),"START PLAYING",r.jsx(I,{strokeWidth:4})]}),r.jsx("div",{className:"mt-8 text-sm font-bold text-blue-200 uppercase tracking-widest opacity-80",children:"For Kids Ages 3-12"})]})]});(function(e){e.HOME="HOME",e.THEME_SELECTION="THEME_SELECTION",e.CAMERA_QUEST="CAMERA_QUEST",e.VOCAB_REVIEW="VOCAB_REVIEW",e.KID_PROFILE="KID_PROFILE",e.STORY_MODE_SELECT="STORY_MODE_SELECT",e.STORY_SETUP="STORY_SETUP",e.STORY_READER="STORY_READER",e.STORY_QUIZ="STORY_QUIZ",e.CALENDAR="CALENDAR",e.PASSPORT="PASSPORT",e.WORD_MEMORY="WORD_MEMORY",e.VOCAB_LIST="VOCAB_LIST"})(s||(s={})),function(e){e.COLOR="Color",e.SHAPE="Shape",e.MATERIAL="Material",e.SPACE="Space",e.FUNCTION="Function",e.SURPRISE="Surprise"}(a||(a={}));let $=[{id:"c_red",label:"Red World",category:a.COLOR,icon:"\uD83D\uDD34",description:"red things",promptContext:"The story takes place in a volcano kingdom where everything is hot and red.",color:"bg-red-500"},{id:"c_blue",label:"Blue Ocean",category:a.COLOR,icon:"\uD83D\uDD35",description:"blue things",promptContext:"The story happens underwater in a magical blue coral reef.",color:"bg-blue-500"},{id:"c_green",label:"Green Forest",category:a.COLOR,icon:"\uD83D\uDFE2",description:"green things",promptContext:"A nature adventure in a deep, whispering emerald forest.",color:"bg-green-500"},{id:"c_yellow",label:"Yellow Sunshine",category:a.COLOR,icon:"\uD83D\uDFE1",description:"yellow things",promptContext:"A happy story in a land made of sunlight, lemons, and gold.",color:"bg-yellow-400"},{id:"s_round",label:"Round Planet",category:a.SHAPE,icon:"⚪",description:"round things",promptContext:"The characters love to roll, bounce, and spin. No sharp corners allowed!",color:"bg-orange-400"},{id:"s_square",label:"Box City",category:a.SHAPE,icon:"⬛",description:"square things",promptContext:"Everything is built from sturdy blocks. A story about building and stacking.",color:"bg-indigo-500"},{id:"s_triangle",label:"Pointy Peaks",category:a.SHAPE,icon:"\uD83D\uDD3A",description:"triangle things",promptContext:"An adventure climbing sharp mountains and pointy pyramids.",color:"bg-pink-500"},{id:"m_soft",label:"Soft Cloud",category:a.MATERIAL,icon:"☁️",description:"soft things",promptContext:"A gentle bedtime story in a world made of cotton candy and clouds.",color:"bg-sky-300"},{id:"m_hard",label:"Rock Solid",category:a.MATERIAL,icon:"\uD83D\uDDFF",description:"hard things",promptContext:"A tough adventure with strong, unbreakable characters.",color:"bg-stone-500"},{id:"m_shiny",label:"Shiny Metal",category:a.MATERIAL,icon:"✨",description:"shiny things",promptContext:"A sci-fi robot adventure or a quest for sparkling treasure.",color:"bg-slate-400"},{id:"m_wood",label:"Wooden Woods",category:a.MATERIAL,icon:"\uD83E\uDEB5",description:"wooden things",promptContext:"A rustic story about carving, building, and nature spirits.",color:"bg-amber-700"},{id:"sp_kitchen",label:"Chef Quest",category:a.SPACE,icon:"\uD83C\uDF73",description:"things in the kitchen",promptContext:"A cooking adventure where ingredients come to life.",color:"bg-red-400"},{id:"sp_desk",label:"Desk Explorer",category:a.SPACE,icon:"✏️",description:"things on a desk",promptContext:"A story about stationary heroes (pencils, erasers) saving the day.",color:"bg-blue-400"},{id:"sp_bedroom",label:"Dream Land",category:a.SPACE,icon:"\uD83D\uDECC",description:"things in the bedroom",promptContext:"A magical journey that happens when the lights go out.",color:"bg-purple-400"},{id:"sp_bathroom",label:"Bubble Bath",category:a.SPACE,icon:"\uD83D\uDEC1",description:"things in the bathroom",promptContext:"A splashy adventure with bubbles, water, and rubber ducks.",color:"bg-cyan-400"},{id:"f_sound",label:"Noisy Band",category:a.FUNCTION,icon:"\uD83D\uDCE2",description:"things that make noise",promptContext:"A musical story where the objects form a rock band.",color:"bg-violet-500"},{id:"f_light",label:"Light Up",category:a.FUNCTION,icon:"\uD83D\uDCA1",description:"things that give light",promptContext:"A story about chasing away the darkness.",color:"bg-yellow-300"},{id:"f_open",label:"Open Up",category:a.FUNCTION,icon:"\uD83D\uDCE6",description:"things that open",promptContext:"A mystery story where every object hides a secret inside.",color:"bg-emerald-500"}],W=[{id:"sur_happy",label:"Happy Vibes",category:a.SURPRISE,icon:"\uD83D\uDE04",description:"things that make you smile",promptContext:"A heartwarming story about spreading joy to sad characters.",color:"bg-yellow-400"},{id:"sur_magic",label:"Magic Items",category:a.SURPRISE,icon:"\uD83E\uDE84",description:"things that look magical",promptContext:"The objects found have secret spells and wizard powers.",color:"bg-purple-600"},{id:"sur_tiny",label:"Tiny World",category:a.SURPRISE,icon:"\uD83D\uDC1C",description:"tiny things",promptContext:"The main character shrinks to the size of an ant.",color:"bg-lime-500"},{id:"sur_heavy",label:"Heavy Lifter",category:a.SURPRISE,icon:"\uD83C\uDFCB️",description:"heavy things",promptContext:"A story about giants and super strength.",color:"bg-stone-600"},{id:"sur_speed",label:"Speed Racer",category:a.SURPRISE,icon:"\uD83C\uDFCE️",description:"things that look fast",promptContext:"A high-speed racing story.",color:"bg-red-600"},{id:"sur_tool",label:"Fix It!",category:a.SURPRISE,icon:"\uD83D\uDD27",description:"tools",promptContext:"A story about fixing a broken machine.",color:"bg-orange-500"}],V=[{id:"first_snap",label:"Photographer",description:"Create your first story",icon:"\uD83D\uDCF8",color:"bg-blue-400",condition:e=>e.length>=1},{id:"novice_writer",label:"Storyteller",description:"Create 3 stories",icon:"✍️",color:"bg-purple-400",condition:e=>e.length>=3},{id:"word_collector",label:"Word Collector",description:"Collect 10 different items",icon:"\uD83C\uDF92",color:"bg-orange-400",condition:(e,t)=>t>=10},{id:"master_explorer",label:"Master Explorer",description:"Collect 25 different items",icon:"\uD83D\uDC51",color:"bg-yellow-400",condition:(e,t)=>t>=25},{id:"theme_hunter",label:"Theme Hunter",description:"Try 5 different themes",icon:"\uD83C\uDF08",color:"bg-green-400",condition:e=>new Set(e.map(e=>e.themeId)).size>=5}],q=b("rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]),F=b("gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),H=b("dna",[["path",{d:"m10 16 1.5 1.5",key:"11lckj"}],["path",{d:"m14 8-1.5-1.5",key:"1ohn8i"}],["path",{d:"M15 2c-1.798 1.998-2.518 3.995-2.807 5.993",key:"80uv8i"}],["path",{d:"m16.5 10.5 1 1",key:"696xn5"}],["path",{d:"m17 6-2.891-2.891",key:"xu6p2f"}],["path",{d:"M2 15c6.667-6 13.333 0 20-6",key:"1pyr53"}],["path",{d:"m20 9 .891.891",key:"3xwk7g"}],["path",{d:"M3.109 14.109 4 15",key:"q76aoh"}],["path",{d:"m6.5 12.5 1 1",key:"cs35ky"}],["path",{d:"m7 18 2.891 2.891",key:"1sisit"}],["path",{d:"M9 22c1.798-1.998 2.518-3.995 2.807-5.993",key:"q3hbxp"}]]),B=({onSelectTheme:e})=>{let[t,l]=(0,n.useState)(3),[s,i]=(0,n.useState)(a.COLOR),[o,d]=(0,n.useState)(!1),[c,x]=(0,n.useState)(null),[u,m]=(0,n.useState)(!1),h=[{id:a.COLOR,label:"Colors",icon:"\uD83C\uDFA8"},{id:a.SHAPE,label:"Shapes",icon:"\uD83D\uDD3A"},{id:a.MATERIAL,label:"Materials",icon:"\uD83E\uDDF1"},{id:a.SPACE,label:"Places",icon:"\uD83C\uDFE0"},{id:a.FUNCTION,label:"Fun",icon:"\uD83C\uDF89"}],b=()=>{A(),d(!0),m(!0),x(null);let e=0,t=[...$,...W],l=setInterval(()=>{let s=Math.floor(Math.random()*t.length);x(t[s]),++e>=15&&(clearInterval(l),x(Math.random()>.3?W[Math.floor(Math.random()*W.length)]:$[Math.floor(Math.random()*$.length)]),m(!1),R())},100)};return(0,r.jsxs)("div",{className:"flex flex-col h-full w-full bg-slate-50",children:[(0,r.jsxs)("div",{className:"px-3 pt-3 pb-2 md:px-6 md:pt-6 shrink-0 bg-white border-b border-slate-100 z-10 flex flex-col gap-4",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center gap-3",children:[(0,r.jsxs)("h2",{className:"text-xl md:text-3xl font-black text-brand-blue flex items-center gap-2",children:[r.jsx(q,{size:24,className:"text-brand-orange",strokeWidth:3}),"Today's Mission"]}),r.jsx("div",{className:"flex bg-slate-100 p-1.5 rounded-full shadow-inner",children:[3,5,7].map(e=>(0,r.jsxs)("button",{onClick:()=>{l(e)},className:`px-4 py-2 rounded-full font-bold text-sm md:text-base transition-all flex items-center gap-1 ${t===e?"bg-white text-brand-blue shadow-sm ring-1 ring-slate-200 scale-105":"text-slate-400 hover:text-slate-600"}`,children:[e," Items"]},e))})]}),r.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide -mx-1 px-1 md:justify-center",children:h.map(e=>(0,r.jsxs)("button",{onClick:()=>{i(e.id)},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full border transition-all whitespace-nowrap ${s===e.id?"bg-brand-blue text-white border-brand-blue shadow-sm":"bg-white border-slate-200 text-slate-500 hover:bg-slate-50"}`,children:[r.jsx("span",{className:"text-sm md:text-base",children:e.icon}),r.jsx("span",{className:"text-xs md:text-sm font-bold",children:e.label})]},e.id))})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-3 md:p-6 scrollbar-hide relative",children:r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4 pb-20",children:$.filter(e=>e.category===s).map(l=>(0,r.jsxs)("button",{onClick:()=>{A(),e(l,t)},className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100 hover:border-brand-yellow hover:shadow-md transition-all text-left flex items-center gap-4 group relative overflow-hidden",children:[r.jsx("div",{className:`w-14 h-14 md:w-16 md:h-16 rounded-xl ${l.color} bg-opacity-10 flex items-center justify-center text-3xl md:text-4xl shrink-0 group-hover:scale-110 transition-transform`,children:l.icon}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[r.jsx("h3",{className:"text-base md:text-lg font-black text-slate-800 leading-tight mb-0.5 truncate group-hover:text-brand-blue transition-colors",children:l.label}),(0,r.jsxs)("p",{className:"text-xs text-slate-400 font-medium leading-tight line-clamp-2",children:["Find ",t," ",l.description,"!"]})]}),r.jsx("div",{className:"text-slate-200 group-hover:text-brand-blue group-hover:translate-x-1 transition-all",children:r.jsx(I,{size:20})})]},l.id))})}),r.jsx("div",{className:"absolute bottom-4 right-4 z-30 md:bottom-6 md:right-6",children:r.jsx("button",{onClick:b,className:"w-14 h-14 md:w-16 md:h-16 bg-gradient-to-r from-brand-purple to-pink-500 rounded-full shadow-lg shadow-purple-200 flex items-center justify-center text-white animate-bounce-slow border-2 border-white hover:scale-105 active:scale-95 transition-transform",children:r.jsx(F,{size:24,className:"md:w-8 md:h-8"})})}),o&&r.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:r.jsx("div",{className:"bg-white rounded-[2rem] p-1 w-full max-w-sm shadow-2xl animate-pop-in relative",children:(0,r.jsxs)("div",{className:"bg-slate-50 p-6 rounded-[1.8rem] border border-slate-100 flex flex-col items-center text-center",children:[r.jsx("button",{className:"absolute top-4 right-4 p-2 bg-slate-200 rounded-full text-slate-500 hover:bg-slate-300",onClick:()=>{C(),d(!1)},children:"✕"}),(0,r.jsxs)("h3",{className:"text-lg font-black text-brand-purple mb-4 uppercase tracking-widest flex items-center gap-2",children:[r.jsx(U,{size:20,className:"text-brand-yellow fill-current"})," Mystery Quest"]}),c?(0,r.jsxs)("div",{className:"w-full p-6 rounded-2xl mb-6 bg-white border-2 border-dashed border-slate-200 shadow-sm relative overflow-hidden",children:[u&&r.jsx("div",{className:"absolute inset-0 bg-white/60 z-10 flex items-center justify-center",children:r.jsx(Y,{className:"animate-spin text-brand-blue"})}),r.jsx("div",{className:"text-6xl mb-3 drop-shadow-sm",children:c.icon}),r.jsx("h2",{className:"text-2xl font-black text-slate-800 mb-1",children:c.label}),(0,r.jsxs)("p",{className:"text-sm text-slate-500 font-medium leading-tight",children:["Find ",t," ",c.description,"!"]})]}):r.jsx("div",{className:"h-40 flex items-center justify-center",children:r.jsx(H,{className:"animate-spin text-brand-blue",size:48})}),(0,r.jsxs)("div",{className:"flex gap-3 w-full",children:[r.jsx("button",{onClick:b,disabled:u,className:"flex-1 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-200 bg-slate-100 transition-colors text-sm",children:"Spin Again"}),r.jsx("button",{onClick:()=>{c&&(A(),e(c,t))},disabled:u,className:"flex-[2] py-3 bg-brand-green text-white rounded-xl font-bold text-lg shadow-[0_4px_0_0_#15803d] active:shadow-none active:translate-y-1 transition-all flex items-center justify-center gap-2",children:"Let's Go!"})]})]})})})]})},Y=({className:e})=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:r.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),G=b("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),Q=b("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Z=b("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),K=b("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),X=b("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),J=b("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),ee=b("volume-2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),et=b("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),el=b("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]),es=b("rotate-cw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),ea=b("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),er=b("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),en=e=>e.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,""),ei=(e,t=800)=>new Promise(t=>t(e)),eo=async e=>{let t=await fetch("/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw Error(`Server error: ${t.status} ${e}`)}return t.json()},ed=async e=>{if(!e||!e.trim())return null;let t=await eo({action:"generateSpeech",text:e});return t?.audioBase64??null},ec=async(e,t)=>{let l=en(await ei(e,800));return await eo({action:"identifyObject",imageBase64:l,theme:t})},ex=async(e,t,l)=>await eo({action:"lookupWord",word:e,context:t,ageGroup:l}),eu=async(e,t,l,s)=>await eo({action:"generateStory",items:e,theme:t,kidProfile:l,userPrompt:s}),em=async(e,t,l)=>{let s=await eo({action:"generateIllustration",prompt:e,style:t,characterVisual:l});return s?.imageBase64??null},eh=async(e,t)=>{let l=en(await ei(e,512)),s=await eo({action:"generateSticker",imageBase64:l,word:t});return s?.imageBase64??null};class eb{constructor(){this.audioCtx=null,this.currentSource=null,this.audioCache=new Map,this.currentPlayId=0}static getInstance(){return eb.instance||(eb.instance=new eb),eb.instance}getAudioContext(){if(!this.audioCtx){let e=window.AudioContext||window.webkitAudioContext;this.audioCtx=new e}return this.audioCtx}stopAll(){if(this.currentPlayId++,this.currentSource){try{this.currentSource.stop(),this.currentSource.disconnect()}catch(e){}this.currentSource=null}}playBrowserTTS(e){}async playGeminiAudio(e,t){if(t!==this.currentPlayId)return;let l=this.getAudioContext();"suspended"===l.state&&await l.resume();try{let s=atob(e),a=s.length,r=new Uint8Array(a);for(let e=0;e<a;e++)r[e]=s.charCodeAt(e);let n=new Float32Array(a/2),i=new DataView(r.buffer);for(let e=0;e<a/2;e++)n[e]=i.getInt16(2*e,!0)/32768;let o=l.createBuffer(1,n.length,24e3);if(o.getChannelData(0).set(n),t!==this.currentPlayId)return;window.speechSynthesis&&window.speechSynthesis.cancel();let d=l.createBufferSource();d.buffer=o,d.connect(l.destination),this.currentSource=d,d.start(),d.onended=()=>{this.currentSource===d&&(this.currentSource=null)}}catch(e){console.error("Audio Decode Error",e)}}async speak(e){if(!e)return;let t=this.getAudioContext();"suspended"===t.state&&t.resume().catch(()=>{}),this.stopAll();let l=this.currentPlayId;if(this.audioCache.has(e))try{await this.playGeminiAudio(this.audioCache.get(e),l);return}catch(e){}try{let t=new Promise((e,t)=>setTimeout(()=>t(Error("Timeout")),15e3)),s=await Promise.race([ed(e),t]);if(l!==this.currentPlayId)return;if(s){this.audioCache.set(e,s),await this.playGeminiAudio(s,l);return}}catch(e){}l===this.currentPlayId&&this.playBrowserTTS(e)}}let ep=eb.getInstance(),ef=({targetCount:e,theme:t,onComplete:l,onBack:s})=>{let[a,i]=(0,n.useState)([]),[o,d]=(0,n.useState)(!1),[c,x]=(0,n.useState)(null),[u,m]=(0,n.useState)(null),[h,b]=(0,n.useState)(!1),[f,g]=(0,n.useState)(!1),[w,j]=(0,n.useState)(null),y=(0,n.useRef)(null),v=(0,n.useRef)(null),k=(0,n.useRef)([]),N=(0,n.useRef)(null);(0,n.useEffect)(()=>()=>{w&&URL.revokeObjectURL(w),S()},[c]);let S=()=>{v.current&&v.current.stream&&v.current.stream.getTracks().forEach(e=>e.stop())},z=async e=>{ep.getAudioContext().resume().catch(()=>{});let l=e.target.files?.[0];if(!l)return;d(!0),m(null),j(null),b(!1),g(!1);let s=new FileReader;s.onloadend=async()=>{let e=s.result,l=await ec(e,t);if(!l.matchesTheme){E(),d(!1),m({title:"Not Quite!",feedback:l.feedback||`That doesn't look like ${t.label}! Try again.`,image:e}),_(l.feedback||`That is not ${t.label}. Try again.`);return}if(a.some(e=>e.word.toLowerCase()===l.word.toLowerCase())){E(),d(!1),m({title:"Already Collected!",feedback:`You already have a ${l.word}! Let's find a different ${t.description}.`,image:e}),_(`You already collected this card. Please snap a different ${t.description}.`);return}let r={id:Date.now().toString(),word:l.word,definition:l.definition,imageUrl:e,originalImage:e,timestamp:Date.now(),visualDetail:l.visualDetail};i(e=>[...e,r]),x(r),d(!1),_(`You found a ${l.word}!`),eh(e,l.word).then(e=>{if(e){M();let t={...r,imageUrl:e};i(e=>e.map(e=>e.id===r.id?t:e)),x(e=>e&&e.id===r.id?t:e)}})},s.readAsDataURL(l)},_=async e=>{ep.speak(e)},O=async()=>{try{ep.stopAll(),N.current&&(N.current.pause(),g(!1)),C();let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);v.current=t,k.current=[],t.ondataavailable=e=>{e.data.size>0&&k.current.push(e.data)},t.onstop=()=>{let e=t.mimeType||"",l=new Blob(k.current,{type:e}),s=URL.createObjectURL(l);j(s),setTimeout(()=>L(s),100)},t.start(),b(!0)}catch(e){console.error("Mic error:",e),alert("Microphone access needed for recording.")}},L=e=>{let t=e||w;if(!t)return;ep.stopAll(),N.current&&(N.current.pause(),N.current=null);let l=new Audio(t);N.current=l,g(!0),l.onended=()=>g(!1);let s=l.play();void 0!==s&&s.catch(e=>{console.error("Playback error",e),g(!1)})},U=e=>{T(),i(t=>t.filter(t=>t.id!==e)),c?.id===e&&(x(null),j(null),b(!1))};return!(a.length>=e)||c||o||u?(0,r.jsxs)("div",{className:"h-full flex flex-col bg-slate-50 relative overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center px-4 pt-[calc(env(safe-area-inset-top)+0.5rem)] pb-3 shrink-0 bg-white border-b border-slate-100 z-10 shadow-sm",children:[r.jsx("div",{className:"flex items-center gap-3 w-1/3",children:s&&r.jsx("button",{onClick:()=>{C(),s()},className:"p-2 bg-slate-100 rounded-full text-slate-500 hover:bg-slate-200",children:r.jsx(p,{size:24})})}),r.jsx("div",{className:"flex flex-col items-center justify-center w-1/3",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-2xl",children:t.icon}),r.jsx("h2",{className:"text-sm font-bold text-slate-800 leading-tight hidden md:block",children:t.label})]})}),r.jsx("div",{className:"flex justify-end w-1/3",children:(0,r.jsxs)("div",{className:"bg-brand-orange/10 px-3 py-1 rounded-full whitespace-nowrap border border-brand-orange/20",children:[r.jsx("span",{className:"text-lg font-black text-brand-orange",children:a.length}),(0,r.jsxs)("span",{className:"text-brand-orange/50 text-sm font-bold",children:[" / ",e]})]})})]}),(0,r.jsxs)("div",{className:"flex-1 min-h-0 p-3 flex flex-col pb-[env(safe-area-inset-bottom)]",children:[(0,r.jsxs)("button",{className:`flex-1 w-full bg-slate-200 rounded-[2rem] border-4 border-dashed border-slate-300 flex flex-col items-center justify-center relative overflow-hidden transition-colors shadow-inner ${o?"cursor-wait opacity-80":"cursor-pointer active:bg-slate-300 group"}`,onClick:()=>{o||c||(C(),y.current&&y.current.click())},disabled:o,children:[r.jsx("input",{type:"file",accept:"image/*",capture:"environment",ref:y,onChange:z,className:"hidden",disabled:o}),o?(0,r.jsxs)("div",{className:"text-center z-10 animate-pulse",children:[r.jsx(Q,{size:48,className:"animate-spin text-brand-blue mb-4 mx-auto"}),r.jsx("p",{className:"text-lg font-bold text-slate-600 bg-white/80 px-4 py-1 rounded-full backdrop-blur-sm",children:"Identifying..."})]}):(0,r.jsxs)("div",{className:"text-center flex flex-col items-center pointer-events-none",children:[r.jsx("div",{className:"w-24 h-24 bg-white rounded-full flex items-center justify-center shadow-lg mb-6 text-brand-blue animate-pulse",children:r.jsx(Z,{size:40,strokeWidth:2.5})}),r.jsx("h3",{className:"text-2xl font-black text-slate-600 tracking-tight",children:"Tap to Snap"}),(0,r.jsxs)("p",{className:"text-slate-400 font-medium mt-1",children:["Find: ",t.label]})]})]}),a.length>0&&r.jsx("div",{className:"h-20 mt-3 flex gap-2 overflow-x-auto px-1 shrink-0 scrollbar-hide items-center justify-center",children:a.map(e=>(0,r.jsxs)("div",{onClick:()=>{o||(A(),x(e))},className:"min-w-[60px] w-14 h-14 bg-white rounded-xl shadow-md border border-slate-100 relative animate-pop-in shrink-0 p-0.5 cursor-pointer",children:[r.jsx("img",{src:e.imageUrl,alt:e.word,className:"w-full h-full object-cover rounded-lg"}),r.jsx("div",{className:"absolute -top-1 -right-1 bg-green-500 text-white rounded-full p-0.5 shadow-sm border border-white",children:r.jsx(G,{size:8,strokeWidth:4})})]},e.id))})]}),u&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-6 animate-shake",children:(0,r.jsxs)("div",{className:"bg-white rounded-[2.5rem] w-full max-w-sm shadow-2xl relative flex flex-col items-center p-8 text-center border-8 border-red-50",children:[r.jsx("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-6 text-red-500 shrink-0",children:r.jsx(K,{size:40,strokeWidth:3})}),r.jsx("h2",{className:"text-3xl font-black text-slate-800 mb-2",children:u.title||"Not Quite!"}),r.jsx("div",{className:"w-24 h-24 rounded-2xl overflow-hidden border-4 border-white shadow-lg mb-6 rotate-2 bg-slate-100",children:r.jsx("img",{src:u.image,className:"w-full h-full object-cover",alt:"Captured item"})}),r.jsx("div",{className:"bg-red-50 p-4 rounded-2xl w-full border border-red-100 mb-8",children:(0,r.jsxs)("p",{className:"text-red-600 font-bold text-xl leading-snug",children:['"',u.feedback,'"']})}),(0,r.jsxs)("button",{onClick:()=>{C(),m(null)},className:"w-full py-4 bg-brand-orange text-white rounded-2xl font-bold text-xl shadow-[0_6px_0_0_#c2410c] active:translate-y-1 active:shadow-none transition-all flex items-center justify-center gap-2",children:[r.jsx(X,{size:24})," Try Again"]})]})}),c&&r.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4 animate-pop-in",children:(0,r.jsxs)("div",{className:"bg-white rounded-[2.5rem] w-full max-w-xs md:max-w-sm overflow-hidden shadow-2xl relative flex flex-col max-h-[90dvh] border-8 border-white",children:[(0,r.jsxs)("div",{className:"h-56 bg-slate-100 relative shrink-0 transition-all duration-500 group overflow-hidden",children:[r.jsx("img",{src:c.imageUrl,className:"w-full h-full object-cover transition-all duration-700",alt:"Captured"}),c.imageUrl!==c.originalImage&&(0,r.jsxs)("div",{className:"absolute top-2 left-2 bg-white/90 text-brand-purple px-2 py-1 rounded-full text-[10px] font-bold shadow-sm flex items-center gap-1 animate-pop-in z-20",children:[r.jsx(J,{size:10,fill:"currentColor"})," Sticker Magic"]}),r.jsx("button",{onClick:()=>{C(),_(c.word)},className:"absolute bottom-4 right-4 p-3 bg-brand-yellow rounded-full text-brand-blue shadow-lg hover:scale-110 transition-transform z-20",children:r.jsx(ee,{size:24})})]}),(0,r.jsxs)("div",{className:"p-4 md:p-6 text-center flex flex-col items-center overflow-y-auto flex-1",children:[r.jsx("h2",{className:"text-3xl font-black text-brand-blue capitalize mb-1 tracking-tight",children:c.word}),(0,r.jsxs)("p",{className:"text-slate-600 font-medium text-sm leading-relaxed mb-4 bg-slate-50 p-3 rounded-2xl w-full border border-slate-100",children:['"',c.definition,'"']}),(0,r.jsxs)("div",{className:"bg-slate-100 rounded-2xl p-2 flex items-center gap-2 border border-slate-200 mb-4 w-full",children:[h?r.jsx("button",{onClick:()=>{v.current&&h&&(A(),v.current.stop(),b(!1),S())},className:"w-12 h-12 bg-red-500 text-white rounded-xl shadow-md flex items-center justify-center animate-pulse shrink-0",children:r.jsx(et,{size:20,fill:"currentColor"})}):r.jsx("button",{onClick:O,className:"w-12 h-12 bg-white text-red-500 border-2 border-red-100 rounded-xl shadow-sm flex items-center justify-center hover:bg-red-50 transition-colors shrink-0",children:r.jsx(el,{size:24})}),(0,r.jsxs)("div",{className:"flex-1 text-left pl-1 min-w-0",children:[r.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Voice Studio"}),r.jsx("div",{className:"text-slate-700 font-bold flex items-center gap-1 text-sm truncate",children:h?r.jsx("span",{className:"text-red-500 animate-pulse",children:"Recording..."}):f?(0,r.jsxs)("span",{className:"text-brand-blue flex items-center gap-1",children:[r.jsx(ee,{size:14,className:"animate-bounce"})," Playing..."]}):w?(0,r.jsxs)("span",{className:"text-green-600 flex items-center gap-1 truncate",children:[r.jsx(es,{size:12})," Re-record"]}):"Tap Mic to Say it!"})]}),w&&!h&&r.jsx("button",{onClick:()=>{C(),L()},className:`w-10 h-10 rounded-full flex items-center justify-center transition-all shrink-0 ${f?"bg-brand-blue text-white shadow-inner":"bg-blue-100 text-brand-blue hover:bg-blue-200"}`,children:f?r.jsx(ee,{size:16}):r.jsx(ea,{size:16,fill:"currentColor"})})]}),(0,r.jsxs)("div",{className:"flex gap-3 w-full mt-auto",children:[r.jsx("button",{onClick:()=>U(c.id),className:"p-4 bg-red-50 text-red-500 rounded-2xl font-bold hover:bg-red-100 transition-colors border border-red-100",children:r.jsx(er,{size:24})}),(0,r.jsxs)("button",{onClick:()=>{R(),x(null),j(null),b(!1)},className:"flex-1 py-4 bg-brand-green text-white rounded-2xl font-bold text-xl shadow-[0_4px_0_0_#166534] active:shadow-none active:translate-y-1 transition-all flex items-center justify-center gap-2",children:["Keep It! ",r.jsx(G,{size:24,strokeWidth:3})]})]})]})]})})]}):(0,r.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-center p-8 animate-pop-in bg-slate-50 pt-[env(safe-area-inset-top)]",children:[r.jsx("div",{className:"w-24 h-24 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-6 shadow-sm",children:r.jsx(G,{size:48,strokeWidth:4})}),r.jsx("h2",{className:"text-3xl font-bold text-slate-800 mb-4",children:"Quest Complete!"}),(0,r.jsxs)("p",{className:"text-lg text-slate-500 mb-8",children:["You found all ",e," items!"]}),(0,r.jsxs)("button",{onClick:()=>{D(),l(a)},className:"px-8 py-4 bg-brand-blue text-white rounded-full font-bold text-xl shadow-xl hover:scale-105 transition-transform flex items-center gap-3",children:["Create Story ",r.jsx(I,{})]})]})},eg=b("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ew=b("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),ej=b("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),ey=b("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]]),ev=b("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),ek=b("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),eN=b("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var eC=l(5245),eS=l.n(eC);let eA=({story:e,onFinish:t,kidProfile:l,onWordAdded:s})=>{let[a,i]=(0,n.useState)(0),[o,d]=(0,n.useState)(e.learnedWords||[]),[c,x]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),[h,b]=(0,n.useState)(null),[f,g]=(0,n.useState)(0),[w,j]=(0,n.useState)(new Set),[y,v]=(0,n.useState)(null),[k,N]=(0,n.useState)({isOpen:!1,word:"",loading:!1,data:null,isAdding:!1,generatedImage:null}),[T,D]=(0,n.useState)(!1),[O,L]=(0,n.useState)(!1),[I,P]=(0,n.useState)(null),$=(0,n.useRef)(null),W=(0,n.useRef)([]),V=(0,n.useRef)(null),[q,F]=(0,n.useState)(0),[H,B]=(0,n.useState)(null),[Y,G]=(0,n.useState)([]),[Z,K]=(0,n.useState)(!1),[X,es]=(0,n.useState)([]),[er,en]=(0,n.useState)([]),[ei,eo]=(0,n.useState)("idle"),[ec,eu]=(0,n.useState)({}),[eh,eb]=(0,n.useState)({x:0,y:0,show:!1}),ef=(0,n.useRef)(null),eC=(0,n.useRef)(null),eA=(0,n.useRef)(!0),ez=(0,n.useRef)(0),eM=e.pages[a],eT=a===e.pages.length-1,eR=(0,n.useMemo)(()=>"9-12"===l.ageGroup||"Advanced"===l.englishLevel,[l]);(0,n.useEffect)(()=>(eA.current=!0,()=>{eA.current=!1,eL(),eE()}),[]),(0,n.useEffect)(()=>{ez.current=a},[a]),(0,n.useEffect)(()=>{k.isOpen||y||(eE(),P(null),D(!1))},[k.isOpen,y]);let eE=()=>{$.current&&$.current.stream&&$.current.stream.getTracks().forEach(e=>e.stop())},eD=async()=>{try{ep.stopAll(),C();let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);$.current=t,W.current=[],t.ondataavailable=e=>{e.data.size>0&&W.current.push(e.data)},t.onstop=()=>{let e=t.mimeType||"",l=new Blob(W.current,{type:e}),s=URL.createObjectURL(l);P(s),setTimeout(()=>eO(s),100)},t.start(),D(!0)}catch(e){console.error("Mic error:",e),alert("Microphone access needed for recording.")}},e_=()=>{$.current&&T&&(A(),$.current.stop(),D(!1),eE())},eO=e=>{let t=e||I;if(!t)return;ep.stopAll(),V.current&&(V.current.pause(),V.current=null);let l=new Audio(t);V.current=l,L(!0),l.onended=()=>L(!1);let s=l.play();s&&s.catch(e=>console.error(e))},eL=()=>{if(ep.stopAll(),ef.current){try{ef.current.stop(),ef.current.disconnect()}catch(e){}ef.current=null}eC.current&&(cancelAnimationFrame(eC.current),eC.current=null),x(!1),m(!1),B(null)},eU=async(e,t)=>{if(eA.current&&ez.current===a){eL();try{let l=ep.getAudioContext();"suspended"===l.state&&await l.resume();let s=atob(e),r=s.length,n=new Uint8Array(r);for(let e=0;e<r;e++)n[e]=s.charCodeAt(e);let i=new Float32Array(r/2),o=new DataView(n.buffer);for(let e=0;e<r/2;e++)i[e]=o.getInt16(2*e,!0)/32768;let d=l.createBuffer(1,i.length,24e3);if(d.getChannelData(0).set(i),ez.current!==a)return;let c=l.createBufferSource();c.buffer=d,c.connect(l.destination);let u=t.reduce((e,t)=>e+t.clean.length,0),m=l.currentTime,h=d.duration,b=()=>{if(!eA.current||ez.current!==a)return;let e=l.currentTime-m;if(e>=h){B(null),x(!1);return}let s=Math.floor(e/h*u),r=0,n=-1;for(let e=0;e<t.length;e++){let l=t[e].clean.length;if(s>=r&&s<r+l){n=e;break}r+=l}-1!==n&&B(n),eC.current=requestAnimationFrame(b)};eC.current=requestAnimationFrame(b),c.onended=()=>{eA.current&&(x(!1),eC.current&&cancelAnimationFrame(eC.current),B(null))},ef.current=c,c.start(),x(!0)}catch(l){console.error("Audio Playback Error",l),x(!1);let e=t.map(e=>e.clean).join(" ");ep.playBrowserTTS(e)}}};(0,n.useEffect)(()=>{let e=eM.text.split(/\s+/).map(e=>{let t=e.includes("*"),l=e.replace(/\*/g,""),s=l.replace(/[^a-zA-Z0-9']/g,"");return{text:l,clean:s,raw:e,isSpecial:t}});G(e),B(null),F(0);let t=0,l=setInterval(()=>{eA.current&&(F(++t),t>=e.length&&clearInterval(l))},100);return()=>clearInterval(l)},[eM]),(0,n.useEffect)(()=>{eL(),eb({x:0,y:0,show:!1})},[a]);let eI=e=>{A();let t=e.replace(/[^a-zA-Z]/g,"").toUpperCase().split("");es(t.map((e,t)=>({id:t,char:e})).sort(()=>Math.random()-.5)),en(Array(t.length).fill(null)),eo("idle"),K(!0),eR&&eV(e)},eP=()=>{C(),y&&(eo("idle"),eI(y.word))},e$=e=>{if("correct"===ei||"hint"===ei)return;C();let t=er.findIndex(e=>null===e);if(-1!==t){let l=[...er];l[t]=e.char,en(l),es(t=>t.filter(t=>t.id!==e.id))}},eW=()=>{if("correct"===ei||"hint"===ei)return;C();let e=-1;for(let t=er.length-1;t>=0;t--)if(null!==er[t]){e=t;break}if(-1!==e){let t=er[e];if(!t)return;let l=[...er];l[e]=null,en(l),es(e=>[...e,{id:Date.now(),char:t}])}},eV=async e=>{await ep.speak(e)},eq=async()=>{if(S(),c||u){eL();return}eL(),m(!0);try{let e=eM.text.replace(/\*/g,""),t=new Promise((e,t)=>setTimeout(()=>t(Error("Timeout")),15e3)),l=await Promise.race([ed(e),t]);if(ez.current!==a){m(!1);return}m(!1),eA.current&&(l?eU(l,Y):ep.playBrowserTTS(e))}catch(e){console.error("Narration error",e),eA.current&&ez.current===a&&(m(!1),ep.playBrowserTTS(eM.text.replace(/\*/g,"")))}},eF=async(e,t,s)=>{e.stopPropagation();let r=t.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"");if(r.length<2&&"i"!==r.toLowerCase())return;let n=o.find(e=>{let t=r.toLowerCase(),l=e.word.toLowerCase();if(t===l||t===l+"s"||t===l+"es"||l===t+"s")return!0;let s=l.split(/[\s-]+/);return s.length>1&&s.some(e=>!(e.length<2)&&(t===e||t===e+"s"||t===e+"es"))});if(n&&!ec[a]?.includes(n.id)&&(eu(e=>({...e,[a]:[...e[a]||[],n.id]})),z(),eS()({particleCount:30,spread:40,origin:{x:e.clientX/window.innerWidth,y:e.clientY/window.innerHeight}})),s)n&&(A(),eV(n.word),P(null),D(!1),eb({x:e.clientX,y:e.clientY,show:!0}),setTimeout(()=>{eA.current&&(eb(e=>({...e,show:!1})),v(n),K(!1))},1e3));else{A(),eL(),P(null),D(!1),L(!1),N({isOpen:!0,word:r,loading:!0,data:null,isAdding:!1,generatedImage:null}),eV(r);let e=await ex(r,eM.text,l.ageGroup);if(!eA.current)return;let t=null;e.visualDetail&&(t=await em(e.visualDetail,"icon sticker style, simple, white background, cute vector art","cartoon")),eA.current&&N(l=>({...l,loading:!1,data:e,generatedImage:t}))}},eH=async()=>{if(k.word&&k.data){M(),N(e=>({...e,isAdding:!0}));try{let e=k.generatedImage||"https://cdn-icons-png.flaticon.com/512/3574/3574069.png",t={id:Date.now().toString(),word:k.word,definition:k.data.definition,imageUrl:e,originalImage:e,timestamp:Date.now(),visualDetail:k.data.visualDetail};s(t),d(e=>[...e,t]),eu(e=>({...e,[a]:[...e[a]||[],t.id]})),R(),eS()({particleCount:50,spread:60,origin:{y:.6}}),N(e=>({...e,isAdding:!1}))}catch(e){console.error(e),E(),N(e=>({...e,isAdding:!1}))}}},eB=()=>{C(),N(e=>({...e,isOpen:!1})),P(null),D(!1)},eY=(0,n.useMemo)(()=>o?o.filter(e=>{let t=e.word.toLowerCase().split(/[\s-]+/),l=eM.text.toLowerCase();return t.some(e=>{if(e.length<2&&t.length>1)return!1;try{return RegExp(`\\b${e}(s|es)?\\b`,"i").test(l)}catch(e){return!1}})}):[],[eM,o]);return(0,r.jsxs)("div",{className:"h-full w-full flex flex-col bg-white md:bg-transparent relative",children:[eh.show&&r.jsx("div",{className:"fixed z-[100] pointer-events-none",style:{left:eh.x,top:eh.y,transform:"translate(-50%, -50%)"},children:r.jsx("div",{className:"text-6xl md:text-8xl drop-shadow-2xl animate-grab-pop",children:"✋"})}),k.isOpen&&r.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4 animate-pop-in",children:(0,r.jsxs)("div",{className:"bg-white rounded-[2.5rem] w-full max-w-sm shadow-2xl relative border-8 border-white ring-4 ring-brand-purple flex flex-col overflow-hidden pt-[env(safe-area-inset-top)]",children:[r.jsx("button",{onClick:eB,className:"absolute top-4 right-4 bg-slate-100 p-2 rounded-full hover:bg-slate-200 z-10",children:r.jsx(eg,{size:20,className:"text-slate-500"})}),r.jsx("div",{className:"bg-purple-50 p-6 text-center border-b border-purple-100 flex flex-col items-center",children:k.loading?r.jsx("div",{className:"h-20 flex items-center justify-center",children:r.jsx(Q,{className:"animate-spin text-brand-purple",size:40})}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"w-32 h-32 rounded-2xl overflow-hidden border-4 border-white shadow-lg rotate-3 mb-4 animate-pop-in bg-white",children:k.generatedImage?r.jsx("img",{src:k.generatedImage,className:"w-full h-full object-cover",alt:"New Sticker"}):r.jsx("div",{className:"w-full h-full flex items-center justify-center text-purple-200",children:r.jsx(ew,{size:40})})}),r.jsx("h2",{className:"text-2xl font-black text-brand-purple capitalize tracking-tight mb-2",children:k.word}),(0,r.jsxs)("button",{onClick:()=>eV(k.word),className:"bg-white px-4 py-2 rounded-full shadow-sm flex items-center gap-2 text-brand-purple font-bold hover:scale-105 transition-transform mb-2",children:[r.jsx(ee,{size:20})," Listen"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 bg-white/50 p-1.5 rounded-full border border-purple-100",children:[T?r.jsx("button",{onClick:e_,className:"w-10 h-10 bg-red-500 rounded-full text-white animate-pulse flex items-center justify-center",children:r.jsx(et,{size:16,fill:"currentColor"})}):r.jsx("button",{onClick:eD,className:"w-10 h-10 bg-white rounded-full text-red-500 border border-red-100 flex items-center justify-center hover:bg-red-50",children:r.jsx(el,{size:20})}),I&&!T&&r.jsx("button",{onClick:()=>eO(),className:`w-10 h-10 rounded-full text-white flex items-center justify-center ${O?"bg-brand-blue":"bg-blue-300"}`,children:O?r.jsx(ee,{size:16}):r.jsx(ea,{size:16,fill:"currentColor"})}),r.jsx("span",{className:"text-xs font-bold text-slate-400 px-2",children:T?"Recording...":I?"Replay":"Try saying it!"})]})]})}),r.jsx("div",{className:"p-6 flex-1 bg-white",children:k.loading?(0,r.jsxs)("div",{className:"space-y-3 animate-pulse",children:[r.jsx("div",{className:"h-4 bg-slate-100 rounded w-3/4 mx-auto"}),r.jsx("div",{className:"h-4 bg-slate-100 rounded w-1/2 mx-auto"})]}):o.some(e=>e.word.toLowerCase()===k.word.toLowerCase())||!1===k.isAdding&&k.generatedImage&&null===k.data?(0,r.jsxs)("div",{className:"text-center animate-pop-in",children:[r.jsx("p",{className:"text-lg text-slate-500 font-medium mb-6",children:"It has been saved to your sticker cabinet."}),(0,r.jsxs)("button",{onClick:eB,className:"w-full py-4 bg-brand-blue text-white rounded-2xl font-bold text-lg shadow-lg hover:scale-105 transition-transform flex items-center justify-center gap-2",children:["Awesome! ",r.jsx(ej,{})]})]}):(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("p",{className:"text-xl font-medium text-slate-700 leading-relaxed mb-6",children:['"',k.data?.definition,'"']}),(0,r.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-xl border border-yellow-200 text-sm font-bold text-slate-600 mb-6 flex gap-2 items-start text-left",children:[r.jsx("span",{className:"text-xl",children:"\uD83D\uDCA1"}),r.jsx("span",{children:k.data?.funFact})]}),r.jsx("button",{onClick:eH,disabled:k.isAdding,className:"w-full py-4 bg-brand-green text-white rounded-2xl font-bold text-lg shadow-[0_4px_0_0_#15803d] active:shadow-none active:translate-y-1 transition-all flex items-center justify-center gap-2 disabled:opacity-70 disabled:translate-y-0",children:k.isAdding?(0,r.jsxs)(r.Fragment,{children:[r.jsx(Q,{className:"animate-spin"})," Painting Sticker..."]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(ew,{size:24,strokeWidth:3})," Add to Library"]})})]})})]})}),y&&r.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4 animate-pop-in",children:(0,r.jsxs)("div",{className:"bg-white rounded-3xl w-full max-w-2xl shadow-2xl relative border-4 border-white ring-4 ring-brand-blue flex flex-col max-h-[90dvh] overflow-hidden pt-[env(safe-area-inset-top)]",children:[(0,r.jsxs)("div",{className:"bg-blue-50 p-3 flex justify-between items-center border-b border-blue-100 shrink-0",children:[(0,r.jsxs)("h2",{className:"text-lg font-black text-brand-blue uppercase tracking-wider flex items-center gap-2",children:[r.jsx(U,{size:20})," Spell It"]}),r.jsx("button",{onClick:()=>v(null),className:"p-2 bg-white rounded-full text-slate-400 hover:bg-red-50 hover:text-red-500",children:r.jsx(eg,{size:20})})]}),(0,r.jsxs)("div",{className:"p-4 md:p-8 overflow-y-auto flex-1 flex flex-col items-center",children:[(0,r.jsxs)("div",{className:"w-32 h-32 md:w-56 md:h-56 bg-slate-100 rounded-2xl mb-4 md:mb-6 shadow-inner relative overflow-hidden shrink-0 border-4 border-slate-50",children:[r.jsx("img",{src:y.imageUrl,className:"w-full h-full object-cover",alt:"Spell this"}),r.jsx("button",{onClick:()=>eV(y.word),className:"absolute bottom-2 right-2 p-2 bg-white rounded-full text-brand-orange shadow-md hover:scale-110 active:scale-95 transition-all",children:r.jsx(ee,{size:20})})]}),Z?(0,r.jsxs)("div",{className:"w-full flex flex-col items-center",children:[r.jsx("div",{className:"mb-4 md:mb-6 flex gap-1",children:eR?y.word.split("").map((e,t)=>r.jsx("div",{className:"w-3 h-1 bg-slate-200 rounded-full mx-0.5"},t)):r.jsx("span",{className:"font-black text-2xl md:text-3xl text-slate-200 tracking-[0.2em] uppercase",children:y.word})}),r.jsx("div",{className:"flex flex-nowrap justify-center gap-1 md:gap-2 mb-6 w-full px-1",children:er.map((e,t)=>r.jsx("div",{onClick:eW,className:`flex-1 max-w-[3rem] md:max-w-[4rem] aspect-[3/4] rounded-lg md:rounded-xl border-b-4 flex items-center justify-center font-black cursor-pointer transition-all ${y.word.length>6?"text-xl md:text-3xl":"text-3xl md:text-5xl"} ${"wrong"===ei?"animate-shake border-red-200 bg-red-50 text-red-500":""} ${"correct"===ei?"border-brand-green bg-green-100 text-brand-green scale-110":""} ${"hint"===ei?"border-orange-200 bg-orange-50 text-brand-orange opacity-80":""} ${e||"idle"!==ei?"":"bg-slate-50 border-slate-200"} ${e&&"idle"===ei?"bg-white border-brand-blue text-brand-blue shadow-sm":""}`,children:e},t))}),"correct"===ei?(0,r.jsxs)("div",{className:"animate-pop-in text-center w-full",children:[r.jsx("h3",{className:"text-2xl md:text-3xl font-black text-brand-green mb-4",children:"Awesome!"}),(0,r.jsxs)("button",{onClick:()=>{A(),v(null),K(!1)},className:"w-full py-3 bg-brand-green text-white rounded-full font-bold text-lg md:text-xl shadow-lg hover:scale-105 transition-transform flex items-center justify-center gap-2",children:[r.jsx(J,{className:"fill-yellow-300 text-yellow-300"})," Done"]})]}):"hint"===ei?r.jsx("div",{className:"animate-pop-in text-center text-brand-orange font-bold text-lg mb-4",children:"Watch closely..."}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-6",children:X.map(e=>r.jsx("button",{onClick:()=>e$(e),className:"w-10 h-10 md:w-14 md:h-14 bg-white rounded-lg md:rounded-xl shadow-sm border border-slate-200 text-xl md:text-2xl font-black text-slate-700 active:scale-95 active:bg-slate-100 transition-all flex items-center justify-center",children:e.char},e.id))}),(0,r.jsxs)("div",{className:"flex gap-3 w-full mt-auto",children:[r.jsx("button",{onClick:eP,className:"p-3 md:p-4 rounded-xl bg-slate-100 text-slate-500 hover:bg-slate-200",children:r.jsx(U,{size:20})}),r.jsx("button",{onClick:()=>{if(!y)return;C();let e=y.word.replace(/[^a-zA-Z]/g,"").toUpperCase();er.join("")===e?(eo("correct"),R(),eS()({particleCount:100,spread:70,origin:{y:.6},zIndex:9999}),eV("Correct! "+y.word),w.has(y.id)||(j(e=>new Set(e).add(y.id)),g(e=>e+1))):(eo("wrong"),E(),eo("hint"),en(e.split("")),setTimeout(()=>eP(),2e3))},disabled:er.includes(null),className:"flex-1 py-3 md:py-4 bg-brand-blue text-white rounded-xl font-bold text-lg md:text-xl shadow-[0_4px_0_0_#2563eb] active:translate-y-1 active:shadow-none transition-all disabled:opacity-50 disabled:shadow-none disabled:translate-y-1",children:"Check"})]})]})]}):(0,r.jsxs)("div",{className:"text-center w-full flex flex-col items-center",children:[r.jsx("h3",{className:"text-3xl md:text-5xl font-black text-slate-800 capitalize mb-2",children:y.word}),(0,r.jsxs)("p",{className:"text-slate-500 font-medium text-base md:text-lg mb-4",children:['"',y.definition,'"']}),(0,r.jsxs)("div",{className:"flex items-center gap-3 bg-blue-50 p-2 rounded-full border border-blue-100 mb-6",children:[T?r.jsx("button",{onClick:e_,className:"w-12 h-12 bg-red-500 rounded-full text-white animate-pulse flex items-center justify-center shadow-sm",children:r.jsx(et,{size:16,fill:"currentColor"})}):r.jsx("button",{onClick:eD,className:"w-12 h-12 bg-white rounded-full text-red-500 border border-red-100 flex items-center justify-center hover:bg-red-50 shadow-sm",children:r.jsx(el,{size:24})}),(0,r.jsxs)("div",{className:"flex flex-col items-start px-2",children:[r.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wide",children:"Voice Studio"}),r.jsx("span",{className:"text-sm font-bold text-brand-blue",children:T?"Recording...":I?"Great job!":"Practice Saying It"})]}),I&&!T&&r.jsx("button",{onClick:()=>eO(),className:`w-12 h-12 rounded-full text-white flex items-center justify-center shadow-sm ${O?"bg-brand-blue":"bg-blue-300"}`,children:O?r.jsx(ee,{size:20}):r.jsx(ea,{size:20,fill:"currentColor"})})]}),(0,r.jsxs)("button",{onClick:()=>eI(y.word),className:"w-full py-3 md:py-4 bg-brand-blue text-white rounded-xl md:rounded-2xl font-bold text-xl md:text-2xl shadow-[0_4px_0_0_#2563eb] active:translate-y-1 active:shadow-none transition-all flex items-center justify-center gap-3",children:[r.jsx(U,{})," Start Spelling"]})]})]})]})}),(0,r.jsxs)("div",{className:"h-14 md:h-16 flex items-center justify-between px-3 md:px-6 shrink-0 bg-white border-b border-slate-100 z-30 shadow-sm pt-[env(safe-area-inset-top)] md:pt-0 box-content",children:[r.jsx("button",{onClick:t,className:"p-2 bg-slate-50 rounded-full text-slate-400 hover:bg-red-50 hover:text-red-500 transition-colors",children:r.jsx(eg,{size:20})}),r.jsx("div",{className:"flex items-center gap-3",children:(0,r.jsxs)("div",{className:"bg-yellow-50 px-3 py-1 rounded-full border border-yellow-200 flex items-center gap-1",children:[r.jsx(J,{className:"fill-brand-yellow text-brand-yellow",size:16}),r.jsx("span",{className:"font-black text-brand-yellow text-base",children:f})]})}),r.jsx("div",{className:"flex items-center gap-2",children:(0,r.jsxs)("button",{onClick:eq,disabled:u,className:`flex items-center gap-2 px-3 py-2 rounded-full transition-all border-2 ${c?"bg-brand-orange text-white border-brand-orange":u?"bg-orange-50 text-brand-orange border-orange-200":"bg-white text-slate-500 border-slate-200 hover:border-brand-orange"}`,title:"Storyteller Mode",children:[u?r.jsx(Q,{size:18,className:"animate-spin"}):c?r.jsx(ey,{size:18}):r.jsx(U,{size:18}),r.jsx("span",{className:"text-xs font-bold uppercase hidden sm:inline",children:u?"Loading...":"Storyteller"})]})})]}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col md:flex-row h-full min-h-0 relative overflow-hidden pb-[env(safe-area-inset-bottom)]",children:[(0,r.jsxs)("div",{className:"w-full shrink-0 h-[40dvh] md:aspect-auto md:h-full md:w-1/2 bg-slate-100 relative flex items-center justify-center p-0 md:p-6 overflow-hidden",children:[r.jsx("div",{className:"hidden md:block absolute inset-4 bg-white rounded-[2rem] shadow-xl rotate-1"}),(0,r.jsxs)("div",{className:"relative w-full h-full md:aspect-square md:h-auto max-h-full md:rounded-xl md:overflow-hidden md:shadow-sm md:border md:border-slate-200 bg-white",children:[eM.imageUrl?r.jsx(r.Fragment,{children:r.jsx("img",{src:eM.imageUrl,alt:`Page ${a+1}`,className:"w-full h-full object-cover relative z-10"})}):r.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-300 bg-slate-50 font-bold animate-pulse",children:"Painting Scene..."}),r.jsx("button",{className:"absolute bottom-4 right-4 p-2 bg-black/20 text-white rounded-full hover:bg-black/40 backdrop-blur-sm z-20",onClick:()=>{A(),eM.imageUrl&&b(eM.imageUrl)},children:r.jsx(ev,{size:16})})]})]}),(0,r.jsxs)("div",{className:"flex-1 w-full md:w-1/2 flex flex-col bg-white relative h-full min-h-0",children:[(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 pb-32 md:pb-8 flex flex-col items-center md:items-start text-center md:text-left scrollbar-hide",children:[(0,r.jsxs)("div",{className:"mb-4 inline-block px-3 py-1 bg-slate-50 rounded-full text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:["Page ",a+1," / ",e.pages.length]}),r.jsx("div",{className:"w-full mb-6",children:r.jsx("div",{className:"flex flex-wrap gap-x-2 md:gap-x-3 gap-y-3 md:gap-y-5 leading-loose md:leading-[2.5] justify-center md:justify-start px-2 py-4",children:Y.map((e,t)=>{let l=e.text.replace(/[^a-zA-Z0-9]/g,""),s=o.find(e=>{let t=l.toLowerCase();if(t.length<2&&"i"!==t)return!1;let s=e.word.toLowerCase();if(s===t||t===s+"s"||t===s+"es"||s===t+"s")return!0;let a=s.split(/[\s-]+/);return a.length>1&&a.some(e=>!(e.length<2)&&(t===e||t===e+"s"||t===e+"es"))}),n=s&&ec[a]?.includes(s.id),i=e.isSpecial&&!!s||!!s,d=H===t,x=t<q;return r.jsx("span",{onClick:t=>eF(t,e.text,!!i),className:`
                            relative px-2 py-1 rounded-lg transition-all duration-200
                            text-xl md:text-3xl font-medium select-none cursor-pointer
                            ${x?"opacity-100 translate-y-0 blur-0":"opacity-0 translate-y-4 blur-sm"}
                            ${d?"bg-yellow-300 text-black scale-110 shadow-[0_4px_10px_rgba(253,224,71,0.5)] ring-4 ring-yellow-200 z-10 font-black -rotate-2":"text-slate-700 hover:text-brand-blue hover:bg-slate-100"}
                            ${!d&&c?"opacity-50 blur-[0.5px] scale-95":""}
                            ${!i||d||n?"":"text-brand-blue border-b-2 md:border-b-4 border-dashed border-brand-blue/30"}
                            ${i&&n&&!d?"text-brand-green bg-green-50 border-b-2 md:border-b-4 border-brand-green":""}
                        `,children:e.text},t)})})}),eY.length>0&&(0,r.jsxs)("div",{className:"w-full mb-6 bg-slate-50 p-3 rounded-2xl border border-slate-100 flex flex-col items-center md:items-start gap-2 animate-pop-in",children:[(0,r.jsxs)("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wide flex items-center gap-1",children:[r.jsx(ek,{size:12})," Find on this page:"]}),r.jsx("div",{className:"flex gap-3 flex-wrap justify-center md:justify-start",children:eY.map(e=>{let t=ec[a]?.includes(e.id);return(0,r.jsxs)("div",{className:`flex items-center gap-2 bg-white px-2 py-1 rounded-xl border ${t?"border-brand-green/30 bg-green-50/50":"border-slate-200"}`,children:[r.jsx("div",{className:`w-8 h-8 rounded-lg overflow-hidden border ${t?"border-brand-green":"border-slate-200"} shrink-0`,children:r.jsx("img",{src:e.imageUrl,className:`w-full h-full object-cover ${t?"":"grayscale opacity-70"}`,alt:e.word})}),r.jsx("span",{className:`text-xs font-bold uppercase ${t?"text-brand-green":"text-slate-400"}`,children:e.word}),t&&r.jsx(ej,{size:14,className:"text-brand-green ml-1"})]},e.id)})})]}),r.jsx("p",{className:"text-xs text-slate-300 font-bold uppercase tracking-widest mt-4",children:"Tap any word to learn its meaning!"})]}),r.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-white/95 backdrop-blur-sm border-t border-slate-100 p-2 md:p-4 z-20 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] flex flex-col gap-3 pb-[calc(0.5rem+env(safe-area-inset-bottom))]",children:(0,r.jsxs)("div",{className:"flex items-center gap-3 w-full max-w-lg mx-auto",children:[r.jsx("button",{onClick:()=>{eL(),_(),a>0&&i(e=>e-1)},disabled:0===a,className:"p-3 md:p-4 rounded-full bg-slate-50 text-slate-400 disabled:opacity-20 hover:bg-slate-100 transition-all shrink-0",children:r.jsx(p,{size:24})}),(0,r.jsxs)("button",{onClick:()=>{eL(),_(),a<e.pages.length-1?i(e=>e+1):t()},className:`flex-1 py-3 md:py-4 rounded-full font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all ${eT?"bg-brand-green text-white hover:bg-green-600":"bg-brand-blue text-white hover:bg-blue-600"}`,children:[eT?"Finish":"Next"," ",eT?r.jsx(ej,{size:20}):r.jsx(eN,{size:20})]})]})})]})]}),h&&(0,r.jsxs)("div",{className:"fixed inset-0 z-[110] bg-black flex items-center justify-center p-0",onClick:()=>b(null),children:[r.jsx("img",{src:h,className:"w-full h-full object-contain",alt:"Zoomed"}),r.jsx("button",{className:"absolute top-4 right-4 text-white p-2 bg-white/20 rounded-full",children:r.jsx(eg,{size:24})})]})]})},ez=b("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),eM=({theme:e,onSelectMode:t})=>{let[l,s]=(0,n.useState)(null),[a,i]=(0,n.useState)("");return r.jsx("div",{className:"h-full w-full overflow-y-auto scrollbar-hide",children:(0,r.jsxs)("div",{className:"min-h-full flex flex-col items-center p-4 md:p-12 animate-pop-in pb-32",children:[(0,r.jsxs)("div",{className:"text-center mb-6 md:mb-10 shrink-0 mt-4",children:[r.jsx("h2",{className:"text-2xl md:text-4xl font-black text-slate-800 mb-2",children:"Who is the Author?"}),r.jsx("p",{className:"text-base md:text-xl text-slate-500",children:"How do you want to create your story?"})]}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 md:gap-6 w-full max-w-4xl mb-6 md:mb-10 flex-shrink-0",children:[(0,r.jsxs)("button",{onClick:()=>{C(),s("auto")},className:`flex-1 p-4 md:p-8 rounded-2xl md:rounded-3xl border-4 text-left transition-all relative overflow-hidden group flex flex-row md:flex-col items-center md:items-start gap-4 md:gap-0 ${"auto"===l?"border-brand-blue bg-blue-50 shadow-xl scale-[1.02]":"border-slate-100 bg-white hover:border-blue-200 hover:shadow-lg"}`,children:[r.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 hidden md:block",children:r.jsx(U,{size:120,className:"text-brand-blue"})}),r.jsx("div",{className:`w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center text-2xl md:text-3xl md:mb-6 transition-colors shrink-0 ${"auto"===l?"bg-brand-blue text-white":"bg-blue-100 text-brand-blue"}`,children:"✨"}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg md:text-2xl font-bold text-slate-800 mb-1 md:mb-2",children:"Magic Story"}),r.jsx("p",{className:"text-sm md:text-base text-slate-500 font-medium leading-tight",children:"Let AI write a surprise story for you using your items!"})]})]}),(0,r.jsxs)("button",{onClick:()=>{C(),s("manual")},className:`flex-1 p-4 md:p-8 rounded-2xl md:rounded-3xl border-4 text-left transition-all relative overflow-hidden group flex flex-row md:flex-col items-center md:items-start gap-4 md:gap-0 ${"manual"===l?"border-brand-purple bg-purple-50 shadow-xl scale-[1.02]":"border-slate-100 bg-white hover:border-purple-200 hover:shadow-lg"}`,children:[r.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 hidden md:block",children:r.jsx(ez,{size:120,className:"text-brand-purple"})}),r.jsx("div",{className:`w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center text-2xl md:text-3xl md:mb-6 transition-colors shrink-0 ${"manual"===l?"bg-brand-purple text-white":"bg-purple-100 text-brand-purple"}`,children:"✏️"}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg md:text-2xl font-bold text-slate-800 mb-1 md:mb-2",children:"Co-Writer"}),r.jsx("p",{className:"text-sm md:text-base text-slate-500 font-medium leading-tight",children:"You write an idea, and AI will finish the story for you."})]})]})]}),"manual"===l&&(0,r.jsxs)("div",{className:"w-full max-w-2xl bg-white p-4 md:p-6 rounded-3xl shadow-sm border-2 border-brand-purple/30 animate-pop-in mb-6 flex-shrink-0",children:[r.jsx("label",{className:"block text-slate-600 font-bold mb-2 ml-2 text-sm md:text-base",children:"Start your story here:"}),r.jsx("textarea",{value:a,onChange:e=>i(e.target.value),placeholder:"e.g., The banana wanted to fly to the moon...",className:"w-full h-24 md:h-32 p-3 md:p-4 rounded-xl bg-slate-50 border border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-brand-purple outline-none text-base md:text-lg resize-none"})]}),l&&r.jsx("div",{className:"w-full flex justify-center mt-auto animate-pop-in",children:(0,r.jsxs)("button",{onClick:()=>{R(),"auto"===l?t(void 0):t(a)},disabled:"manual"===l&&a.trim().length<3,className:"w-full md:w-auto px-8 md:px-12 py-4 md:py-5 bg-brand-green text-white rounded-full font-bold text-xl md:text-2xl shadow-xl hover:scale-105 transition-all disabled:opacity-50 disabled:scale-100 flex items-center justify-center gap-3 touch-manipulation",children:["Create Story ",r.jsx(I,{strokeWidth:3})]})})]})})},eT=b("baby",[["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M19.38 6.813A9 9 0 0 1 20.8 10.2a2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"11xh7x"}],["path",{d:"M9 12h.01",key:"157uk2"}]]),eR=b("school",[["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M18 5v16",key:"1ethyx"}],["path",{d:"m4 6 7.106-3.79a2 2 0 0 1 1.788 0L20 6",key:"zywc2d"}],["path",{d:"m6 11-3.52 2.147a1 1 0 0 0-.48.854V19a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-5a1 1 0 0 0-.48-.853L18 11",key:"1d4ql0"}],["path",{d:"M6 5v16",key:"1sn0nx"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}]]),eE=b("graduation-cap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]),eD=b("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),e_=b("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]),eO=({onComplete:e})=>{let[t,l]=(0,n.useState)("6-8"),[s,a]=(0,n.useState)("Intermediate"),i=[{val:"3-5",label:"3-5",icon:r.jsx(eT,{size:24})},{val:"6-8",label:"6-8",icon:r.jsx(eR,{size:24})},{val:"9-12",label:"9-12",icon:r.jsx(eE,{size:24})}];return r.jsx("div",{className:"h-full w-full overflow-y-auto scrollbar-hide bg-slate-50",children:(0,r.jsxs)("div",{className:"min-h-full flex flex-col items-center justify-center p-4 md:p-8 animate-pop-in pb-8",children:[(0,r.jsxs)("div",{className:"text-center mb-6 shrink-0",children:[r.jsx("h2",{className:"text-2xl font-black text-slate-800 mb-1",children:"About You"}),r.jsx("p",{className:"text-sm text-slate-500",children:"Let's set up your profile!"})]}),(0,r.jsxs)("div",{className:"w-full max-w-sm space-y-6 mb-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-1",children:[r.jsx(eD,{size:14})," Age"]}),r.jsx("div",{className:"grid grid-cols-3 gap-2",children:i.map(e=>(0,r.jsxs)("button",{onClick:()=>{C(),l(e.val)},className:`py-3 px-1 rounded-xl border-2 transition-all flex flex-col items-center gap-1 ${t===e.val?"border-brand-orange bg-white text-brand-orange shadow-md scale-[1.02]":"border-transparent bg-white text-slate-400 hover:bg-slate-100"}`,children:[r.jsx("div",{className:t===e.val?"animate-bounce-slow":"",children:e.icon}),r.jsx("span",{className:"font-bold text-sm",children:e.label})]},e.val))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-1",children:[r.jsx(e_,{size:14})," Level"]}),r.jsx("div",{className:"grid grid-cols-1 gap-2",children:[{val:"Beginner",label:"Beginner",desc:"Simple words",color:"bg-green-100 border-green-200 text-green-700"},{val:"Intermediate",label:"Intermediate",desc:"I can read",color:"bg-blue-100 border-blue-200 text-blue-700"},{val:"Advanced",label:"Advanced",desc:"Book lover",color:"bg-purple-100 border-purple-200 text-purple-700"}].map(e=>(0,r.jsxs)("button",{onClick:()=>{C(),a(e.val)},className:`p-3 rounded-xl border-2 transition-all text-left flex items-center gap-3 ${s===e.val?`${e.color.replace("bg-","bg-opacity-20 ")} border-current shadow-sm`:"bg-white border-transparent text-slate-400 hover:bg-slate-50"}`,children:[r.jsx("div",{className:`w-3 h-3 rounded-full border-2 shrink-0 ${s===e.val?"border-current bg-current":"border-slate-300"}`}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:`block font-bold text-base leading-none mb-0.5 ${s===e.val?"text-slate-800":"text-slate-500"}`,children:e.label}),r.jsx("span",{className:"text-xs opacity-70 font-medium",children:e.desc})]})]},e.val))})]})]}),(0,r.jsxs)("button",{onClick:()=>{C(),e({ageGroup:t,englishLevel:s})},className:"w-full max-w-xs py-4 bg-brand-blue text-white rounded-full font-bold text-xl shadow-lg hover:scale-105 transition-all flex items-center justify-center gap-2 animate-pop-in shrink-0 touch-manipulation",children:["Start ",r.jsx(I,{size:20,strokeWidth:3})]})]})})},eL=b("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),eU=b("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),eI=b("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),eP=b("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]),e$=({stories:e})=>{let[t,l]=(0,n.useState)("stickers"),s=(0,n.useMemo)(()=>{let t=[],l=new Set;return e.forEach(e=>{e.learnedWords&&e.learnedWords.forEach(e=>{l.has(e.id)||(t.push(e),l.add(e.id))})}),t.reverse()},[e]),a=(0,n.useMemo)(()=>V.filter(t=>t.condition(e,s.length)),[e,s]);return(0,r.jsxs)("div",{className:"h-full flex flex-col bg-slate-50 relative overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-6 md:p-8 bg-white border-b-4 border-slate-100 flex flex-col md:flex-row justify-between items-center gap-4 shrink-0 shadow-sm z-10",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-3xl md:text-4xl font-black text-brand-blue flex items-center gap-3",children:[r.jsx("div",{className:"w-12 h-12 bg-brand-yellow rounded-2xl rotate-[-6deg] flex items-center justify-center text-brand-blue shadow-sm border-2 border-brand-orange",children:r.jsx(g,{size:28,strokeWidth:3})}),"Explorer Passport"]}),r.jsx("p",{className:"text-slate-500 font-medium pl-1",children:"Track your journey and collection!"})]}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsxs)("div",{className:"bg-orange-50 border-2 border-orange-100 px-4 py-2 rounded-2xl flex flex-col items-center",children:[r.jsx("span",{className:"text-2xl font-black text-brand-orange",children:s.length}),r.jsx("span",{className:"text-xs font-bold text-orange-300 uppercase",children:"Stickers"})]}),(0,r.jsxs)("div",{className:"bg-purple-50 border-2 border-purple-100 px-4 py-2 rounded-2xl flex flex-col items-center",children:[r.jsx("span",{className:"text-2xl font-black text-brand-purple",children:a.length}),r.jsx("span",{className:"text-xs font-bold text-purple-300 uppercase",children:"Badges"})]})]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 pb-24",children:["stickers"===t&&r.jsx(r.Fragment,{children:0===s.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 opacity-50",children:[r.jsx(ek,{size:64,className:"text-slate-300 mb-4"}),r.jsx("p",{className:"text-xl font-bold text-slate-400",children:"No stickers yet!"}),r.jsx("p",{className:"text-slate-400",children:"Go on a quest to find items."})]}):r.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3 md:gap-4",children:s.map(e=>(0,r.jsxs)("div",{className:"bg-white p-2 rounded-xl shadow-sm border-2 border-slate-100 flex flex-col opacity-90",children:[r.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-slate-100 mb-1",children:r.jsx("img",{src:e.imageUrl,alt:e.word,className:"w-full h-full object-cover"})}),r.jsx("span",{className:"block text-center font-bold text-slate-400 text-xs capitalize truncate px-1",children:e.word})]},e.id))})}),"badges"===t&&r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:V.map(e=>{let t=a.find(t=>t.id===e.id);return(0,r.jsxs)("div",{className:`relative p-6 rounded-3xl border-4 flex items-center gap-4 transition-all ${t?"bg-white border-white shadow-lg":"bg-slate-100 border-slate-200 opacity-70 grayscale"}`,children:[r.jsx("div",{className:`w-20 h-20 rounded-full flex items-center justify-center text-4xl shadow-inner border-4 border-white/30 shrink-0 ${t?e.color:"bg-slate-300"}`,children:e.icon}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:`text-xl font-black ${t?"text-slate-800":"text-slate-500"}`,children:e.label}),r.jsx("p",{className:"text-sm font-bold text-slate-400 leading-tight",children:e.description}),!t&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs font-bold text-slate-400 mt-2 bg-slate-200 inline-flex px-2 py-1 rounded-full",children:[r.jsx(eL,{size:12})," LOCKED"]}),t&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs font-bold text-green-600 mt-2 bg-green-100 inline-flex px-2 py-1 rounded-full",children:[r.jsx(eU,{size:12})," UNLOCKED"]})]})]},e.id)})})]}),r.jsx("div",{className:"bg-white border-t-4 border-slate-100 shrink-0 z-20 pb-4 pt-4 px-4 rounded-t-[2rem] shadow-[0_-10px_40px_rgba(0,0,0,0.05)]",children:(0,r.jsxs)("div",{className:"flex gap-2 justify-center max-w-md mx-auto bg-slate-100 p-2 rounded-full",children:[(0,r.jsxs)("button",{onClick:()=>{C(),l("stickers")},className:`flex-1 py-3 rounded-full font-bold text-lg flex items-center justify-center gap-2 transition-all ${"stickers"===t?"bg-brand-blue text-white shadow-md":"text-slate-400 hover:bg-slate-200/50"}`,children:[r.jsx(eI,{size:20})," Sticker Album"]}),(0,r.jsxs)("button",{onClick:()=>{C(),l("badges")},className:`flex-1 py-3 rounded-full font-bold text-lg flex items-center justify-center gap-2 transition-all ${"badges"===t?"bg-brand-yellow text-brand-blue shadow-md":"text-slate-400 hover:bg-slate-200/50"}`,children:[r.jsx(eP,{size:20})," Achievements"]})]})})]})},eW=b("dumbbell",[["path",{d:"M17.596 12.768a2 2 0 1 0 2.829-2.829l-1.768-1.767a2 2 0 0 0 2.828-2.829l-2.828-2.828a2 2 0 0 0-2.829 2.828l-1.767-1.768a2 2 0 1 0-2.829 2.829z",key:"9m4mmf"}],["path",{d:"m2.5 21.5 1.4-1.4",key:"17g3f0"}],["path",{d:"m20.1 3.9 1.4-1.4",key:"1qn309"}],["path",{d:"M5.343 21.485a2 2 0 1 0 2.829-2.828l1.767 1.768a2 2 0 1 0 2.829-2.829l-6.364-6.364a2 2 0 1 0-2.829 2.829l1.768 1.767a2 2 0 0 0-2.828 2.829z",key:"1t2c92"}],["path",{d:"m9.6 14.4 4.8-4.8",key:"6umqxw"}]]),eV=b("trophy",[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]]),eq=b("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),eF=({stories:e,mastery:t,onUpdateMastery:l})=>{let[s,a]=(0,n.useState)("menu"),[o,d]=(0,n.useState)([]),[c,x]=(0,n.useState)(0),[u,m]=(0,n.useState)(!1),[h,b]=(0,n.useState)(0),[p,f]=(0,n.useState)(!1),[g,w]=(0,n.useState)(!1),[j,v]=(0,n.useState)(null),k=(0,n.useRef)(null),N=(0,n.useRef)([]),S=(0,n.useRef)(null),z=i().useMemo(()=>{let t=[],l=new Set;return e.forEach(e=>{e.learnedWords&&e.learnedWords.forEach(e=>{l.has(e.id)||(t.push(e),l.add(e.id))})}),t},[e]);(0,n.useEffect)(()=>()=>{M(),j&&URL.revokeObjectURL(j)},[c]);let M=()=>{k.current&&k.current.stream&&k.current.stream.getTracks().forEach(e=>e.stop())},T=e=>{l(o[c].id,e),e?(b(e=>e+1),R()):E(),c<o.length-1?setTimeout(()=>{m(!1),v(null),f(!1),x(e=>e+1)},500):a("menu")},D=async e=>{e.stopPropagation();try{ep.stopAll(),C();let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);k.current=t,N.current=[],t.ondataavailable=e=>{e.data.size>0&&N.current.push(e.data)},t.onstop=()=>{let e=t.mimeType||"",l=new Blob(N.current,{type:e}),s=URL.createObjectURL(l);v(s),setTimeout(()=>_(s),100)},t.start(),f(!0)}catch(e){console.error("Mic error:",e),alert("Microphone access needed for recording.")}},_=e=>{let t=e||j;if(!t)return;ep.stopAll(),S.current&&(S.current.pause(),S.current=null);let l=new Audio(t);S.current=l,w(!0),l.onended=()=>w(!1);let s=l.play();s&&s.catch(e=>console.error(e))};if(0===z.length)return(0,r.jsxs)("div",{className:"h-full flex flex-col items-center justify-center p-8 text-center opacity-60",children:[r.jsx(eW,{size:64,className:"mb-4 text-slate-300"}),r.jsx("h2",{className:"text-2xl font-bold text-slate-400",children:"Gym Closed"}),r.jsx("p",{className:"text-slate-400",children:"Go find some words first!"})]});if("menu"===s)return(0,r.jsxs)("div",{className:"h-full flex flex-col p-6 md:p-12 overflow-y-auto scrollbar-hide",children:[(0,r.jsxs)("div",{className:"text-center mb-8 shrink-0",children:[(0,r.jsxs)("h2",{className:"text-3xl md:text-4xl font-black text-brand-orange mb-2 flex items-center justify-center gap-3",children:[r.jsx(y,{size:40})," Brain Dojo"]}),r.jsx("p",{className:"text-slate-500 font-medium text-lg",children:"Train your brain and remember your words!"})]}),r.jsx("div",{className:"flex justify-center mb-10 shrink-0",children:(0,r.jsxs)("button",{onClick:()=>{C(),d([...z].sort(()=>.5-Math.random()).slice(0,5)),x(0),m(!1),b(0),a("quiz"),v(null),f(!1)},className:"w-full max-w-sm aspect-video bg-gradient-to-br from-brand-orange to-red-400 rounded-[2.5rem] shadow-xl text-white flex flex-col items-center justify-center gap-4 hover:scale-105 transition-transform border-4 border-white/20",children:[r.jsx("div",{className:"bg-white/20 p-4 rounded-full backdrop-blur-sm animate-bounce-slow",children:r.jsx(eW,{size:48})}),r.jsx("span",{className:"text-3xl font-black",children:"Start Training"}),r.jsx("span",{className:"text-white/80 font-bold bg-black/10 px-4 py-1 rounded-full",children:"5 Word Quiz"})]})}),(0,r.jsxs)("h3",{className:"text-xl font-bold text-slate-600 mb-4 flex items-center gap-2 shrink-0",children:[r.jsx(eV,{className:"text-brand-yellow"})," Mastery Progress"]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pb-20",children:z.map(e=>{let l=t[e.id]?.level||0;return(0,r.jsxs)("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4",children:[r.jsx("img",{src:e.imageUrl,className:"w-16 h-16 rounded-xl object-cover bg-slate-100",alt:e.word}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"font-bold text-slate-700 capitalize",children:e.word}),r.jsx("div",{className:"flex gap-1 mt-1",children:[1,2,3,4,5].map(e=>r.jsx(J,{size:14,className:e<=l?"fill-brand-yellow text-brand-yellow":"text-slate-200"},e))})]})]},e.id)})})]});let O=o[c];return(0,r.jsxs)("div",{className:"h-full flex flex-col bg-slate-50 relative",children:[r.jsx("div",{className:"h-2 bg-slate-200 w-full shrink-0",children:r.jsx("div",{className:"h-full bg-brand-orange transition-all duration-500",style:{width:`${c/o.length*100}%`}})}),r.jsx("div",{className:"flex-1 overflow-y-auto w-full scrollbar-hide bg-slate-50",children:(0,r.jsxs)("div",{className:"min-h-full w-full flex flex-col items-center justify-center py-8 px-4 pb-24",children:[r.jsx("div",{className:"text-center mb-6 shrink-0",children:(0,r.jsxs)("h2",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest bg-white px-4 py-1 rounded-full border border-slate-200",children:["Card ",c+1," of ",o.length]})}),r.jsx("div",{className:"group w-72 h-96 md:w-80 md:h-[28rem] perspective-1000 cursor-pointer relative shrink-0",onClick:u?void 0:()=>{A(),m(!u),u||(ep.speak(o[c].word),v(null),f(!1))},children:(0,r.jsxs)("div",{className:`relative w-full h-full duration-500 preserve-3d transition-transform ${u?"rotate-y-180":""}`,style:{transformStyle:"preserve-3d",transform:u?"rotateY(180deg)":"rotateY(0deg)"},children:[r.jsx("div",{className:"absolute inset-0 backface-hidden bg-white rounded-[2rem] shadow-xl border-8 border-white overflow-hidden flex flex-col",style:{backfaceVisibility:"hidden"},children:(0,r.jsxs)("div",{className:"flex-1 relative",children:[r.jsx("img",{src:O.imageUrl,alt:"Guess",className:"w-full h-full object-cover"}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10",children:(0,r.jsxs)("div",{className:"bg-white/90 backdrop-blur-md px-4 py-2 rounded-full shadow-lg flex items-center gap-2 animate-bounce",children:[r.jsx(es,{size:18,className:"text-slate-500"}),r.jsx("span",{className:"font-bold text-slate-600 text-sm",children:"Tap to Flip"})]})})]})}),(0,r.jsxs)("div",{className:"absolute inset-0 backface-hidden bg-white rounded-[2rem] shadow-xl border-8 border-brand-orange overflow-hidden flex flex-col rotate-y-180",style:{transform:"rotateY(180deg)",backfaceVisibility:"hidden"},children:[(0,r.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center p-3 text-center overflow-y-auto",children:[r.jsx("h3",{className:"text-3xl font-black text-slate-800 capitalize mb-1 mt-2",children:O.word}),(0,r.jsxs)("p",{className:"text-slate-500 font-medium text-sm leading-relaxed mb-4 px-1 line-clamp-3",children:['"',O.definition,'"']}),(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2 shrink-0",onClick:e=>e.stopPropagation(),children:[r.jsx("button",{onClick:()=>ep.speak(O.word),className:"p-3 bg-brand-yellow/20 text-brand-orange rounded-full hover:scale-110 transition-transform",children:r.jsx(ee,{size:24})}),(0,r.jsxs)("div",{className:"flex items-center gap-2 bg-slate-50 p-1.5 rounded-full border border-slate-200",children:[p?r.jsx("button",{onClick:e=>{e.stopPropagation(),k.current&&p&&(A(),k.current.stop(),f(!1),M())},className:"w-10 h-10 bg-red-500 rounded-full text-white animate-pulse flex items-center justify-center shadow-md",children:r.jsx(et,{size:14,fill:"currentColor"})}):r.jsx("button",{onClick:D,className:"w-10 h-10 bg-white rounded-full text-red-500 border border-red-100 flex items-center justify-center hover:bg-red-50 shadow-sm",children:r.jsx(el,{size:20})}),j&&!p&&r.jsx("button",{onClick:()=>_(),className:`w-10 h-10 rounded-full text-white flex items-center justify-center shadow-md ${g?"bg-brand-blue":"bg-blue-300"}`,children:g?r.jsx(ee,{size:16}):r.jsx(ea,{size:16,fill:"currentColor"})})]})]}),r.jsx("div",{className:"text-[9px] font-bold text-slate-300 uppercase tracking-wide shrink-0",children:p?"Recording...":j?"Listen":"Speak"})]}),(0,r.jsxs)("div",{className:"bg-orange-50 p-3 border-t-2 border-orange-100 grid grid-cols-2 gap-3 shrink-0",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("button",{onClick:()=>T(!1),className:"flex flex-col items-center justify-center gap-1 py-3 bg-white border-2 border-red-100 rounded-xl text-red-400 font-bold hover:bg-red-50 hover:border-red-200 active:scale-95 transition-all shadow-sm group",children:[r.jsx(eq,{size:24,className:"group-hover:scale-110 transition-transform"}),r.jsx("span",{className:"text-xs",children:"Retry"})]}),(0,r.jsxs)("button",{onClick:()=>T(!0),className:"flex flex-col items-center justify-center gap-1 py-3 bg-brand-green text-white rounded-xl font-bold shadow-md hover:bg-green-600 active:scale-95 transition-all group",children:[r.jsx(ej,{size:24,className:"group-hover:scale-110 transition-transform"}),r.jsx("span",{className:"text-xs",children:"Got it!"})]})]})]})]})})]})})]})},eH=b("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),eB=({words:e,onComplete:t})=>{let[l,s]=(0,n.useState)(0),[a,i]=(0,n.useState)(null),[o,d]=(0,n.useState)(null),[c,x]=(0,n.useState)(!1),u=e[l];(0,n.useEffect)(()=>{c||ep.speak(`Where is the ${u.word}?`)},[l,c,u]);let m=t=>{!0!==o&&(i(t),t===u.id?(d(!0),R(),ep.speak("That's right!"),eS()({particleCount:50,spread:60,origin:{y:.7},disableForReducedMotion:!0}),setTimeout(()=>{l<e.length-1?(s(e=>e+1),i(null),d(null)):(D(),x(!0),ep.speak("Excellent work! You found all the words!"))},2e3)):(d(!1),E(),ep.speak("Oops, try again!"),setTimeout(()=>{i(null),d(null)},1200)))};return c?(0,r.jsxs)("div",{className:"h-full flex flex-col items-center justify-center p-8 animate-pop-in text-center",children:[r.jsx("div",{className:"w-32 h-32 bg-brand-yellow rounded-full flex items-center justify-center mb-6 shadow-xl animate-bounce-slow",children:r.jsx(eV,{size:64,className:"text-brand-orange"})}),r.jsx("h2",{className:"text-4xl font-black text-brand-blue mb-4",children:"Quiz Passed!"}),r.jsx("p",{className:"text-xl text-slate-500 mb-8 max-w-md",children:"You know all the words from your story. You are a true Word Master!"}),(0,r.jsxs)("button",{onClick:()=>{C(),t()},className:"px-12 py-5 bg-brand-green text-white rounded-full font-bold text-2xl shadow-[0_8px_20px_rgba(22,163,74,0.4)] hover:scale-105 transition-all flex items-center gap-3",children:["Collect Badge & Save ",r.jsx(I,{strokeWidth:3})]})]}):(0,r.jsxs)("div",{className:"h-full flex flex-col bg-slate-50 relative overflow-hidden",children:[r.jsx("div",{className:"h-2 bg-slate-200 w-full shrink-0",children:r.jsx("div",{className:"h-full bg-brand-blue transition-all duration-500",style:{width:`${l/e.length*100}%`}})}),(0,r.jsxs)("div",{className:"p-6 md:p-8 text-center shrink-0",children:[(0,r.jsxs)("div",{className:"inline-flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow-sm border border-slate-100 mb-4",children:[r.jsx(eH,{size:16,className:"text-brand-purple"}),(0,r.jsxs)("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:["Question ",l+1," of ",e.length]})]}),(0,r.jsxs)("h2",{className:"text-3xl md:text-5xl font-black text-slate-800 mb-2",children:["Where is ",r.jsx("span",{className:"text-brand-blue underline decoration-brand-yellow decoration-4 underline-offset-4",children:u.word}),"?"]}),r.jsx("button",{onClick:()=>{C(),ep.speak(u.word)},className:"mt-2 p-3 bg-brand-orange text-white rounded-full shadow-md hover:scale-110 transition-transform",children:r.jsx(ee,{size:24})})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-8",children:r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 max-w-4xl mx-auto pb-8",children:e.map(e=>{let t=a===e.id,l=t&&!1===o,s=t&&!0===o;return(0,r.jsxs)("button",{onClick:()=>m(e.id),disabled:!0===o,className:`relative aspect-square rounded-3xl overflow-hidden border-4 shadow-sm transition-all duration-300 transform 
                                ${s?"border-brand-green ring-4 ring-green-100 scale-105 z-10":""}
                                ${l?"border-red-400 animate-pulse":""}
                                ${t||s?"":"border-white hover:border-brand-blue hover:shadow-xl hover:-translate-y-1"}
                            `,children:[r.jsx("img",{src:e.imageUrl,alt:"Option",className:`w-full h-full object-cover transition-all ${s?"brightness-110":""}`}),s&&r.jsx("div",{className:"absolute inset-0 bg-green-500/30 flex items-center justify-center animate-pop-in",children:r.jsx(ej,{size:64,className:"text-white drop-shadow-md"})}),l&&r.jsx("div",{className:"absolute inset-0 bg-red-500/30 flex items-center justify-center",children:r.jsx(eq,{size:64,className:"text-white drop-shadow-md"})})]},e.id)})})})]})},eY=b("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]),eG=({stories:e})=>{let[t,l]=(0,n.useState)(""),[s,a]=(0,n.useState)(null),[i,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(!1),[x,u]=(0,n.useState)(null),m=(0,n.useRef)(null),h=(0,n.useRef)([]),b=(0,n.useRef)(null),p=(0,n.useMemo)(()=>{let t=[],l=new Set;return e.forEach(e=>{e.learnedWords&&e.learnedWords.forEach(e=>{l.has(e.word.toLowerCase())||(t.push(e),l.add(e.word.toLowerCase()))})}),t.sort((e,t)=>e.word.localeCompare(t.word))},[e]),f=p.filter(e=>e.word.toLowerCase().includes(t.toLowerCase()));(0,n.useEffect)(()=>()=>{x&&URL.revokeObjectURL(x),g()},[s]);let g=()=>{m.current&&m.current.stream&&m.current.stream.getTracks().forEach(e=>e.stop())},w=(e,t)=>{e.stopPropagation(),ep.speak(t)},j=e=>{A(),a(e),u(null),o(!1),c(!1),ep.speak(e.word)},y=async()=>{try{ep.stopAll(),C();let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);m.current=t,h.current=[],t.ondataavailable=e=>{e.data.size>0&&h.current.push(e.data)},t.onstop=()=>{let e=t.mimeType||"",l=new Blob(h.current,{type:e}),s=URL.createObjectURL(l);u(s),setTimeout(()=>v(s),100)},t.start(),o(!0)}catch(e){console.error("Error accessing microphone:",e),alert("We need microphone permission to record your voice!")}},v=e=>{let t=e||x;if(!t)return;ep.stopAll(),b.current&&(b.current.pause(),b.current=null);let l=new Audio(t);b.current=l,c(!0),l.onended=()=>c(!1);let s=l.play();void 0!==s&&s.catch(e=>{console.error("User Audio Playback Error",e),c(!1)})};return(0,r.jsxs)("div",{className:"h-full flex flex-col bg-slate-50 relative overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-6 md:p-8 bg-white border-b border-slate-100 flex flex-col gap-4 shrink-0 shadow-sm z-10",children:[r.jsx("div",{className:"flex justify-between items-center",children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-3xl md:text-4xl font-black text-brand-blue flex items-center gap-3",children:[r.jsx("div",{className:"w-12 h-12 bg-pink-100 rounded-2xl rotate-3 flex items-center justify-center text-pink-500 shadow-sm border-2 border-pink-200",children:r.jsx(eI,{size:28,strokeWidth:3})}),"Word Cards"]}),(0,r.jsxs)("p",{className:"text-slate-500 font-medium pl-1",children:["Your collection: ",p.length," words"]})]})}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx(ek,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:20}),r.jsx("input",{type:"text",placeholder:"Search your words...",value:t,onChange:e=>l(e.target.value),className:"w-full pl-12 pr-4 py-3 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:border-brand-blue focus:ring-2 focus:ring-blue-100 outline-none transition-all font-bold text-slate-600 placeholder:text-slate-400"})]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 pb-24 scrollbar-hide",children:0===p.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-center opacity-60 mt-10",children:[r.jsx("div",{className:"w-24 h-24 bg-slate-200 rounded-full flex items-center justify-center mb-4",children:r.jsx(eY,{size:40,className:"text-slate-400"})}),r.jsx("h3",{className:"text-2xl font-bold text-slate-400 mb-2",children:"No words yet!"}),r.jsx("p",{className:"text-slate-400 max-w-xs mx-auto",children:"Start a new story to find objects and build your collection."})]}):0===f.length?(0,r.jsxs)("div",{className:"text-center py-10 text-slate-400 font-bold",children:['No words match "',t,'"']}):r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 md:gap-6",children:f.map(e=>(0,r.jsxs)("button",{onClick:()=>j(e),className:"bg-white rounded-2xl shadow-sm border-b-4 border-slate-100 hover:border-brand-blue hover:-translate-y-1 hover:shadow-lg transition-all group overflow-hidden flex flex-col",children:[(0,r.jsxs)("div",{className:"aspect-[4/3] w-full bg-slate-100 relative overflow-hidden",children:[r.jsx("img",{src:e.imageUrl,alt:e.word,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"}),r.jsx("div",{className:"absolute top-2 right-2 bg-white/90 p-1.5 rounded-full shadow-sm opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer hover:bg-brand-blue hover:text-white",onClick:t=>w(t,e.word),children:r.jsx(ee,{size:16})})]}),r.jsx("div",{className:"p-3 w-full text-center bg-white",children:r.jsx("h3",{className:"font-black text-slate-700 capitalize text-lg truncate",children:e.word})})]},e.id))})}),s&&r.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4 animate-pop-in",children:(0,r.jsxs)("div",{className:"bg-white rounded-[2.5rem] w-full max-w-sm md:max-w-md shadow-2xl relative border-8 border-white overflow-hidden flex flex-col max-h-[90dvh]",children:[r.jsx("button",{onClick:()=>{C(),a(null),u(null),o(!1),c(!1)},className:"absolute top-4 right-4 z-20 w-10 h-10 bg-black/20 hover:bg-black/40 text-white rounded-full flex items-center justify-center backdrop-blur-md transition-colors",children:r.jsx(eg,{size:24})}),(0,r.jsxs)("div",{className:"h-56 md:h-72 bg-slate-100 shrink-0 relative",children:[r.jsx("img",{src:s.imageUrl,className:"w-full h-full object-cover",alt:s.word}),r.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-6 pt-12",children:r.jsx("h2",{className:"text-4xl font-black text-white capitalize tracking-tight drop-shadow-md",children:s.word})})]}),(0,r.jsxs)("div",{className:"p-6 md:p-8 text-center flex-1 overflow-y-auto bg-[radial-gradient(#f1f5f9_1px,transparent_1px)] [background-size:16px_16px]",children:[(0,r.jsxs)("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-slate-100 mb-6 inline-block w-full",children:[r.jsx("p",{className:"text-slate-500 font-bold uppercase text-xs tracking-widest mb-1",children:"Definition"}),(0,r.jsxs)("p",{className:"text-slate-700 font-medium text-lg leading-relaxed",children:['"',s.definition,'"']})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("button",{onClick:e=>w(e,s.word),className:"w-full py-3 bg-brand-orange text-white rounded-2xl font-bold text-lg shadow-[0_4px_0_0_#c2410c] active:translate-y-1 active:shadow-none transition-all flex items-center justify-center gap-3 hover:brightness-110",children:[r.jsx(ee,{size:24})," Listen"]}),(0,r.jsxs)("div",{className:"bg-slate-100 rounded-2xl p-2 flex items-center gap-2 border border-slate-200 mt-4",children:[i?r.jsx("button",{onClick:()=>{m.current&&i&&(z(),m.current.stop(),o(!1),g())},className:"w-14 h-14 bg-red-500 text-white rounded-xl shadow-md flex items-center justify-center animate-pulse",children:r.jsx(et,{size:24,fill:"currentColor"})}):r.jsx("button",{onClick:y,className:"w-14 h-14 bg-white text-red-500 border-2 border-red-100 rounded-xl shadow-sm flex items-center justify-center hover:bg-red-50 transition-colors",children:r.jsx(el,{size:28})}),(0,r.jsxs)("div",{className:"flex-1 text-left pl-2",children:[r.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase mb-0.5",children:"Voice Studio"}),r.jsx("div",{className:"text-slate-700 font-bold flex items-center gap-2 h-6",children:i?r.jsx("span",{className:"text-red-500 animate-pulse",children:"Recording..."}):d?(0,r.jsxs)("span",{className:"text-brand-blue flex items-center gap-1",children:[r.jsx(ee,{size:16,className:"animate-bounce"})," Playing..."]}):x?(0,r.jsxs)("span",{className:"text-green-600 flex items-center gap-1",children:[r.jsx(es,{size:14})," Re-record"]}):"Tap Mic to Say it!"})]}),x&&!i&&r.jsx("button",{onClick:()=>v(),className:`w-12 h-12 rounded-full flex items-center justify-center transition-all ${d?"bg-brand-blue text-white shadow-inner":"bg-blue-100 text-brand-blue hover:bg-blue-200"}`,children:d?r.jsx(ee,{size:20}):r.jsx(ea,{size:20,fill:"currentColor"})})]})]})]})]})})]})},eQ=b("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),eZ=({stories:e,onSelectStory:t})=>(0,r.jsxs)("div",{className:"h-full flex flex-col bg-slate-50 relative overflow-hidden",children:[r.jsx("div",{className:"p-6 md:p-8 bg-white border-b-4 border-slate-100 flex flex-col md:flex-row justify-between items-center gap-4 shrink-0 shadow-sm z-10",children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-3xl md:text-4xl font-black text-brand-blue flex items-center gap-3",children:[r.jsx("div",{className:"w-12 h-12 bg-brand-purple rounded-2xl rotate-3 flex items-center justify-center text-white shadow-sm border-2 border-purple-300",children:r.jsx(e_,{size:28,strokeWidth:3})}),"My Library"]}),(0,r.jsxs)("p",{className:"text-slate-500 font-medium pl-1",children:["You have written ",e.length," stories!"]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 pb-24 scrollbar-hide",children:0===e.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-center opacity-60 mt-10",children:[r.jsx("div",{className:"w-24 h-24 bg-slate-200 rounded-full flex items-center justify-center mb-4",children:r.jsx(e_,{size:40,className:"text-slate-400"})}),r.jsx("h3",{className:"text-2xl font-bold text-slate-400 mb-2",children:"Library is Empty"}),r.jsx("p",{className:"text-slate-400 max-w-xs mx-auto",children:"Create your first story to see it here!"})]}):r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,r.jsxs)("button",{onClick:()=>{A(),t(e)},className:"bg-white rounded-[2rem] shadow-sm border-4 border-slate-100 hover:border-brand-blue hover:shadow-xl hover:-translate-y-1 transition-all group overflow-hidden flex flex-col text-left h-full",children:[(0,r.jsxs)("div",{className:"aspect-[4/3] w-full bg-slate-100 relative overflow-hidden",children:[e.pages[0]?.imageUrl?r.jsx("img",{src:e.pages[0].imageUrl,alt:e.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"}):r.jsx("div",{className:"w-full h-full flex items-center justify-center bg-blue-50 text-brand-blue font-bold",children:"No Cover"}),(0,r.jsxs)("div",{className:"absolute top-3 right-3 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-bold text-slate-500 flex items-center gap-1 shadow-sm",children:[r.jsx(j,{size:12}),new Date(e.date).toLocaleDateString()]})]}),(0,r.jsxs)("div",{className:"p-5 flex flex-col flex-1",children:[r.jsx("h3",{className:"font-black text-slate-800 text-xl mb-2 line-clamp-2 leading-tight group-hover:text-brand-blue transition-colors",children:e.title}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.wordsUsed.slice(0,3).map((e,t)=>r.jsx("span",{className:"px-2 py-1 bg-slate-50 border border-slate-200 rounded-lg text-xs font-bold text-slate-500 capitalize",children:e},t)),e.wordsUsed.length>3&&(0,r.jsxs)("span",{className:"px-2 py-1 bg-slate-50 border border-slate-200 rounded-lg text-xs font-bold text-slate-400",children:["+",e.wordsUsed.length-3]})]}),(0,r.jsxs)("div",{className:"mt-auto pt-4 border-t border-slate-50 flex justify-between items-center",children:[(0,r.jsxs)("span",{className:"text-xs font-bold text-slate-400 flex items-center gap-1",children:[r.jsx(eQ,{size:14})," Read Again"]}),r.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-50 text-brand-blue flex items-center justify-center group-hover:bg-brand-blue group-hover:text-white transition-colors",children:r.jsx(I,{size:16,strokeWidth:3})})]})]})]},e.id))})})]}),eK=()=>{let[e,t]=(0,n.useState)(!1),[l,a]=(0,n.useState)(s.HOME),[i,o]=(0,n.useState)(null),[d,c]=(0,n.useState)(null),[x,u]=(0,n.useState)(3),[m,h]=(0,n.useState)([]),[b,p]=(0,n.useState)(null),[f,g]=(0,n.useState)([]),[w,j]=(0,n.useState)({});(0,n.useEffect)(()=>{ep.stopAll()},[l,e]);let y=(e,t)=>{c(e),u(t),a(s.CAMERA_QUEST)},v=e=>{h(e),a(s.STORY_MODE_SELECT)},k=async e=>{if(!d||!i)return;a(s.STORY_SETUP);let t=await eu(m,d,i,e),l=await em(t.pages[0].text,"storybook style",t.mainCharacterVisual);l&&(t.pages[0].imageUrl=l);let r={id:Date.now().toString(),title:t.title,themeId:d.id,date:new Date().toISOString(),pages:t.pages,wordsUsed:m.map(e=>e.word),learnedWords:m};p(r),g(e=>[r,...e]),a(s.STORY_READER),N(r,t.mainCharacterVisual)},N=async(e,t)=>{let l=[...e.pages];for(let s=1;s<l.length;s++){let a=await em(l[s].text,"storybook style",t);a&&(l[s].imageUrl=a,p(e=>e?{...e,pages:l}:null),g(t=>t.map(t=>t.id===e.id?{...t,pages:l}:t)))}},C=(e,t)=>{j(l=>{let s=(l[e]||{level:0,lastReviewed:0}).level;return t&&(s=Math.min(5,s+1)),{...l,[e]:{level:s,lastReviewed:Date.now()}}})},S=e=>{p(e),a(s.STORY_READER)},A=e=>{if(!b)return;let t={...b,learnedWords:[...b.learnedWords||[],e],wordsUsed:[...b.wordsUsed||[],e.word]};p(t),g(e=>e.map(e=>e.id===t.id?t:e))};if(!e)return r.jsx(P,{onStart:()=>t(!0)});if(!i)return r.jsx(O,{onHome:()=>{},onCalendar:()=>{},onPassport:()=>{},onMemory:()=>{},onVocab:()=>{},isProfileSetup:!0,children:r.jsx(eO,{onComplete:e=>o(e)})});let z=l===s.CAMERA_QUEST||l===s.STORY_READER||l===s.STORY_QUIZ?"immersive":"standard";return r.jsx(O,{onHome:()=>a(s.HOME),onCalendar:()=>a(s.CALENDAR),onPassport:()=>a(s.PASSPORT),onMemory:()=>a(s.WORD_MEMORY),onVocab:()=>a(s.VOCAB_LIST),onBack:l!==s.HOME?()=>a(s.HOME):void 0,variant:z,children:(()=>{switch(l){case s.HOME:case s.THEME_SELECTION:return r.jsx(B,{onSelectTheme:y});case s.CAMERA_QUEST:return d?r.jsx(ef,{targetCount:x,theme:d,onComplete:v,onBack:()=>a(s.HOME)}):null;case s.STORY_MODE_SELECT:return d?r.jsx(eM,{theme:d,onSelectMode:k}):null;case s.STORY_SETUP:return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-8 animate-pulse",children:[r.jsx("div",{className:"text-6xl mb-4",children:"\uD83C\uDFA8"}),r.jsx("h2",{className:"text-2xl font-bold text-brand-blue",children:"Painting your story..."}),r.jsx("p",{className:"text-slate-400",children:"Our magic pencils are working!"})]});case s.STORY_READER:return b?r.jsx(eA,{story:b,kidProfile:i,onWordAdded:A,onFinish:()=>{a(s.STORY_QUIZ)}}):null;case s.STORY_QUIZ:return b&&b.learnedWords?r.jsx(eB,{words:b.learnedWords,onComplete:()=>a(s.PASSPORT)}):null;case s.PASSPORT:return r.jsx(e$,{stories:f});case s.VOCAB_LIST:return r.jsx(eG,{stories:f});case s.WORD_MEMORY:return r.jsx(eF,{stories:f,mastery:w,onUpdateMastery:C});case s.CALENDAR:return r.jsx(eZ,{stories:f,onSelectStory:S});default:return r.jsx(B,{onSelectTheme:y})}})()})}}};