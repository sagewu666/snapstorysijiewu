"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[291],{8291:function(e,t,l){l.r(t),l.d(t,{default:function(){return eV}});var s,r,a,n,i=l(5893),o=l(7294),d=l(1258),c=l(6215),x=l(8999),u=l(6936),m=l(3346),h=l(7089);let b=window.AudioContext||window.webkitAudioContext,p=null,f=()=>(p||(p=new b),"suspended"===p.state&&p.resume(),p),g=()=>{try{let e=f(),t=e.currentTime,l=e.createOscillator(),s=e.createGain();l.connect(s),s.connect(e.destination),l.type="sine",l.frequency.setValueAtTime(400,t),l.frequency.exponentialRampToValueAtTime(600,t+.05),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.05),l.start(t),l.stop(t+.05)}catch(e){}},w=()=>g(),j=()=>{try{let e=f(),t=e.currentTime,l=e.createOscillator(),s=e.createGain();l.connect(s),s.connect(e.destination),l.type="sine",l.frequency.setValueAtTime(300,t),l.frequency.linearRampToValueAtTime(500,t+.08),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.08),l.start(t),l.stop(t+.08)}catch(e){}},v=()=>{try{let e=f(),t=e.currentTime,l=e.createOscillator(),s=e.createGain();l.connect(s),s.connect(e.destination),l.type="sine",l.frequency.setValueAtTime(660,t),s.gain.setValueAtTime(.03,t),s.gain.exponentialRampToValueAtTime(.001,t+.6),l.start(t),l.stop(t+.6)}catch(e){}},y=()=>{try{let e=f(),t=e.currentTime,l=e.createGain();l.connect(e.destination),l.gain.setValueAtTime(.02,t),l.gain.linearRampToValueAtTime(0,t+.5),[523.25,659.25,783.99].forEach((s,r)=>{let a=e.createOscillator();a.connect(l),a.type="sine",a.frequency.value=s,a.start(t+.05*r),a.stop(t+.5)})}catch(e){}},N=()=>{try{let e=f(),t=e.currentTime,l=e.createOscillator(),s=e.createGain();l.connect(s),s.connect(e.destination),l.type="sine",l.frequency.setValueAtTime(250,t),l.frequency.linearRampToValueAtTime(100,t+.1),s.gain.setValueAtTime(.08,t),s.gain.linearRampToValueAtTime(.001,t+.1),l.start(t),l.stop(t+.1)}catch(e){}},k=()=>{try{let e=f(),t=e.currentTime,l=(l,s)=>{let r=e.createOscillator(),a=e.createGain();r.connect(a),a.connect(e.destination),r.type="sine",r.frequency.value=l,a.gain.setValueAtTime(.05,t+s),a.gain.exponentialRampToValueAtTime(.001,t+s+.4),r.start(t+s),r.stop(t+s+.4)};l(523.25,0),l(659.25,.1),l(783.99,.2),l(1046.5,.3)}catch(e){}},C=()=>{try{let e=f(),t=e.currentTime,l=e.createOscillator(),s=e.createGain();l.connect(s),s.connect(e.destination),l.type="sine",l.frequency.setValueAtTime(150,t),l.frequency.linearRampToValueAtTime(100,t+.1),s.gain.setValueAtTime(.1,t),s.gain.linearRampToValueAtTime(.001,t+.1),l.start(t),l.stop(t+.1)}catch(e){}},S=()=>k(),A=()=>{try{let e=f(),t=e.currentTime,l=e.createOscillator(),s=e.createGain();l.connect(s),s.connect(e.destination),l.type="sine",l.frequency.setValueAtTime(200,t),l.frequency.linearRampToValueAtTime(400,t+.1),s.gain.setValueAtTime(.02,t),s.gain.exponentialRampToValueAtTime(.001,t+.1),l.start(t),l.stop(t+.1)}catch(e){}},T=e=>{let{children:t,onHome:l,onCalendar:s,onPassport:r,onMemory:a,onVocab:n,onBack:o,isProfileSetup:b,variant:p="standard"}=e,f="immersive"===p;return(0,i.jsx)("div",{className:"h-[100dvh] w-full bg-slate-50 flex items-center justify-center font-sans text-slate-800 md:p-4 lg:p-6 overflow-hidden",children:(0,i.jsxs)("div",{className:"w-full h-full md:max-w-[1000px] md:h-[92dvh] bg-white md:rounded-[2rem] shadow-2xl overflow-hidden relative flex flex-col md:border-[6px] md:border-white ring-1 ring-slate-200 transition-all duration-300",children:[!f&&(0,i.jsx)("div",{className:"bg-white/95 backdrop-blur-md border-b border-slate-100 flex items-center justify-between px-3 md:px-6 shrink-0 z-40 relative pt-[env(safe-area-inset-top)] pb-1 md:pb-0 min-h-[calc(3rem+env(safe-area-inset-top))] md:min-h-0 md:h-16 box-border transition-transform",children:(0,i.jsxs)("div",{className:"flex items-center gap-2 h-10 md:h-full w-full",children:[o&&(0,i.jsx)("button",{onClick:()=>{g(),o()},className:"p-1.5 -ml-1 mr-1 rounded-full text-slate-400 hover:bg-slate-100 hover:text-brand-blue transition-colors active:scale-95",children:(0,i.jsx)(d.Z,{size:24,strokeWidth:3})}),(0,i.jsxs)("div",{className:"flex items-center gap-2 group cursor-pointer flex-1",onClick:()=>{g(),l()},children:[(0,i.jsx)("div",{className:"w-8 h-8 md:w-10 md:h-10 bg-white rounded-full overflow-hidden shadow-sm border border-slate-200 shrink-0",children:(0,i.jsx)("img",{src:"https://cdn-icons-png.flaticon.com/512/3069/3069172.png",alt:"SnapStory Panda",className:"w-full h-full object-cover"})}),(0,i.jsx)("div",{className:"flex flex-col justify-center",children:(0,i.jsx)("h1",{className:"text-base md:text-xl font-black tracking-tight text-brand-blue leading-none",children:"SnapStory"})})]}),(0,i.jsx)("div",{className:"hidden md:block ml-auto text-xs font-bold text-slate-300 uppercase tracking-widest",children:"Adventure Awaits"})]})}),(0,i.jsx)("div",{className:"flex-1 relative w-full flex flex-col min-h-0 bg-slate-50/50 overflow-hidden",children:t}),!b&&!f&&(0,i.jsxs)("div",{className:"bg-white border-t border-slate-100 px-1 py-1 shrink-0 z-50 flex justify-around items-center md:justify-center md:gap-12 shadow-[0_-4px_20px_rgba(0,0,0,0.03)] pb-[calc(0.25rem+env(safe-area-inset-bottom))] md:pb-2 relative",children:[(0,i.jsx)(z,{onClick:()=>{g(),l()},icon:(0,i.jsx)(c.Z,{size:22,strokeWidth:2.5}),label:"Home",activeColor:"text-brand-blue"}),(0,i.jsx)(z,{onClick:()=>{g(),r()},icon:(0,i.jsx)(x.Z,{size:22,strokeWidth:2.5}),label:"Passport",activeColor:"text-brand-green"}),(0,i.jsx)(z,{onClick:()=>{g(),n()},icon:(0,i.jsx)(u.Z,{size:22,strokeWidth:2.5}),label:"Words",activeColor:"text-pink-500"}),(0,i.jsx)(z,{onClick:()=>{g(),s()},icon:(0,i.jsx)(m.Z,{size:22,strokeWidth:2.5}),label:"Library",activeColor:"text-brand-purple"}),(0,i.jsx)(z,{onClick:()=>{g(),a()},icon:(0,i.jsx)(h.Z,{size:22,strokeWidth:2.5}),label:"Gym",activeColor:"text-brand-orange"})]})]})})},z=e=>{let{onClick:t,icon:l,label:s,activeColor:r}=e;return(0,i.jsxs)("button",{onClick:t,className:"flex flex-col items-center justify-center w-full md:w-auto p-1.5 md:p-2 rounded-xl transition-all active:scale-95 group",children:[(0,i.jsx)("div",{className:"p-1 rounded-lg text-slate-300 group-hover:".concat(r," transition-colors duration-200 mb-0.5"),children:l}),(0,i.jsx)("span",{className:"text-[9px] md:text-[10px] font-bold text-slate-300 uppercase tracking-wide group-hover:text-slate-500 transition-colors",children:s})]})};var R=l(3058),E=l(3989);let D=e=>{let{onStart:t}=e;return(0,i.jsxs)("div",{className:"h-[100dvh] w-full bg-gradient-to-br from-blue-400 via-blue-500 to-indigo-600 flex flex-col items-center justify-center relative overflow-hidden text-white p-6",children:[(0,i.jsx)("div",{className:"absolute top-10 left-10 text-white/20 animate-bounce-slow text-6xl",children:"☁️"}),(0,i.jsx)("div",{className:"absolute bottom-20 right-10 text-white/20 animate-pulse text-6xl",children:"✨"}),(0,i.jsx)("div",{className:"absolute top-1/4 right-1/4 w-64 h-64 bg-white/10 rounded-full blur-3xl animate-pulse"}),(0,i.jsxs)("div",{className:"relative z-10 flex flex-col items-center text-center max-w-md w-full",children:[(0,i.jsx)("div",{className:"w-32 h-32 md:w-40 md:h-40 bg-white rounded-[2.5rem] shadow-[0_20px_50px_rgba(0,0,0,0.3)] flex items-center justify-center mb-8 rotate-3 hover:rotate-6 transition-transform duration-500 border-4 border-white/50",children:(0,i.jsx)("img",{src:"https://cdn-icons-png.flaticon.com/512/3069/3069172.png",alt:"Panda",className:"w-24 h-24 md:w-32 md:h-32 object-contain"})}),(0,i.jsxs)("h1",{className:"text-5xl md:text-6xl font-black tracking-tight mb-2 drop-shadow-md",children:["Snap",(0,i.jsx)("span",{className:"text-yellow-300",children:"Story"})]}),(0,i.jsxs)("p",{className:"text-xl md:text-2xl font-medium text-blue-100 mb-10 max-w-xs leading-relaxed",children:["The magical world where",(0,i.jsx)("br",{}),(0,i.jsx)("span",{className:"font-bold text-white",children:"photos become stories!"})]}),(0,i.jsxs)("button",{onClick:()=>{g(),S(),t()},className:"w-full py-5 bg-yellow-400 text-yellow-900 rounded-full font-black text-2xl shadow-[0_6px_0_0_#b45309] active:shadow-none active:translate-y-2 transition-all flex items-center justify-center gap-3 group",children:[(0,i.jsx)(R.Z,{className:"group-hover:rotate-12 transition-transform"}),"START PLAYING",(0,i.jsx)(E.Z,{strokeWidth:4})]}),(0,i.jsx)("div",{className:"mt-8 text-sm font-bold text-blue-200 uppercase tracking-widest opacity-80",children:"For Kids Ages 3-12"})]})]})};(s=a||(a={})).HOME="HOME",s.THEME_SELECTION="THEME_SELECTION",s.CAMERA_QUEST="CAMERA_QUEST",s.VOCAB_REVIEW="VOCAB_REVIEW",s.KID_PROFILE="KID_PROFILE",s.STORY_MODE_SELECT="STORY_MODE_SELECT",s.STORY_SETUP="STORY_SETUP",s.STORY_READER="STORY_READER",s.STORY_QUIZ="STORY_QUIZ",s.CALENDAR="CALENDAR",s.PASSPORT="PASSPORT",s.WORD_MEMORY="WORD_MEMORY",s.VOCAB_LIST="VOCAB_LIST",(r=n||(n={})).COLOR="Color",r.SHAPE="Shape",r.MATERIAL="Material",r.SPACE="Space",r.FUNCTION="Function",r.SURPRISE="Surprise";let Z=[{id:"c_red",label:"Red World",category:n.COLOR,icon:"\uD83D\uDD34",description:"red things",promptContext:"The story takes place in a volcano kingdom where everything is hot and red.",color:"bg-red-500"},{id:"c_blue",label:"Blue Ocean",category:n.COLOR,icon:"\uD83D\uDD35",description:"blue things",promptContext:"The story happens underwater in a magical blue coral reef.",color:"bg-blue-500"},{id:"c_green",label:"Green Forest",category:n.COLOR,icon:"\uD83D\uDFE2",description:"green things",promptContext:"A nature adventure in a deep, whispering emerald forest.",color:"bg-green-500"},{id:"c_yellow",label:"Yellow Sunshine",category:n.COLOR,icon:"\uD83D\uDFE1",description:"yellow things",promptContext:"A happy story in a land made of sunlight, lemons, and gold.",color:"bg-yellow-400"},{id:"s_round",label:"Round Planet",category:n.SHAPE,icon:"⚪",description:"round things",promptContext:"The characters love to roll, bounce, and spin. No sharp corners allowed!",color:"bg-orange-400"},{id:"s_square",label:"Box City",category:n.SHAPE,icon:"⬛",description:"square things",promptContext:"Everything is built from sturdy blocks. A story about building and stacking.",color:"bg-indigo-500"},{id:"s_triangle",label:"Pointy Peaks",category:n.SHAPE,icon:"\uD83D\uDD3A",description:"triangle things",promptContext:"An adventure climbing sharp mountains and pointy pyramids.",color:"bg-pink-500"},{id:"m_soft",label:"Soft Cloud",category:n.MATERIAL,icon:"☁️",description:"soft things",promptContext:"A gentle bedtime story in a world made of cotton candy and clouds.",color:"bg-sky-300"},{id:"m_hard",label:"Rock Solid",category:n.MATERIAL,icon:"\uD83D\uDDFF",description:"hard things",promptContext:"A tough adventure with strong, unbreakable characters.",color:"bg-stone-500"},{id:"m_shiny",label:"Shiny Metal",category:n.MATERIAL,icon:"✨",description:"shiny things",promptContext:"A sci-fi robot adventure or a quest for sparkling treasure.",color:"bg-slate-400"},{id:"m_wood",label:"Wooden Woods",category:n.MATERIAL,icon:"\uD83E\uDEB5",description:"wooden things",promptContext:"A rustic story about carving, building, and nature spirits.",color:"bg-amber-700"},{id:"sp_kitchen",label:"Chef Quest",category:n.SPACE,icon:"\uD83C\uDF73",description:"things in the kitchen",promptContext:"A cooking adventure where ingredients come to life.",color:"bg-red-400"},{id:"sp_desk",label:"Desk Explorer",category:n.SPACE,icon:"✏️",description:"things on a desk",promptContext:"A story about stationary heroes (pencils, erasers) saving the day.",color:"bg-blue-400"},{id:"sp_bedroom",label:"Dream Land",category:n.SPACE,icon:"\uD83D\uDECC",description:"things in the bedroom",promptContext:"A magical journey that happens when the lights go out.",color:"bg-purple-400"},{id:"sp_bathroom",label:"Bubble Bath",category:n.SPACE,icon:"\uD83D\uDEC1",description:"things in the bathroom",promptContext:"A splashy adventure with bubbles, water, and rubber ducks.",color:"bg-cyan-400"},{id:"f_sound",label:"Noisy Band",category:n.FUNCTION,icon:"\uD83D\uDCE2",description:"things that make noise",promptContext:"A musical story where the objects form a rock band.",color:"bg-violet-500"},{id:"f_light",label:"Light Up",category:n.FUNCTION,icon:"\uD83D\uDCA1",description:"things that give light",promptContext:"A story about chasing away the darkness.",color:"bg-yellow-300"},{id:"f_open",label:"Open Up",category:n.FUNCTION,icon:"\uD83D\uDCE6",description:"things that open",promptContext:"A mystery story where every object hides a secret inside.",color:"bg-emerald-500"}],_=[{id:"sur_happy",label:"Happy Vibes",category:n.SURPRISE,icon:"\uD83D\uDE04",description:"things that make you smile",promptContext:"A heartwarming story about spreading joy to sad characters.",color:"bg-yellow-400"},{id:"sur_magic",label:"Magic Items",category:n.SURPRISE,icon:"\uD83E\uDE84",description:"things that look magical",promptContext:"The objects found have secret spells and wizard powers.",color:"bg-purple-600"},{id:"sur_tiny",label:"Tiny World",category:n.SURPRISE,icon:"\uD83D\uDC1C",description:"tiny things",promptContext:"The main character shrinks to the size of an ant.",color:"bg-lime-500"},{id:"sur_heavy",label:"Heavy Lifter",category:n.SURPRISE,icon:"\uD83C\uDFCB️",description:"heavy things",promptContext:"A story about giants and super strength.",color:"bg-stone-600"},{id:"sur_speed",label:"Speed Racer",category:n.SURPRISE,icon:"\uD83C\uDFCE️",description:"things that look fast",promptContext:"A high-speed racing story.",color:"bg-red-600"},{id:"sur_tool",label:"Fix It!",category:n.SURPRISE,icon:"\uD83D\uDD27",description:"tools",promptContext:"A story about fixing a broken machine.",color:"bg-orange-500"}],O=[{id:"first_snap",label:"Photographer",description:"Create your first story",icon:"\uD83D\uDCF8",color:"bg-blue-400",condition:e=>e.length>=1},{id:"novice_writer",label:"Storyteller",description:"Create 3 stories",icon:"✍️",color:"bg-purple-400",condition:e=>e.length>=3},{id:"word_collector",label:"Word Collector",description:"Collect 10 different items",icon:"\uD83C\uDF92",color:"bg-orange-400",condition:(e,t)=>t>=10},{id:"master_explorer",label:"Master Explorer",description:"Collect 25 different items",icon:"\uD83D\uDC51",color:"bg-yellow-400",condition:(e,t)=>t>=25},{id:"theme_hunter",label:"Theme Hunter",description:"Try 5 different themes",icon:"\uD83C\uDF08",color:"bg-green-400",condition:e=>new Set(e.map(e=>e.themeId)).size>=5}];var M=l(8378),I=l(9073),U=l(483);let L=e=>{let{onSelectTheme:t}=e,[l,s]=(0,o.useState)(3),[r,a]=(0,o.useState)(n.COLOR),[d,c]=(0,o.useState)(!1),[x,u]=(0,o.useState)(null),[m,h]=(0,o.useState)(!1),b=[{id:n.COLOR,label:"Colors",icon:"\uD83C\uDFA8"},{id:n.SHAPE,label:"Shapes",icon:"\uD83D\uDD3A"},{id:n.MATERIAL,label:"Materials",icon:"\uD83E\uDDF1"},{id:n.SPACE,label:"Places",icon:"\uD83C\uDFE0"},{id:n.FUNCTION,label:"Fun",icon:"\uD83C\uDF89"}],p=()=>{j(),c(!0),h(!0),u(null);let e=0,t=[...Z,..._],l=setInterval(()=>{let s=Math.floor(Math.random()*t.length);u(t[s]),++e>=15&&(clearInterval(l),u(Math.random()>.3?_[Math.floor(Math.random()*_.length)]:Z[Math.floor(Math.random()*Z.length)]),h(!1),k())},100)};return(0,i.jsxs)("div",{className:"flex flex-col h-full w-full bg-slate-50",children:[(0,i.jsxs)("div",{className:"px-3 pt-3 pb-2 md:px-6 md:pt-6 shrink-0 bg-white border-b border-slate-100 z-10 flex flex-col gap-4",children:[(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center gap-3",children:[(0,i.jsxs)("h2",{className:"text-xl md:text-3xl font-black text-brand-blue flex items-center gap-2",children:[(0,i.jsx)(M.Z,{size:24,className:"text-brand-orange",strokeWidth:3}),"Today's Mission"]}),(0,i.jsx)("div",{className:"flex bg-slate-100 p-1.5 rounded-full shadow-inner",children:[3,5,7].map(e=>(0,i.jsxs)("button",{onClick:()=>{s(e)},className:"px-4 py-2 rounded-full font-bold text-sm md:text-base transition-all flex items-center gap-1 ".concat(l===e?"bg-white text-brand-blue shadow-sm ring-1 ring-slate-200 scale-105":"text-slate-400 hover:text-slate-600"),children:[e," Items"]},e))})]}),(0,i.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide -mx-1 px-1 md:justify-center",children:b.map(e=>(0,i.jsxs)("button",{onClick:()=>{a(e.id)},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full border transition-all whitespace-nowrap ".concat(r===e.id?"bg-brand-blue text-white border-brand-blue shadow-sm":"bg-white border-slate-200 text-slate-500 hover:bg-slate-50"),children:[(0,i.jsx)("span",{className:"text-sm md:text-base",children:e.icon}),(0,i.jsx)("span",{className:"text-xs md:text-sm font-bold",children:e.label})]},e.id))})]}),(0,i.jsx)("div",{className:"flex-1 overflow-y-auto p-3 md:p-6 scrollbar-hide relative",children:(0,i.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4 pb-20",children:Z.filter(e=>e.category===r).map(e=>(0,i.jsxs)("button",{onClick:()=>{j(),t(e,l)},className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100 hover:border-brand-yellow hover:shadow-md transition-all text-left flex items-center gap-4 group relative overflow-hidden",children:[(0,i.jsx)("div",{className:"w-14 h-14 md:w-16 md:h-16 rounded-xl ".concat(e.color," bg-opacity-10 flex items-center justify-center text-3xl md:text-4xl shrink-0 group-hover:scale-110 transition-transform"),children:e.icon}),(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsx)("h3",{className:"text-base md:text-lg font-black text-slate-800 leading-tight mb-0.5 truncate group-hover:text-brand-blue transition-colors",children:e.label}),(0,i.jsxs)("p",{className:"text-xs text-slate-400 font-medium leading-tight line-clamp-2",children:["Find ",l," ",e.description,"!"]})]}),(0,i.jsx)("div",{className:"text-slate-200 group-hover:text-brand-blue group-hover:translate-x-1 transition-all",children:(0,i.jsx)(E.Z,{size:20})})]},e.id))})}),(0,i.jsx)("div",{className:"absolute bottom-4 right-4 z-30 md:bottom-6 md:right-6",children:(0,i.jsx)("button",{onClick:p,className:"w-14 h-14 md:w-16 md:h-16 bg-gradient-to-r from-brand-purple to-pink-500 rounded-full shadow-lg shadow-purple-200 flex items-center justify-center text-white animate-bounce-slow border-2 border-white hover:scale-105 active:scale-95 transition-transform",children:(0,i.jsx)(I.Z,{size:24,className:"md:w-8 md:h-8"})})}),d&&(0,i.jsx)("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,i.jsx)("div",{className:"bg-white rounded-[2rem] p-1 w-full max-w-sm shadow-2xl animate-pop-in relative",children:(0,i.jsxs)("div",{className:"bg-slate-50 p-6 rounded-[1.8rem] border border-slate-100 flex flex-col items-center text-center",children:[(0,i.jsx)("button",{className:"absolute top-4 right-4 p-2 bg-slate-200 rounded-full text-slate-500 hover:bg-slate-300",onClick:()=>{g(),c(!1)},children:"✕"}),(0,i.jsxs)("h3",{className:"text-lg font-black text-brand-purple mb-4 uppercase tracking-widest flex items-center gap-2",children:[(0,i.jsx)(R.Z,{size:20,className:"text-brand-yellow fill-current"})," Mystery Quest"]}),x?(0,i.jsxs)("div",{className:"w-full p-6 rounded-2xl mb-6 bg-white border-2 border-dashed border-slate-200 shadow-sm relative overflow-hidden",children:[m&&(0,i.jsx)("div",{className:"absolute inset-0 bg-white/60 z-10 flex items-center justify-center",children:(0,i.jsx)(P,{className:"animate-spin text-brand-blue"})}),(0,i.jsx)("div",{className:"text-6xl mb-3 drop-shadow-sm",children:x.icon}),(0,i.jsx)("h2",{className:"text-2xl font-black text-slate-800 mb-1",children:x.label}),(0,i.jsxs)("p",{className:"text-sm text-slate-500 font-medium leading-tight",children:["Find ",l," ",x.description,"!"]})]}):(0,i.jsx)("div",{className:"h-40 flex items-center justify-center",children:(0,i.jsx)(U.Z,{className:"animate-spin text-brand-blue",size:48})}),(0,i.jsxs)("div",{className:"flex gap-3 w-full",children:[(0,i.jsx)("button",{onClick:p,disabled:m,className:"flex-1 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-200 bg-slate-100 transition-colors text-sm",children:"Spin Again"}),(0,i.jsx)("button",{onClick:()=>{x&&(j(),t(x,l))},disabled:m,className:"flex-[2] py-3 bg-brand-green text-white rounded-xl font-bold text-lg shadow-[0_4px_0_0_#15803d] active:shadow-none active:translate-y-1 transition-all flex items-center justify-center gap-2",children:"Let's Go!"})]})]})})})]})},P=e=>{let{className:t}=e;return(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:(0,i.jsx)("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})})};var W=l(8865),F=l(3432),V=l(341),B=l(8655),Y=l(4976),G=l(88),H=l(2528),q=l(5727),Q=l(5227),K=l(2125),X=l(5062),J=l(7864);let $=e=>e.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,""),ee=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800;return new Promise(l=>{let s=new Image;s.src=e,s.crossOrigin="anonymous",s.onload=()=>{let r=s.width,a=s.height;r>a?r>t&&(a=Math.round(t/r*a),r=t):a>t&&(r=Math.round(t/a*r),a=t);let n=document.createElement("canvas");n.width=r,n.height=a;let i=n.getContext("2d");i?(i.fillStyle="#FFFFFF",i.fillRect(0,0,r,a),i.drawImage(s,0,0,r,a),l(n.toDataURL("image/jpeg",.7))):l(e)},s.onerror=()=>l(e)})},et=async e=>{let t=await fetch("/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw Error("Server error: ".concat(t.status," ").concat(e))}return t.json()},el=async e=>{var t;if(!e||!e.trim())return null;let l=await et({action:"generateSpeech",text:e});return null!==(t=null==l?void 0:l.audioBase64)&&void 0!==t?t:null},es=async(e,t)=>{let l=$(await ee(e,800));return await et({action:"identifyObject",imageBase64:l,theme:t})},er=async(e,t,l)=>await et({action:"lookupWord",word:e,context:t,ageGroup:l}),ea=async(e,t,l,s)=>await et({action:"generateStory",items:e,theme:t,kidProfile:l,userPrompt:s}),en=async(e,t,l)=>{var s;let r=await et({action:"generateIllustration",prompt:e,style:t,characterVisual:l});return null!==(s=null==r?void 0:r.imageBase64)&&void 0!==s?s:null},ei=async(e,t)=>{var l;let s=$(await ee(e,512)),r=await et({action:"generateSticker",imageBase64:s,word:t});return null!==(l=null==r?void 0:r.imageBase64)&&void 0!==l?l:null};class eo{static getInstance(){return eo.instance||(eo.instance=new eo),eo.instance}getAudioContext(){if(!this.audioCtx){let e=window.AudioContext||window.webkitAudioContext;this.audioCtx=new e}return this.audioCtx}stopAll(){if(this.currentPlayId++,this.currentSource){try{this.currentSource.stop(),this.currentSource.disconnect()}catch(e){}this.currentSource=null}window.speechSynthesis&&window.speechSynthesis.cancel()}playBrowserTTS(e){if(window.speechSynthesis)try{window.speechSynthesis.cancel();let t=new SpeechSynthesisUtterance(e);t.rate=.9,t.pitch=1.1;let l=window.speechSynthesis.getVoices(),s=l.find(e=>e.name.includes("Google")&&e.lang.includes("en-US")||e.lang.includes("en")&&e.name.includes("Female"))||l.find(e=>e.lang.includes("en"))||l[0];s&&(t.voice=s),window.speechSynthesis.speak(t)}catch(e){console.error("Browser TTS failed",e)}}async playGeminiAudio(e,t){if(t!==this.currentPlayId)return;let l=this.getAudioContext();"suspended"===l.state&&await l.resume();try{let s=atob(e),r=s.length,a=new Uint8Array(r);for(let e=0;e<r;e++)a[e]=s.charCodeAt(e);let n=new Float32Array(r/2),i=new DataView(a.buffer);for(let e=0;e<r/2;e++)n[e]=i.getInt16(2*e,!0)/32768;let o=l.createBuffer(1,n.length,24e3);if(o.getChannelData(0).set(n),t!==this.currentPlayId)return;window.speechSynthesis&&window.speechSynthesis.cancel();let d=l.createBufferSource();d.buffer=o,d.connect(l.destination),this.currentSource=d,d.start(),d.onended=()=>{this.currentSource===d&&(this.currentSource=null)}}catch(e){console.error("Audio Decode Error",e)}}async speak(e){if(!e)return;let t=this.getAudioContext();"suspended"===t.state&&t.resume().catch(()=>{}),this.stopAll();let l=this.currentPlayId;if(this.audioCache.has(e))try{await this.playGeminiAudio(this.audioCache.get(e),l);return}catch(e){}try{let t=new Promise((e,t)=>setTimeout(()=>t(Error("Timeout")),15e3)),s=await Promise.race([el(e),t]);if(l!==this.currentPlayId)return;if(s){this.audioCache.set(e,s),await this.playGeminiAudio(s,l);return}}catch(e){}l===this.currentPlayId&&this.playBrowserTTS(e)}constructor(){this.audioCtx=null,this.currentSource=null,this.audioCache=new Map,this.currentPlayId=0}}let ed=eo.getInstance(),ec=e=>{let{targetCount:t,theme:l,onComplete:s,onBack:r}=e,[a,n]=(0,o.useState)([]),[c,x]=(0,o.useState)(!1),[u,m]=(0,o.useState)(null),[h,b]=(0,o.useState)(null),[p,f]=(0,o.useState)(!1),[w,v]=(0,o.useState)(!1),[A,T]=(0,o.useState)(null),z=(0,o.useRef)(null),R=(0,o.useRef)(null),D=(0,o.useRef)([]),Z=(0,o.useRef)(null);(0,o.useEffect)(()=>()=>{A&&URL.revokeObjectURL(A),_()},[u]);let _=()=>{R.current&&R.current.stream&&R.current.stream.getTracks().forEach(e=>e.stop())},O=async e=>{var t;ed.getAudioContext().resume().catch(()=>{});let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!s)return;x(!0),b(null),T(null),f(!1),v(!1);let r=new FileReader;r.onloadend=async()=>{let e=r.result,t=await es(e,l);if(!t.matchesTheme){C(),x(!1),b({title:"Not Quite!",feedback:t.feedback||"That doesn't look like ".concat(l.label,"! Try again."),image:e}),M(t.feedback||"That is not ".concat(l.label,". Try again."));return}if(a.some(e=>e.word.toLowerCase()===t.word.toLowerCase())){C(),x(!1),b({title:"Already Collected!",feedback:"You already have a ".concat(t.word,"! Let's find a different ").concat(l.description,"."),image:e}),M("You already collected this card. Please snap a different ".concat(l.description,"."));return}let s={id:Date.now().toString(),word:t.word,definition:t.definition,imageUrl:e,originalImage:e,timestamp:Date.now(),visualDetail:t.visualDetail};n(e=>[...e,s]),m(s),x(!1),M("You found a ".concat(t.word,"!")),ei(e,t.word).then(e=>{if(e){y();let t={...s,imageUrl:e};n(e=>e.map(e=>e.id===s.id?t:e)),m(e=>e&&e.id===s.id?t:e)}})},r.readAsDataURL(s)},M=async e=>{ed.speak(e)},I=async()=>{try{ed.stopAll(),Z.current&&(Z.current.pause(),v(!1)),g();let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);R.current=t,D.current=[],t.ondataavailable=e=>{e.data.size>0&&D.current.push(e.data)},t.onstop=()=>{let e=t.mimeType||"",l=new Blob(D.current,{type:e}),s=URL.createObjectURL(l);T(s),setTimeout(()=>U(s),100)},t.start(),f(!0)}catch(e){console.error("Mic error:",e),alert("Microphone access needed for recording.")}},U=e=>{let t=e||A;if(!t)return;ed.stopAll(),Z.current&&(Z.current.pause(),Z.current=null);let l=new Audio(t);Z.current=l,v(!0),l.onended=()=>v(!1);let s=l.play();void 0!==s&&s.catch(e=>{console.error("Playback error",e),v(!1)})},L=e=>{N(),n(t=>t.filter(t=>t.id!==e)),(null==u?void 0:u.id)===e&&(m(null),T(null),f(!1))};return!(a.length>=t)||u||c||h?(0,i.jsxs)("div",{className:"h-full flex flex-col bg-slate-50 relative overflow-hidden",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center px-4 pt-[calc(env(safe-area-inset-top)+0.5rem)] pb-3 shrink-0 bg-white border-b border-slate-100 z-10 shadow-sm",children:[(0,i.jsx)("div",{className:"flex items-center gap-3 w-1/3",children:r&&(0,i.jsx)("button",{onClick:()=>{g(),r()},className:"p-2 bg-slate-100 rounded-full text-slate-500 hover:bg-slate-200",children:(0,i.jsx)(d.Z,{size:24})})}),(0,i.jsx)("div",{className:"flex flex-col items-center justify-center w-1/3",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-2xl",children:l.icon}),(0,i.jsx)("h2",{className:"text-sm font-bold text-slate-800 leading-tight hidden md:block",children:l.label})]})}),(0,i.jsx)("div",{className:"flex justify-end w-1/3",children:(0,i.jsxs)("div",{className:"bg-brand-orange/10 px-3 py-1 rounded-full whitespace-nowrap border border-brand-orange/20",children:[(0,i.jsx)("span",{className:"text-lg font-black text-brand-orange",children:a.length}),(0,i.jsxs)("span",{className:"text-brand-orange/50 text-sm font-bold",children:[" / ",t]})]})})]}),(0,i.jsxs)("div",{className:"flex-1 min-h-0 p-3 flex flex-col pb-[env(safe-area-inset-bottom)]",children:[(0,i.jsxs)("button",{className:"flex-1 w-full bg-slate-200 rounded-[2rem] border-4 border-dashed border-slate-300 flex flex-col items-center justify-center relative overflow-hidden transition-colors shadow-inner ".concat(c?"cursor-wait opacity-80":"cursor-pointer active:bg-slate-300 group"),onClick:()=>{c||u||(g(),z.current&&z.current.click())},disabled:c,children:[(0,i.jsx)("input",{type:"file",accept:"image/*",capture:"environment",ref:z,onChange:O,className:"hidden",disabled:c}),c?(0,i.jsxs)("div",{className:"text-center z-10 animate-pulse",children:[(0,i.jsx)(F.Z,{size:48,className:"animate-spin text-brand-blue mb-4 mx-auto"}),(0,i.jsx)("p",{className:"text-lg font-bold text-slate-600 bg-white/80 px-4 py-1 rounded-full backdrop-blur-sm",children:"Identifying..."})]}):(0,i.jsxs)("div",{className:"text-center flex flex-col items-center pointer-events-none",children:[(0,i.jsx)("div",{className:"w-24 h-24 bg-white rounded-full flex items-center justify-center shadow-lg mb-6 text-brand-blue animate-pulse",children:(0,i.jsx)(V.Z,{size:40,strokeWidth:2.5})}),(0,i.jsx)("h3",{className:"text-2xl font-black text-slate-600 tracking-tight",children:"Tap to Snap"}),(0,i.jsxs)("p",{className:"text-slate-400 font-medium mt-1",children:["Find: ",l.label]})]})]}),a.length>0&&(0,i.jsx)("div",{className:"h-20 mt-3 flex gap-2 overflow-x-auto px-1 shrink-0 scrollbar-hide items-center justify-center",children:a.map(e=>(0,i.jsxs)("div",{onClick:()=>{c||(j(),m(e))},className:"min-w-[60px] w-14 h-14 bg-white rounded-xl shadow-md border border-slate-100 relative animate-pop-in shrink-0 p-0.5 cursor-pointer",children:[(0,i.jsx)("img",{src:e.imageUrl,alt:e.word,className:"w-full h-full object-cover rounded-lg"}),(0,i.jsx)("div",{className:"absolute -top-1 -right-1 bg-green-500 text-white rounded-full p-0.5 shadow-sm border border-white",children:(0,i.jsx)(W.Z,{size:8,strokeWidth:4})})]},e.id))})]}),h&&(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-6 animate-shake",children:(0,i.jsxs)("div",{className:"bg-white rounded-[2.5rem] w-full max-w-sm shadow-2xl relative flex flex-col items-center p-8 text-center border-8 border-red-50",children:[(0,i.jsx)("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-6 text-red-500 shrink-0",children:(0,i.jsx)(B.Z,{size:40,strokeWidth:3})}),(0,i.jsx)("h2",{className:"text-3xl font-black text-slate-800 mb-2",children:h.title||"Not Quite!"}),(0,i.jsx)("div",{className:"w-24 h-24 rounded-2xl overflow-hidden border-4 border-white shadow-lg mb-6 rotate-2 bg-slate-100",children:(0,i.jsx)("img",{src:h.image,className:"w-full h-full object-cover",alt:"Captured item"})}),(0,i.jsx)("div",{className:"bg-red-50 p-4 rounded-2xl w-full border border-red-100 mb-8",children:(0,i.jsxs)("p",{className:"text-red-600 font-bold text-xl leading-snug",children:['"',h.feedback,'"']})}),(0,i.jsxs)("button",{onClick:()=>{g(),b(null)},className:"w-full py-4 bg-brand-orange text-white rounded-2xl font-bold text-xl shadow-[0_6px_0_0_#c2410c] active:translate-y-1 active:shadow-none transition-all flex items-center justify-center gap-2",children:[(0,i.jsx)(Y.Z,{size:24})," Try Again"]})]})}),u&&(0,i.jsx)("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4 animate-pop-in",children:(0,i.jsxs)("div",{className:"bg-white rounded-[2.5rem] w-full max-w-xs md:max-w-sm overflow-hidden shadow-2xl relative flex flex-col max-h-[90dvh] border-8 border-white",children:[(0,i.jsxs)("div",{className:"h-56 bg-slate-100 relative shrink-0 transition-all duration-500 group overflow-hidden",children:[(0,i.jsx)("img",{src:u.imageUrl,className:"w-full h-full object-cover transition-all duration-700",alt:"Captured"}),u.imageUrl!==u.originalImage&&(0,i.jsxs)("div",{className:"absolute top-2 left-2 bg-white/90 text-brand-purple px-2 py-1 rounded-full text-[10px] font-bold shadow-sm flex items-center gap-1 animate-pop-in z-20",children:[(0,i.jsx)(G.Z,{size:10,fill:"currentColor"})," Sticker Magic"]}),(0,i.jsx)("button",{onClick:()=>{g(),M(u.word)},className:"absolute bottom-4 right-4 p-3 bg-brand-yellow rounded-full text-brand-blue shadow-lg hover:scale-110 transition-transform z-20",children:(0,i.jsx)(H.Z,{size:24})})]}),(0,i.jsxs)("div",{className:"p-4 md:p-6 text-center flex flex-col items-center overflow-y-auto flex-1",children:[(0,i.jsx)("h2",{className:"text-3xl font-black text-brand-blue capitalize mb-1 tracking-tight",children:u.word}),(0,i.jsxs)("p",{className:"text-slate-600 font-medium text-sm leading-relaxed mb-4 bg-slate-50 p-3 rounded-2xl w-full border border-slate-100",children:['"',u.definition,'"']}),(0,i.jsxs)("div",{className:"bg-slate-100 rounded-2xl p-2 flex items-center gap-2 border border-slate-200 mb-4 w-full",children:[p?(0,i.jsx)("button",{onClick:()=>{R.current&&p&&(j(),R.current.stop(),f(!1),_())},className:"w-12 h-12 bg-red-500 text-white rounded-xl shadow-md flex items-center justify-center animate-pulse shrink-0",children:(0,i.jsx)(q.Z,{size:20,fill:"currentColor"})}):(0,i.jsx)("button",{onClick:I,className:"w-12 h-12 bg-white text-red-500 border-2 border-red-100 rounded-xl shadow-sm flex items-center justify-center hover:bg-red-50 transition-colors shrink-0",children:(0,i.jsx)(Q.Z,{size:24})}),(0,i.jsxs)("div",{className:"flex-1 text-left pl-1 min-w-0",children:[(0,i.jsx)("div",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Voice Studio"}),(0,i.jsx)("div",{className:"text-slate-700 font-bold flex items-center gap-1 text-sm truncate",children:p?(0,i.jsx)("span",{className:"text-red-500 animate-pulse",children:"Recording..."}):w?(0,i.jsxs)("span",{className:"text-brand-blue flex items-center gap-1",children:[(0,i.jsx)(H.Z,{size:14,className:"animate-bounce"})," Playing..."]}):A?(0,i.jsxs)("span",{className:"text-green-600 flex items-center gap-1 truncate",children:[(0,i.jsx)(K.Z,{size:12})," Re-record"]}):"Tap Mic to Say it!"})]}),A&&!p&&(0,i.jsx)("button",{onClick:()=>{g(),U()},className:"w-10 h-10 rounded-full flex items-center justify-center transition-all shrink-0 ".concat(w?"bg-brand-blue text-white shadow-inner":"bg-blue-100 text-brand-blue hover:bg-blue-200"),children:w?(0,i.jsx)(H.Z,{size:16}):(0,i.jsx)(X.Z,{size:16,fill:"currentColor"})})]}),(0,i.jsxs)("div",{className:"flex gap-3 w-full mt-auto",children:[(0,i.jsx)("button",{onClick:()=>L(u.id),className:"p-4 bg-red-50 text-red-500 rounded-2xl font-bold hover:bg-red-100 transition-colors border border-red-100",children:(0,i.jsx)(J.Z,{size:24})}),(0,i.jsxs)("button",{onClick:()=>{k(),m(null),T(null),f(!1)},className:"flex-1 py-4 bg-brand-green text-white rounded-2xl font-bold text-xl shadow-[0_4px_0_0_#166534] active:shadow-none active:translate-y-1 transition-all flex items-center justify-center gap-2",children:["Keep It! ",(0,i.jsx)(W.Z,{size:24,strokeWidth:3})]})]})]})]})})]}):(0,i.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-center p-8 animate-pop-in bg-slate-50 pt-[env(safe-area-inset-top)]",children:[(0,i.jsx)("div",{className:"w-24 h-24 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-6 shadow-sm",children:(0,i.jsx)(W.Z,{size:48,strokeWidth:4})}),(0,i.jsx)("h2",{className:"text-3xl font-bold text-slate-800 mb-4",children:"Quest Complete!"}),(0,i.jsxs)("p",{className:"text-lg text-slate-500 mb-8",children:["You found all ",t," items!"]}),(0,i.jsxs)("button",{onClick:()=>{S(),s(a)},className:"px-8 py-4 bg-brand-blue text-white rounded-full font-bold text-xl shadow-xl hover:scale-105 transition-transform flex items-center gap-3",children:["Create Story ",(0,i.jsx)(E.Z,{})]})]})};var ex=l(2190),eu=l(8760),em=l(3050),eh=l(4101),eb=l(1455),ep=l(6127),ef=l(4307),eg=l(9883);let ew=e=>{var t,l;let{story:s,onFinish:r,kidProfile:a,onWordAdded:n}=e,[c,x]=(0,o.useState)(0),[u,m]=(0,o.useState)(s.learnedWords||[]),[h,b]=(0,o.useState)(!1),[p,f]=(0,o.useState)(!1),[N,S]=(0,o.useState)(null),[T,z]=(0,o.useState)(0),[E,D]=(0,o.useState)(new Set),[Z,_]=(0,o.useState)(null),[O,M]=(0,o.useState)({isOpen:!1,word:"",loading:!1,data:null,isAdding:!1,generatedImage:null}),[I,U]=(0,o.useState)(!1),[L,P]=(0,o.useState)(!1),[W,V]=(0,o.useState)(null),B=(0,o.useRef)(null),Y=(0,o.useRef)([]),K=(0,o.useRef)(null),[J,$]=(0,o.useState)(0),[ee,et]=(0,o.useState)(null),[es,ea]=(0,o.useState)([]),[ei,eo]=(0,o.useState)(!1),[ec,ew]=(0,o.useState)([]),[ej,ev]=(0,o.useState)([]),[ey,eN]=(0,o.useState)("idle"),[ek,eC]=(0,o.useState)({}),[eS,eA]=(0,o.useState)({x:0,y:0,show:!1}),eT=(0,o.useRef)(null),ez=(0,o.useRef)(null),eR=(0,o.useRef)(!0),eE=(0,o.useRef)(0),eD=s.pages[c],eZ=c===s.pages.length-1,e_=(0,o.useMemo)(()=>"9-12"===a.ageGroup||"Advanced"===a.englishLevel,[a]);(0,o.useEffect)(()=>(eR.current=!0,()=>{eR.current=!1,eL(),eO()}),[]),(0,o.useEffect)(()=>{eE.current=c},[c]),(0,o.useEffect)(()=>{O.isOpen||Z||(eO(),V(null),U(!1))},[O.isOpen,Z]);let eO=()=>{B.current&&B.current.stream&&B.current.stream.getTracks().forEach(e=>e.stop())},eM=async()=>{try{ed.stopAll(),g();let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);B.current=t,Y.current=[],t.ondataavailable=e=>{e.data.size>0&&Y.current.push(e.data)},t.onstop=()=>{let e=t.mimeType||"",l=new Blob(Y.current,{type:e}),s=URL.createObjectURL(l);V(s),setTimeout(()=>eU(s),100)},t.start(),U(!0)}catch(e){console.error("Mic error:",e),alert("Microphone access needed for recording.")}},eI=()=>{B.current&&I&&(j(),B.current.stop(),U(!1),eO())},eU=e=>{let t=e||W;if(!t)return;ed.stopAll(),K.current&&(K.current.pause(),K.current=null);let l=new Audio(t);K.current=l,P(!0),l.onended=()=>P(!1);let s=l.play();s&&s.catch(e=>console.error(e))},eL=()=>{if(ed.stopAll(),eT.current){try{eT.current.stop(),eT.current.disconnect()}catch(e){}eT.current=null}ez.current&&(cancelAnimationFrame(ez.current),ez.current=null),b(!1),f(!1),et(null)},eP=async(e,t)=>{if(eR.current&&eE.current===c){eL();try{let l=ed.getAudioContext();"suspended"===l.state&&await l.resume();let s=atob(e),r=s.length,a=new Uint8Array(r);for(let e=0;e<r;e++)a[e]=s.charCodeAt(e);let n=new Float32Array(r/2),i=new DataView(a.buffer);for(let e=0;e<r/2;e++)n[e]=i.getInt16(2*e,!0)/32768;let o=l.createBuffer(1,n.length,24e3);if(o.getChannelData(0).set(n),eE.current!==c)return;let d=l.createBufferSource();d.buffer=o,d.connect(l.destination);let x=t.reduce((e,t)=>e+t.clean.length,0),u=l.currentTime,m=o.duration,h=()=>{if(!eR.current||eE.current!==c)return;let e=l.currentTime-u;if(e>=m){et(null),b(!1);return}let s=Math.floor(e/m*x),r=0,a=-1;for(let e=0;e<t.length;e++){let l=t[e].clean.length;if(s>=r&&s<r+l){a=e;break}r+=l}-1!==a&&et(a),ez.current=requestAnimationFrame(h)};ez.current=requestAnimationFrame(h),d.onended=()=>{eR.current&&(b(!1),ez.current&&cancelAnimationFrame(ez.current),et(null))},eT.current=d,d.start(),b(!0)}catch(l){console.error("Audio Playback Error",l),b(!1);let e=t.map(e=>e.clean).join(" ");ed.playBrowserTTS(e)}}};(0,o.useEffect)(()=>{let e=eD.text.split(/\s+/).map(e=>{let t=e.includes("*"),l=e.replace(/\*/g,""),s=l.replace(/[^a-zA-Z0-9']/g,"");return{text:l,clean:s,raw:e,isSpecial:t}});ea(e),et(null),$(0);let t=0,l=setInterval(()=>{eR.current&&($(++t),t>=e.length&&clearInterval(l))},100);return()=>clearInterval(l)},[eD]),(0,o.useEffect)(()=>{eL(),eA({x:0,y:0,show:!1})},[c]);let eW=e=>{j();let t=e.replace(/[^a-zA-Z]/g,"").toUpperCase().split("");ew(t.map((e,t)=>({id:t,char:e})).sort(()=>Math.random()-.5)),ev(Array(t.length).fill(null)),eN("idle"),eo(!0),e_&&eY(e)},eF=()=>{g(),Z&&(eN("idle"),eW(Z.word))},eV=e=>{if("correct"===ey||"hint"===ey)return;g();let t=ej.findIndex(e=>null===e);if(-1!==t){let l=[...ej];l[t]=e.char,ev(l),ew(t=>t.filter(t=>t.id!==e.id))}},eB=()=>{if("correct"===ey||"hint"===ey)return;g();let e=-1;for(let t=ej.length-1;t>=0;t--)if(null!==ej[t]){e=t;break}if(-1!==e){let t=ej[e];if(!t)return;let l=[...ej];l[e]=null,ev(l),ew(e=>[...e,{id:Date.now(),char:t}])}},eY=async e=>{await ed.speak(e)},eG=async()=>{if(w(),h||p){eL();return}eL(),f(!0);try{let e=eD.text.replace(/\*/g,""),t=new Promise((e,t)=>setTimeout(()=>t(Error("Timeout")),15e3)),l=await Promise.race([el(e),t]);if(eE.current!==c){f(!1);return}f(!1),eR.current&&(l?eP(l,es):ed.playBrowserTTS(e))}catch(e){console.error("Narration error",e),eR.current&&eE.current===c&&(f(!1),ed.playBrowserTTS(eD.text.replace(/\*/g,"")))}},eH=async(e,t,l)=>{e.stopPropagation();let s=t.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"");if(s.length<2&&"i"!==s.toLowerCase())return;let r=u.find(e=>{let t=s.toLowerCase(),l=e.word.toLowerCase();if(t===l||t===l+"s"||t===l+"es"||l===t+"s")return!0;let r=l.split(/[\s-]+/);return r.length>1&&r.some(e=>!(e.length<2)&&(t===e||t===e+"s"||t===e+"es"))});if(r){var n;(null===(n=ek[c])||void 0===n?void 0:n.includes(r.id))||(eC(e=>({...e,[c]:[...e[c]||[],r.id]})),v(),(0,eg.Z)({particleCount:30,spread:40,origin:{x:e.clientX/window.innerWidth,y:e.clientY/window.innerHeight}}))}if(l)r&&(j(),eY(r.word),V(null),U(!1),eA({x:e.clientX,y:e.clientY,show:!0}),setTimeout(()=>{eR.current&&(eA(e=>({...e,show:!1})),_(r),eo(!1))},1e3));else{j(),eL(),V(null),U(!1),P(!1),M({isOpen:!0,word:s,loading:!0,data:null,isAdding:!1,generatedImage:null}),eY(s);let e=await er(s,eD.text,a.ageGroup);if(!eR.current)return;let t=null;e.visualDetail&&(t=await en(e.visualDetail,"icon sticker style, simple, white background, cute vector art","cartoon")),eR.current&&M(l=>({...l,loading:!1,data:e,generatedImage:t}))}},eq=async()=>{if(O.word&&O.data){y(),M(e=>({...e,isAdding:!0}));try{let e=O.generatedImage||"https://cdn-icons-png.flaticon.com/512/3574/3574069.png",t={id:Date.now().toString(),word:O.word,definition:O.data.definition,imageUrl:e,originalImage:e,timestamp:Date.now(),visualDetail:O.data.visualDetail};n(t),m(e=>[...e,t]),eC(e=>({...e,[c]:[...e[c]||[],t.id]})),k(),(0,eg.Z)({particleCount:50,spread:60,origin:{y:.6}}),M(e=>({...e,isAdding:!1}))}catch(e){console.error(e),C(),M(e=>({...e,isAdding:!1}))}}},eQ=()=>{g(),M(e=>({...e,isOpen:!1})),V(null),U(!1)},eK=(0,o.useMemo)(()=>u?u.filter(e=>{let t=e.word.toLowerCase().split(/[\s-]+/),l=eD.text.toLowerCase();return t.some(e=>{if(e.length<2&&t.length>1)return!1;try{return RegExp("\\b".concat(e,"(s|es)?\\b"),"i").test(l)}catch(e){return!1}})}):[],[eD,u]);return(0,i.jsxs)("div",{className:"h-full w-full flex flex-col bg-white md:bg-transparent relative",children:[eS.show&&(0,i.jsx)("div",{className:"fixed z-[100] pointer-events-none",style:{left:eS.x,top:eS.y,transform:"translate(-50%, -50%)"},children:(0,i.jsx)("div",{className:"text-6xl md:text-8xl drop-shadow-2xl animate-grab-pop",children:"✋"})}),O.isOpen&&(0,i.jsx)("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4 animate-pop-in",children:(0,i.jsxs)("div",{className:"bg-white rounded-[2.5rem] w-full max-w-sm shadow-2xl relative border-8 border-white ring-4 ring-brand-purple flex flex-col overflow-hidden pt-[env(safe-area-inset-top)]",children:[(0,i.jsx)("button",{onClick:eQ,className:"absolute top-4 right-4 bg-slate-100 p-2 rounded-full hover:bg-slate-200 z-10",children:(0,i.jsx)(ex.Z,{size:20,className:"text-slate-500"})}),(0,i.jsx)("div",{className:"bg-purple-50 p-6 text-center border-b border-purple-100 flex flex-col items-center",children:O.loading?(0,i.jsx)("div",{className:"h-20 flex items-center justify-center",children:(0,i.jsx)(F.Z,{className:"animate-spin text-brand-purple",size:40})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"w-32 h-32 rounded-2xl overflow-hidden border-4 border-white shadow-lg rotate-3 mb-4 animate-pop-in bg-white",children:O.generatedImage?(0,i.jsx)("img",{src:O.generatedImage,className:"w-full h-full object-cover",alt:"New Sticker"}):(0,i.jsx)("div",{className:"w-full h-full flex items-center justify-center text-purple-200",children:(0,i.jsx)(eu.Z,{size:40})})}),(0,i.jsx)("h2",{className:"text-2xl font-black text-brand-purple capitalize tracking-tight mb-2",children:O.word}),(0,i.jsxs)("button",{onClick:()=>eY(O.word),className:"bg-white px-4 py-2 rounded-full shadow-sm flex items-center gap-2 text-brand-purple font-bold hover:scale-105 transition-transform mb-2",children:[(0,i.jsx)(H.Z,{size:20})," Listen"]}),(0,i.jsxs)("div",{className:"flex items-center gap-2 bg-white/50 p-1.5 rounded-full border border-purple-100",children:[I?(0,i.jsx)("button",{onClick:eI,className:"w-10 h-10 bg-red-500 rounded-full text-white animate-pulse flex items-center justify-center",children:(0,i.jsx)(q.Z,{size:16,fill:"currentColor"})}):(0,i.jsx)("button",{onClick:eM,className:"w-10 h-10 bg-white rounded-full text-red-500 border border-red-100 flex items-center justify-center hover:bg-red-50",children:(0,i.jsx)(Q.Z,{size:20})}),W&&!I&&(0,i.jsx)("button",{onClick:()=>eU(),className:"w-10 h-10 rounded-full text-white flex items-center justify-center ".concat(L?"bg-brand-blue":"bg-blue-300"),children:L?(0,i.jsx)(H.Z,{size:16}):(0,i.jsx)(X.Z,{size:16,fill:"currentColor"})}),(0,i.jsx)("span",{className:"text-xs font-bold text-slate-400 px-2",children:I?"Recording...":W?"Replay":"Try saying it!"})]})]})}),(0,i.jsx)("div",{className:"p-6 flex-1 bg-white",children:O.loading?(0,i.jsxs)("div",{className:"space-y-3 animate-pulse",children:[(0,i.jsx)("div",{className:"h-4 bg-slate-100 rounded w-3/4 mx-auto"}),(0,i.jsx)("div",{className:"h-4 bg-slate-100 rounded w-1/2 mx-auto"})]}):u.some(e=>e.word.toLowerCase()===O.word.toLowerCase())||!1===O.isAdding&&O.generatedImage&&null===O.data?(0,i.jsxs)("div",{className:"text-center animate-pop-in",children:[(0,i.jsx)("p",{className:"text-lg text-slate-500 font-medium mb-6",children:"It has been saved to your sticker cabinet."}),(0,i.jsxs)("button",{onClick:eQ,className:"w-full py-4 bg-brand-blue text-white rounded-2xl font-bold text-lg shadow-lg hover:scale-105 transition-transform flex items-center justify-center gap-2",children:["Awesome! ",(0,i.jsx)(em.Z,{})]})]}):(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsxs)("p",{className:"text-xl font-medium text-slate-700 leading-relaxed mb-6",children:['"',null===(t=O.data)||void 0===t?void 0:t.definition,'"']}),(0,i.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-xl border border-yellow-200 text-sm font-bold text-slate-600 mb-6 flex gap-2 items-start text-left",children:[(0,i.jsx)("span",{className:"text-xl",children:"\uD83D\uDCA1"}),(0,i.jsx)("span",{children:null===(l=O.data)||void 0===l?void 0:l.funFact})]}),(0,i.jsx)("button",{onClick:eq,disabled:O.isAdding,className:"w-full py-4 bg-brand-green text-white rounded-2xl font-bold text-lg shadow-[0_4px_0_0_#15803d] active:shadow-none active:translate-y-1 transition-all flex items-center justify-center gap-2 disabled:opacity-70 disabled:translate-y-0",children:O.isAdding?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(F.Z,{className:"animate-spin"})," Painting Sticker..."]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eu.Z,{size:24,strokeWidth:3})," Add to Library"]})})]})})]})}),Z&&(0,i.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4 animate-pop-in",children:(0,i.jsxs)("div",{className:"bg-white rounded-3xl w-full max-w-2xl shadow-2xl relative border-4 border-white ring-4 ring-brand-blue flex flex-col max-h-[90dvh] overflow-hidden pt-[env(safe-area-inset-top)]",children:[(0,i.jsxs)("div",{className:"bg-blue-50 p-3 flex justify-between items-center border-b border-blue-100 shrink-0",children:[(0,i.jsxs)("h2",{className:"text-lg font-black text-brand-blue uppercase tracking-wider flex items-center gap-2",children:[(0,i.jsx)(R.Z,{size:20})," Spell It"]}),(0,i.jsx)("button",{onClick:()=>_(null),className:"p-2 bg-white rounded-full text-slate-400 hover:bg-red-50 hover:text-red-500",children:(0,i.jsx)(ex.Z,{size:20})})]}),(0,i.jsxs)("div",{className:"p-4 md:p-8 overflow-y-auto flex-1 flex flex-col items-center",children:[(0,i.jsxs)("div",{className:"w-32 h-32 md:w-56 md:h-56 bg-slate-100 rounded-2xl mb-4 md:mb-6 shadow-inner relative overflow-hidden shrink-0 border-4 border-slate-50",children:[(0,i.jsx)("img",{src:Z.imageUrl,className:"w-full h-full object-cover",alt:"Spell this"}),(0,i.jsx)("button",{onClick:()=>eY(Z.word),className:"absolute bottom-2 right-2 p-2 bg-white rounded-full text-brand-orange shadow-md hover:scale-110 active:scale-95 transition-all",children:(0,i.jsx)(H.Z,{size:20})})]}),ei?(0,i.jsxs)("div",{className:"w-full flex flex-col items-center",children:[(0,i.jsx)("div",{className:"mb-4 md:mb-6 flex gap-1",children:e_?Z.word.split("").map((e,t)=>(0,i.jsx)("div",{className:"w-3 h-1 bg-slate-200 rounded-full mx-0.5"},t)):(0,i.jsx)("span",{className:"font-black text-2xl md:text-3xl text-slate-200 tracking-[0.2em] uppercase",children:Z.word})}),(0,i.jsx)("div",{className:"flex flex-nowrap justify-center gap-1 md:gap-2 mb-6 w-full px-1",children:ej.map((e,t)=>(0,i.jsx)("div",{onClick:eB,className:"flex-1 max-w-[3rem] md:max-w-[4rem] aspect-[3/4] rounded-lg md:rounded-xl border-b-4 flex items-center justify-center font-black cursor-pointer transition-all ".concat(Z.word.length>6?"text-xl md:text-3xl":"text-3xl md:text-5xl"," ").concat("wrong"===ey?"animate-shake border-red-200 bg-red-50 text-red-500":""," ").concat("correct"===ey?"border-brand-green bg-green-100 text-brand-green scale-110":""," ").concat("hint"===ey?"border-orange-200 bg-orange-50 text-brand-orange opacity-80":""," ").concat(e||"idle"!==ey?"":"bg-slate-50 border-slate-200"," ").concat(e&&"idle"===ey?"bg-white border-brand-blue text-brand-blue shadow-sm":""),children:e},t))}),"correct"===ey?(0,i.jsxs)("div",{className:"animate-pop-in text-center w-full",children:[(0,i.jsx)("h3",{className:"text-2xl md:text-3xl font-black text-brand-green mb-4",children:"Awesome!"}),(0,i.jsxs)("button",{onClick:()=>{j(),_(null),eo(!1)},className:"w-full py-3 bg-brand-green text-white rounded-full font-bold text-lg md:text-xl shadow-lg hover:scale-105 transition-transform flex items-center justify-center gap-2",children:[(0,i.jsx)(G.Z,{className:"fill-yellow-300 text-yellow-300"})," Done"]})]}):"hint"===ey?(0,i.jsx)("div",{className:"animate-pop-in text-center text-brand-orange font-bold text-lg mb-4",children:"Watch closely..."}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"flex flex-wrap justify-center gap-2 mb-6",children:ec.map(e=>(0,i.jsx)("button",{onClick:()=>eV(e),className:"w-10 h-10 md:w-14 md:h-14 bg-white rounded-lg md:rounded-xl shadow-sm border border-slate-200 text-xl md:text-2xl font-black text-slate-700 active:scale-95 active:bg-slate-100 transition-all flex items-center justify-center",children:e.char},e.id))}),(0,i.jsxs)("div",{className:"flex gap-3 w-full mt-auto",children:[(0,i.jsx)("button",{onClick:eF,className:"p-3 md:p-4 rounded-xl bg-slate-100 text-slate-500 hover:bg-slate-200",children:(0,i.jsx)(R.Z,{size:20})}),(0,i.jsx)("button",{onClick:()=>{if(!Z)return;g();let e=Z.word.replace(/[^a-zA-Z]/g,"").toUpperCase();ej.join("")===e?(eN("correct"),k(),(0,eg.Z)({particleCount:100,spread:70,origin:{y:.6},zIndex:9999}),eY("Correct! "+Z.word),E.has(Z.id)||(D(e=>new Set(e).add(Z.id)),z(e=>e+1))):(eN("wrong"),C(),eN("hint"),ev(e.split("")),setTimeout(()=>eF(),2e3))},disabled:ej.includes(null),className:"flex-1 py-3 md:py-4 bg-brand-blue text-white rounded-xl font-bold text-lg md:text-xl shadow-[0_4px_0_0_#2563eb] active:translate-y-1 active:shadow-none transition-all disabled:opacity-50 disabled:shadow-none disabled:translate-y-1",children:"Check"})]})]})]}):(0,i.jsxs)("div",{className:"text-center w-full flex flex-col items-center",children:[(0,i.jsx)("h3",{className:"text-3xl md:text-5xl font-black text-slate-800 capitalize mb-2",children:Z.word}),(0,i.jsxs)("p",{className:"text-slate-500 font-medium text-base md:text-lg mb-4",children:['"',Z.definition,'"']}),(0,i.jsxs)("div",{className:"flex items-center gap-3 bg-blue-50 p-2 rounded-full border border-blue-100 mb-6",children:[I?(0,i.jsx)("button",{onClick:eI,className:"w-12 h-12 bg-red-500 rounded-full text-white animate-pulse flex items-center justify-center shadow-sm",children:(0,i.jsx)(q.Z,{size:16,fill:"currentColor"})}):(0,i.jsx)("button",{onClick:eM,className:"w-12 h-12 bg-white rounded-full text-red-500 border border-red-100 flex items-center justify-center hover:bg-red-50 shadow-sm",children:(0,i.jsx)(Q.Z,{size:24})}),(0,i.jsxs)("div",{className:"flex flex-col items-start px-2",children:[(0,i.jsx)("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wide",children:"Voice Studio"}),(0,i.jsx)("span",{className:"text-sm font-bold text-brand-blue",children:I?"Recording...":W?"Great job!":"Practice Saying It"})]}),W&&!I&&(0,i.jsx)("button",{onClick:()=>eU(),className:"w-12 h-12 rounded-full text-white flex items-center justify-center shadow-sm ".concat(L?"bg-brand-blue":"bg-blue-300"),children:L?(0,i.jsx)(H.Z,{size:20}):(0,i.jsx)(X.Z,{size:20,fill:"currentColor"})})]}),(0,i.jsxs)("button",{onClick:()=>eW(Z.word),className:"w-full py-3 md:py-4 bg-brand-blue text-white rounded-xl md:rounded-2xl font-bold text-xl md:text-2xl shadow-[0_4px_0_0_#2563eb] active:translate-y-1 active:shadow-none transition-all flex items-center justify-center gap-3",children:[(0,i.jsx)(R.Z,{})," Start Spelling"]})]})]})]})}),(0,i.jsxs)("div",{className:"h-14 md:h-16 flex items-center justify-between px-3 md:px-6 shrink-0 bg-white border-b border-slate-100 z-30 shadow-sm pt-[env(safe-area-inset-top)] md:pt-0 box-content",children:[(0,i.jsx)("button",{onClick:r,className:"p-2 bg-slate-50 rounded-full text-slate-400 hover:bg-red-50 hover:text-red-500 transition-colors",children:(0,i.jsx)(ex.Z,{size:20})}),(0,i.jsx)("div",{className:"flex items-center gap-3",children:(0,i.jsxs)("div",{className:"bg-yellow-50 px-3 py-1 rounded-full border border-yellow-200 flex items-center gap-1",children:[(0,i.jsx)(G.Z,{className:"fill-brand-yellow text-brand-yellow",size:16}),(0,i.jsx)("span",{className:"font-black text-brand-yellow text-base",children:T})]})}),(0,i.jsx)("div",{className:"flex items-center gap-2",children:(0,i.jsxs)("button",{onClick:eG,disabled:p,className:"flex items-center gap-2 px-3 py-2 rounded-full transition-all border-2 ".concat(h?"bg-brand-orange text-white border-brand-orange":p?"bg-orange-50 text-brand-orange border-orange-200":"bg-white text-slate-500 border-slate-200 hover:border-brand-orange"),title:"Storyteller Mode",children:[p?(0,i.jsx)(F.Z,{size:18,className:"animate-spin"}):h?(0,i.jsx)(eh.Z,{size:18}):(0,i.jsx)(R.Z,{size:18}),(0,i.jsx)("span",{className:"text-xs font-bold uppercase hidden sm:inline",children:p?"Loading...":"Storyteller"})]})})]}),(0,i.jsxs)("div",{className:"flex-1 flex flex-col md:flex-row h-full min-h-0 relative overflow-hidden pb-[env(safe-area-inset-bottom)]",children:[(0,i.jsxs)("div",{className:"w-full shrink-0 h-[40dvh] md:aspect-auto md:h-full md:w-1/2 bg-slate-100 relative flex items-center justify-center p-0 md:p-6 overflow-hidden",children:[(0,i.jsx)("div",{className:"hidden md:block absolute inset-4 bg-white rounded-[2rem] shadow-xl rotate-1"}),(0,i.jsxs)("div",{className:"relative w-full h-full md:aspect-square md:h-auto max-h-full md:rounded-xl md:overflow-hidden md:shadow-sm md:border md:border-slate-200 bg-white",children:[eD.imageUrl?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("img",{src:eD.imageUrl,alt:"Page ".concat(c+1),className:"w-full h-full object-cover relative z-10"})}):(0,i.jsx)("div",{className:"w-full h-full flex items-center justify-center text-slate-300 bg-slate-50 font-bold animate-pulse",children:"Painting Scene..."}),(0,i.jsx)("button",{className:"absolute bottom-4 right-4 p-2 bg-black/20 text-white rounded-full hover:bg-black/40 backdrop-blur-sm z-20",onClick:()=>{j(),eD.imageUrl&&S(eD.imageUrl)},children:(0,i.jsx)(eb.Z,{size:16})})]})]}),(0,i.jsxs)("div",{className:"flex-1 w-full md:w-1/2 flex flex-col bg-white relative h-full min-h-0",children:[(0,i.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 pb-32 md:pb-8 flex flex-col items-center md:items-start text-center md:text-left scrollbar-hide",children:[(0,i.jsxs)("div",{className:"mb-4 inline-block px-3 py-1 bg-slate-50 rounded-full text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:["Page ",c+1," / ",s.pages.length]}),(0,i.jsx)("div",{className:"w-full mb-6",children:(0,i.jsx)("div",{className:"flex flex-wrap gap-x-2 md:gap-x-3 gap-y-3 md:gap-y-5 leading-loose md:leading-[2.5] justify-center md:justify-start px-2 py-4",children:es.map((e,t)=>{var l;let s=e.text.replace(/[^a-zA-Z0-9]/g,""),r=u.find(e=>{let t=s.toLowerCase();if(t.length<2&&"i"!==t)return!1;let l=e.word.toLowerCase();if(l===t||t===l+"s"||t===l+"es"||l===t+"s")return!0;let r=l.split(/[\s-]+/);return r.length>1&&r.some(e=>!(e.length<2)&&(t===e||t===e+"s"||t===e+"es"))}),a=r&&(null===(l=ek[c])||void 0===l?void 0:l.includes(r.id)),n=e.isSpecial&&!!r||!!r,o=ee===t,d=t<J;return(0,i.jsx)("span",{onClick:t=>eH(t,e.text,!!n),className:"\n                            relative px-2 py-1 rounded-lg transition-all duration-200\n                            text-xl md:text-3xl font-medium select-none cursor-pointer\n                            ".concat(d?"opacity-100 translate-y-0 blur-0":"opacity-0 translate-y-4 blur-sm","\n                            ").concat(o?"bg-yellow-300 text-black scale-110 shadow-[0_4px_10px_rgba(253,224,71,0.5)] ring-4 ring-yellow-200 z-10 font-black -rotate-2":"text-slate-700 hover:text-brand-blue hover:bg-slate-100","\n                            ").concat(!o&&h?"opacity-50 blur-[0.5px] scale-95":"","\n                            ").concat(!n||o||a?"":"text-brand-blue border-b-2 md:border-b-4 border-dashed border-brand-blue/30","\n                            ").concat(n&&a&&!o?"text-brand-green bg-green-50 border-b-2 md:border-b-4 border-brand-green":"","\n                        "),children:e.text},t)})})}),eK.length>0&&(0,i.jsxs)("div",{className:"w-full mb-6 bg-slate-50 p-3 rounded-2xl border border-slate-100 flex flex-col items-center md:items-start gap-2 animate-pop-in",children:[(0,i.jsxs)("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wide flex items-center gap-1",children:[(0,i.jsx)(ep.Z,{size:12})," Find on this page:"]}),(0,i.jsx)("div",{className:"flex gap-3 flex-wrap justify-center md:justify-start",children:eK.map(e=>{var t;let l=null===(t=ek[c])||void 0===t?void 0:t.includes(e.id);return(0,i.jsxs)("div",{className:"flex items-center gap-2 bg-white px-2 py-1 rounded-xl border ".concat(l?"border-brand-green/30 bg-green-50/50":"border-slate-200"),children:[(0,i.jsx)("div",{className:"w-8 h-8 rounded-lg overflow-hidden border ".concat(l?"border-brand-green":"border-slate-200"," shrink-0"),children:(0,i.jsx)("img",{src:e.imageUrl,className:"w-full h-full object-cover ".concat(l?"":"grayscale opacity-70"),alt:e.word})}),(0,i.jsx)("span",{className:"text-xs font-bold uppercase ".concat(l?"text-brand-green":"text-slate-400"),children:e.word}),l&&(0,i.jsx)(em.Z,{size:14,className:"text-brand-green ml-1"})]},e.id)})})]}),(0,i.jsx)("p",{className:"text-xs text-slate-300 font-bold uppercase tracking-widest mt-4",children:"Tap any word to learn its meaning!"})]}),(0,i.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-white/95 backdrop-blur-sm border-t border-slate-100 p-2 md:p-4 z-20 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] flex flex-col gap-3 pb-[calc(0.5rem+env(safe-area-inset-bottom))]",children:(0,i.jsxs)("div",{className:"flex items-center gap-3 w-full max-w-lg mx-auto",children:[(0,i.jsx)("button",{onClick:()=>{eL(),A(),c>0&&x(e=>e-1)},disabled:0===c,className:"p-3 md:p-4 rounded-full bg-slate-50 text-slate-400 disabled:opacity-20 hover:bg-slate-100 transition-all shrink-0",children:(0,i.jsx)(d.Z,{size:24})}),(0,i.jsxs)("button",{onClick:()=>{eL(),A(),c<s.pages.length-1?x(e=>e+1):r()},className:"flex-1 py-3 md:py-4 rounded-full font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all ".concat(eZ?"bg-brand-green text-white hover:bg-green-600":"bg-brand-blue text-white hover:bg-blue-600"),children:[eZ?"Finish":"Next"," ",eZ?(0,i.jsx)(em.Z,{size:20}):(0,i.jsx)(ef.Z,{size:20})]})]})})]})]}),N&&(0,i.jsxs)("div",{className:"fixed inset-0 z-[110] bg-black flex items-center justify-center p-0",onClick:()=>S(null),children:[(0,i.jsx)("img",{src:N,className:"w-full h-full object-contain",alt:"Zoomed"}),(0,i.jsx)("button",{className:"absolute top-4 right-4 text-white p-2 bg-white/20 rounded-full",children:(0,i.jsx)(ex.Z,{size:24})})]})]})};var ej=l(1949);let ev=e=>{let{theme:t,onSelectMode:l}=e,[s,r]=(0,o.useState)(null),[a,n]=(0,o.useState)("");return(0,i.jsx)("div",{className:"h-full w-full overflow-y-auto scrollbar-hide",children:(0,i.jsxs)("div",{className:"min-h-full flex flex-col items-center p-4 md:p-12 animate-pop-in pb-32",children:[(0,i.jsxs)("div",{className:"text-center mb-6 md:mb-10 shrink-0 mt-4",children:[(0,i.jsx)("h2",{className:"text-2xl md:text-4xl font-black text-slate-800 mb-2",children:"Who is the Author?"}),(0,i.jsx)("p",{className:"text-base md:text-xl text-slate-500",children:"How do you want to create your story?"})]}),(0,i.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 md:gap-6 w-full max-w-4xl mb-6 md:mb-10 flex-shrink-0",children:[(0,i.jsxs)("button",{onClick:()=>{g(),r("auto")},className:"flex-1 p-4 md:p-8 rounded-2xl md:rounded-3xl border-4 text-left transition-all relative overflow-hidden group flex flex-row md:flex-col items-center md:items-start gap-4 md:gap-0 ".concat("auto"===s?"border-brand-blue bg-blue-50 shadow-xl scale-[1.02]":"border-slate-100 bg-white hover:border-blue-200 hover:shadow-lg"),children:[(0,i.jsx)("div",{className:"absolute top-0 right-0 p-4 opacity-10 hidden md:block",children:(0,i.jsx)(R.Z,{size:120,className:"text-brand-blue"})}),(0,i.jsx)("div",{className:"w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center text-2xl md:text-3xl md:mb-6 transition-colors shrink-0 ".concat("auto"===s?"bg-brand-blue text-white":"bg-blue-100 text-brand-blue"),children:"✨"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg md:text-2xl font-bold text-slate-800 mb-1 md:mb-2",children:"Magic Story"}),(0,i.jsx)("p",{className:"text-sm md:text-base text-slate-500 font-medium leading-tight",children:"Let AI write a surprise story for you using your items!"})]})]}),(0,i.jsxs)("button",{onClick:()=>{g(),r("manual")},className:"flex-1 p-4 md:p-8 rounded-2xl md:rounded-3xl border-4 text-left transition-all relative overflow-hidden group flex flex-row md:flex-col items-center md:items-start gap-4 md:gap-0 ".concat("manual"===s?"border-brand-purple bg-purple-50 shadow-xl scale-[1.02]":"border-slate-100 bg-white hover:border-purple-200 hover:shadow-lg"),children:[(0,i.jsx)("div",{className:"absolute top-0 right-0 p-4 opacity-10 hidden md:block",children:(0,i.jsx)(ej.Z,{size:120,className:"text-brand-purple"})}),(0,i.jsx)("div",{className:"w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center text-2xl md:text-3xl md:mb-6 transition-colors shrink-0 ".concat("manual"===s?"bg-brand-purple text-white":"bg-purple-100 text-brand-purple"),children:"✏️"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg md:text-2xl font-bold text-slate-800 mb-1 md:mb-2",children:"Co-Writer"}),(0,i.jsx)("p",{className:"text-sm md:text-base text-slate-500 font-medium leading-tight",children:"You write an idea, and AI will finish the story for you."})]})]})]}),"manual"===s&&(0,i.jsxs)("div",{className:"w-full max-w-2xl bg-white p-4 md:p-6 rounded-3xl shadow-sm border-2 border-brand-purple/30 animate-pop-in mb-6 flex-shrink-0",children:[(0,i.jsx)("label",{className:"block text-slate-600 font-bold mb-2 ml-2 text-sm md:text-base",children:"Start your story here:"}),(0,i.jsx)("textarea",{value:a,onChange:e=>n(e.target.value),placeholder:"e.g., The banana wanted to fly to the moon...",className:"w-full h-24 md:h-32 p-3 md:p-4 rounded-xl bg-slate-50 border border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-brand-purple outline-none text-base md:text-lg resize-none"})]}),s&&(0,i.jsx)("div",{className:"w-full flex justify-center mt-auto animate-pop-in",children:(0,i.jsxs)("button",{onClick:()=>{k(),"auto"===s?l(void 0):l(a)},disabled:"manual"===s&&a.trim().length<3,className:"w-full md:w-auto px-8 md:px-12 py-4 md:py-5 bg-brand-green text-white rounded-full font-bold text-xl md:text-2xl shadow-xl hover:scale-105 transition-all disabled:opacity-50 disabled:scale-100 flex items-center justify-center gap-3 touch-manipulation",children:["Create Story ",(0,i.jsx)(E.Z,{strokeWidth:3})]})})]})})};var ey=l(9442),eN=l(1463),ek=l(2591),eC=l(8267),eS=l(2089);let eA=e=>{let{onComplete:t}=e,[l,s]=(0,o.useState)("6-8"),[r,a]=(0,o.useState)("Intermediate"),n=[{val:"3-5",label:"3-5",icon:(0,i.jsx)(ey.Z,{size:24})},{val:"6-8",label:"6-8",icon:(0,i.jsx)(eN.Z,{size:24})},{val:"9-12",label:"9-12",icon:(0,i.jsx)(ek.Z,{size:24})}];return(0,i.jsx)("div",{className:"h-full w-full overflow-y-auto scrollbar-hide bg-slate-50",children:(0,i.jsxs)("div",{className:"min-h-full flex flex-col items-center justify-center p-4 md:p-8 animate-pop-in pb-8",children:[(0,i.jsxs)("div",{className:"text-center mb-6 shrink-0",children:[(0,i.jsx)("h2",{className:"text-2xl font-black text-slate-800 mb-1",children:"About You"}),(0,i.jsx)("p",{className:"text-sm text-slate-500",children:"Let's set up your profile!"})]}),(0,i.jsxs)("div",{className:"w-full max-w-sm space-y-6 mb-8",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-1",children:[(0,i.jsx)(eC.Z,{size:14})," Age"]}),(0,i.jsx)("div",{className:"grid grid-cols-3 gap-2",children:n.map(e=>(0,i.jsxs)("button",{onClick:()=>{g(),s(e.val)},className:"py-3 px-1 rounded-xl border-2 transition-all flex flex-col items-center gap-1 ".concat(l===e.val?"border-brand-orange bg-white text-brand-orange shadow-md scale-[1.02]":"border-transparent bg-white text-slate-400 hover:bg-slate-100"),children:[(0,i.jsx)("div",{className:l===e.val?"animate-bounce-slow":"",children:e.icon}),(0,i.jsx)("span",{className:"font-bold text-sm",children:e.label})]},e.val))})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-1",children:[(0,i.jsx)(eS.Z,{size:14})," Level"]}),(0,i.jsx)("div",{className:"grid grid-cols-1 gap-2",children:[{val:"Beginner",label:"Beginner",desc:"Simple words",color:"bg-green-100 border-green-200 text-green-700"},{val:"Intermediate",label:"Intermediate",desc:"I can read",color:"bg-blue-100 border-blue-200 text-blue-700"},{val:"Advanced",label:"Advanced",desc:"Book lover",color:"bg-purple-100 border-purple-200 text-purple-700"}].map(e=>(0,i.jsxs)("button",{onClick:()=>{g(),a(e.val)},className:"p-3 rounded-xl border-2 transition-all text-left flex items-center gap-3 ".concat(r===e.val?"".concat(e.color.replace("bg-","bg-opacity-20 ")," border-current shadow-sm"):"bg-white border-transparent text-slate-400 hover:bg-slate-50"),children:[(0,i.jsx)("div",{className:"w-3 h-3 rounded-full border-2 shrink-0 ".concat(r===e.val?"border-current bg-current":"border-slate-300")}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"block font-bold text-base leading-none mb-0.5 ".concat(r===e.val?"text-slate-800":"text-slate-500"),children:e.label}),(0,i.jsx)("span",{className:"text-xs opacity-70 font-medium",children:e.desc})]})]},e.val))})]})]}),(0,i.jsxs)("button",{onClick:()=>{g(),t({ageGroup:l,englishLevel:r})},className:"w-full max-w-xs py-4 bg-brand-blue text-white rounded-full font-bold text-xl shadow-lg hover:scale-105 transition-all flex items-center justify-center gap-2 animate-pop-in shrink-0 touch-manipulation",children:["Start ",(0,i.jsx)(E.Z,{size:20,strokeWidth:3})]})]})})};var eT=l(2126),ez=l(6611),eR=l(2887),eE=l(3488);let eD=e=>{let{stories:t}=e,[l,s]=(0,o.useState)("stickers"),r=(0,o.useMemo)(()=>{let e=[],l=new Set;return t.forEach(t=>{t.learnedWords&&t.learnedWords.forEach(t=>{l.has(t.id)||(e.push(t),l.add(t.id))})}),e.reverse()},[t]),a=(0,o.useMemo)(()=>O.filter(e=>e.condition(t,r.length)),[t,r]);return(0,i.jsxs)("div",{className:"h-full flex flex-col bg-slate-50 relative overflow-hidden",children:[(0,i.jsxs)("div",{className:"p-6 md:p-8 bg-white border-b-4 border-slate-100 flex flex-col md:flex-row justify-between items-center gap-4 shrink-0 shadow-sm z-10",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("h2",{className:"text-3xl md:text-4xl font-black text-brand-blue flex items-center gap-3",children:[(0,i.jsx)("div",{className:"w-12 h-12 bg-brand-yellow rounded-2xl rotate-[-6deg] flex items-center justify-center text-brand-blue shadow-sm border-2 border-brand-orange",children:(0,i.jsx)(x.Z,{size:28,strokeWidth:3})}),"Explorer Passport"]}),(0,i.jsx)("p",{className:"text-slate-500 font-medium pl-1",children:"Track your journey and collection!"})]}),(0,i.jsxs)("div",{className:"flex gap-4",children:[(0,i.jsxs)("div",{className:"bg-orange-50 border-2 border-orange-100 px-4 py-2 rounded-2xl flex flex-col items-center",children:[(0,i.jsx)("span",{className:"text-2xl font-black text-brand-orange",children:r.length}),(0,i.jsx)("span",{className:"text-xs font-bold text-orange-300 uppercase",children:"Stickers"})]}),(0,i.jsxs)("div",{className:"bg-purple-50 border-2 border-purple-100 px-4 py-2 rounded-2xl flex flex-col items-center",children:[(0,i.jsx)("span",{className:"text-2xl font-black text-brand-purple",children:a.length}),(0,i.jsx)("span",{className:"text-xs font-bold text-purple-300 uppercase",children:"Badges"})]})]})]}),(0,i.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 pb-24",children:["stickers"===l&&(0,i.jsx)(i.Fragment,{children:0===r.length?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 opacity-50",children:[(0,i.jsx)(ep.Z,{size:64,className:"text-slate-300 mb-4"}),(0,i.jsx)("p",{className:"text-xl font-bold text-slate-400",children:"No stickers yet!"}),(0,i.jsx)("p",{className:"text-slate-400",children:"Go on a quest to find items."})]}):(0,i.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3 md:gap-4",children:r.map(e=>(0,i.jsxs)("div",{className:"bg-white p-2 rounded-xl shadow-sm border-2 border-slate-100 flex flex-col opacity-90",children:[(0,i.jsx)("div",{className:"aspect-square rounded-lg overflow-hidden bg-slate-100 mb-1",children:(0,i.jsx)("img",{src:e.imageUrl,alt:e.word,className:"w-full h-full object-cover"})}),(0,i.jsx)("span",{className:"block text-center font-bold text-slate-400 text-xs capitalize truncate px-1",children:e.word})]},e.id))})}),"badges"===l&&(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:O.map(e=>{let t=a.find(t=>t.id===e.id);return(0,i.jsxs)("div",{className:"relative p-6 rounded-3xl border-4 flex items-center gap-4 transition-all ".concat(t?"bg-white border-white shadow-lg":"bg-slate-100 border-slate-200 opacity-70 grayscale"),children:[(0,i.jsx)("div",{className:"w-20 h-20 rounded-full flex items-center justify-center text-4xl shadow-inner border-4 border-white/30 shrink-0 ".concat(t?e.color:"bg-slate-300"),children:e.icon}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-xl font-black ".concat(t?"text-slate-800":"text-slate-500"),children:e.label}),(0,i.jsx)("p",{className:"text-sm font-bold text-slate-400 leading-tight",children:e.description}),!t&&(0,i.jsxs)("div",{className:"flex items-center gap-1 text-xs font-bold text-slate-400 mt-2 bg-slate-200 inline-flex px-2 py-1 rounded-full",children:[(0,i.jsx)(eT.Z,{size:12})," LOCKED"]}),t&&(0,i.jsxs)("div",{className:"flex items-center gap-1 text-xs font-bold text-green-600 mt-2 bg-green-100 inline-flex px-2 py-1 rounded-full",children:[(0,i.jsx)(ez.Z,{size:12})," UNLOCKED"]})]})]},e.id)})})]}),(0,i.jsx)("div",{className:"bg-white border-t-4 border-slate-100 shrink-0 z-20 pb-4 pt-4 px-4 rounded-t-[2rem] shadow-[0_-10px_40px_rgba(0,0,0,0.05)]",children:(0,i.jsxs)("div",{className:"flex gap-2 justify-center max-w-md mx-auto bg-slate-100 p-2 rounded-full",children:[(0,i.jsxs)("button",{onClick:()=>{g(),s("stickers")},className:"flex-1 py-3 rounded-full font-bold text-lg flex items-center justify-center gap-2 transition-all ".concat("stickers"===l?"bg-brand-blue text-white shadow-md":"text-slate-400 hover:bg-slate-200/50"),children:[(0,i.jsx)(eR.Z,{size:20})," Sticker Album"]}),(0,i.jsxs)("button",{onClick:()=>{g(),s("badges")},className:"flex-1 py-3 rounded-full font-bold text-lg flex items-center justify-center gap-2 transition-all ".concat("badges"===l?"bg-brand-yellow text-brand-blue shadow-md":"text-slate-400 hover:bg-slate-200/50"),children:[(0,i.jsx)(eE.Z,{size:20})," Achievements"]})]})})]})};var eZ=l(2629),e_=l(1781),eO=l(7695);let eM=e=>{let{stories:t,mastery:l,onUpdateMastery:s}=e,[r,a]=(0,o.useState)("menu"),[n,d]=(0,o.useState)([]),[c,x]=(0,o.useState)(0),[u,m]=(0,o.useState)(!1),[b,p]=(0,o.useState)(0),[f,w]=(0,o.useState)(!1),[v,y]=(0,o.useState)(!1),[N,S]=(0,o.useState)(null),A=(0,o.useRef)(null),T=(0,o.useRef)([]),z=(0,o.useRef)(null),R=o.useMemo(()=>{let e=[],l=new Set;return t.forEach(t=>{t.learnedWords&&t.learnedWords.forEach(t=>{l.has(t.id)||(e.push(t),l.add(t.id))})}),e},[t]);(0,o.useEffect)(()=>()=>{E(),N&&URL.revokeObjectURL(N)},[c]);let E=()=>{A.current&&A.current.stream&&A.current.stream.getTracks().forEach(e=>e.stop())},D=e=>{s(n[c].id,e),e?(p(e=>e+1),k()):C(),c<n.length-1?setTimeout(()=>{m(!1),S(null),w(!1),x(e=>e+1)},500):a("menu")},Z=async e=>{e.stopPropagation();try{ed.stopAll(),g();let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);A.current=t,T.current=[],t.ondataavailable=e=>{e.data.size>0&&T.current.push(e.data)},t.onstop=()=>{let e=t.mimeType||"",l=new Blob(T.current,{type:e}),s=URL.createObjectURL(l);S(s),setTimeout(()=>_(s),100)},t.start(),w(!0)}catch(e){console.error("Mic error:",e),alert("Microphone access needed for recording.")}},_=e=>{let t=e||N;if(!t)return;ed.stopAll(),z.current&&(z.current.pause(),z.current=null);let l=new Audio(t);z.current=l,y(!0),l.onended=()=>y(!1);let s=l.play();s&&s.catch(e=>console.error(e))};if(0===R.length)return(0,i.jsxs)("div",{className:"h-full flex flex-col items-center justify-center p-8 text-center opacity-60",children:[(0,i.jsx)(eZ.Z,{size:64,className:"mb-4 text-slate-300"}),(0,i.jsx)("h2",{className:"text-2xl font-bold text-slate-400",children:"Gym Closed"}),(0,i.jsx)("p",{className:"text-slate-400",children:"Go find some words first!"})]});if("menu"===r)return(0,i.jsxs)("div",{className:"h-full flex flex-col p-6 md:p-12 overflow-y-auto scrollbar-hide",children:[(0,i.jsxs)("div",{className:"text-center mb-8 shrink-0",children:[(0,i.jsxs)("h2",{className:"text-3xl md:text-4xl font-black text-brand-orange mb-2 flex items-center justify-center gap-3",children:[(0,i.jsx)(h.Z,{size:40})," Brain Dojo"]}),(0,i.jsx)("p",{className:"text-slate-500 font-medium text-lg",children:"Train your brain and remember your words!"})]}),(0,i.jsx)("div",{className:"flex justify-center mb-10 shrink-0",children:(0,i.jsxs)("button",{onClick:()=>{g(),d([...R].sort(()=>.5-Math.random()).slice(0,5)),x(0),m(!1),p(0),a("quiz"),S(null),w(!1)},className:"w-full max-w-sm aspect-video bg-gradient-to-br from-brand-orange to-red-400 rounded-[2.5rem] shadow-xl text-white flex flex-col items-center justify-center gap-4 hover:scale-105 transition-transform border-4 border-white/20",children:[(0,i.jsx)("div",{className:"bg-white/20 p-4 rounded-full backdrop-blur-sm animate-bounce-slow",children:(0,i.jsx)(eZ.Z,{size:48})}),(0,i.jsx)("span",{className:"text-3xl font-black",children:"Start Training"}),(0,i.jsx)("span",{className:"text-white/80 font-bold bg-black/10 px-4 py-1 rounded-full",children:"5 Word Quiz"})]})}),(0,i.jsxs)("h3",{className:"text-xl font-bold text-slate-600 mb-4 flex items-center gap-2 shrink-0",children:[(0,i.jsx)(e_.Z,{className:"text-brand-yellow"})," Mastery Progress"]}),(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pb-20",children:R.map(e=>{var t;let s=(null===(t=l[e.id])||void 0===t?void 0:t.level)||0;return(0,i.jsxs)("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4",children:[(0,i.jsx)("img",{src:e.imageUrl,className:"w-16 h-16 rounded-xl object-cover bg-slate-100",alt:e.word}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-bold text-slate-700 capitalize",children:e.word}),(0,i.jsx)("div",{className:"flex gap-1 mt-1",children:[1,2,3,4,5].map(e=>(0,i.jsx)(G.Z,{size:14,className:e<=s?"fill-brand-yellow text-brand-yellow":"text-slate-200"},e))})]})]},e.id)})})]});let O=n[c];return(0,i.jsxs)("div",{className:"h-full flex flex-col bg-slate-50 relative",children:[(0,i.jsx)("div",{className:"h-2 bg-slate-200 w-full shrink-0",children:(0,i.jsx)("div",{className:"h-full bg-brand-orange transition-all duration-500",style:{width:"".concat(c/n.length*100,"%")}})}),(0,i.jsx)("div",{className:"flex-1 overflow-y-auto w-full scrollbar-hide bg-slate-50",children:(0,i.jsxs)("div",{className:"min-h-full w-full flex flex-col items-center justify-center py-8 px-4 pb-24",children:[(0,i.jsx)("div",{className:"text-center mb-6 shrink-0",children:(0,i.jsxs)("h2",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest bg-white px-4 py-1 rounded-full border border-slate-200",children:["Card ",c+1," of ",n.length]})}),(0,i.jsx)("div",{className:"group w-72 h-96 md:w-80 md:h-[28rem] perspective-1000 cursor-pointer relative shrink-0",onClick:u?void 0:()=>{j(),m(!u),u||(ed.speak(n[c].word),S(null),w(!1))},children:(0,i.jsxs)("div",{className:"relative w-full h-full duration-500 preserve-3d transition-transform ".concat(u?"rotate-y-180":""),style:{transformStyle:"preserve-3d",transform:u?"rotateY(180deg)":"rotateY(0deg)"},children:[(0,i.jsx)("div",{className:"absolute inset-0 backface-hidden bg-white rounded-[2rem] shadow-xl border-8 border-white overflow-hidden flex flex-col",style:{backfaceVisibility:"hidden"},children:(0,i.jsxs)("div",{className:"flex-1 relative",children:[(0,i.jsx)("img",{src:O.imageUrl,alt:"Guess",className:"w-full h-full object-cover"}),(0,i.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10",children:(0,i.jsxs)("div",{className:"bg-white/90 backdrop-blur-md px-4 py-2 rounded-full shadow-lg flex items-center gap-2 animate-bounce",children:[(0,i.jsx)(K.Z,{size:18,className:"text-slate-500"}),(0,i.jsx)("span",{className:"font-bold text-slate-600 text-sm",children:"Tap to Flip"})]})})]})}),(0,i.jsxs)("div",{className:"absolute inset-0 backface-hidden bg-white rounded-[2rem] shadow-xl border-8 border-brand-orange overflow-hidden flex flex-col rotate-y-180",style:{transform:"rotateY(180deg)",backfaceVisibility:"hidden"},children:[(0,i.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center p-3 text-center overflow-y-auto",children:[(0,i.jsx)("h3",{className:"text-3xl font-black text-slate-800 capitalize mb-1 mt-2",children:O.word}),(0,i.jsxs)("p",{className:"text-slate-500 font-medium text-sm leading-relaxed mb-4 px-1 line-clamp-3",children:['"',O.definition,'"']}),(0,i.jsxs)("div",{className:"flex items-center gap-3 mb-2 shrink-0",onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("button",{onClick:()=>ed.speak(O.word),className:"p-3 bg-brand-yellow/20 text-brand-orange rounded-full hover:scale-110 transition-transform",children:(0,i.jsx)(H.Z,{size:24})}),(0,i.jsxs)("div",{className:"flex items-center gap-2 bg-slate-50 p-1.5 rounded-full border border-slate-200",children:[f?(0,i.jsx)("button",{onClick:e=>{e.stopPropagation(),A.current&&f&&(j(),A.current.stop(),w(!1),E())},className:"w-10 h-10 bg-red-500 rounded-full text-white animate-pulse flex items-center justify-center shadow-md",children:(0,i.jsx)(q.Z,{size:14,fill:"currentColor"})}):(0,i.jsx)("button",{onClick:Z,className:"w-10 h-10 bg-white rounded-full text-red-500 border border-red-100 flex items-center justify-center hover:bg-red-50 shadow-sm",children:(0,i.jsx)(Q.Z,{size:20})}),N&&!f&&(0,i.jsx)("button",{onClick:()=>_(),className:"w-10 h-10 rounded-full text-white flex items-center justify-center shadow-md ".concat(v?"bg-brand-blue":"bg-blue-300"),children:v?(0,i.jsx)(H.Z,{size:16}):(0,i.jsx)(X.Z,{size:16,fill:"currentColor"})})]})]}),(0,i.jsx)("div",{className:"text-[9px] font-bold text-slate-300 uppercase tracking-wide shrink-0",children:f?"Recording...":N?"Listen":"Speak"})]}),(0,i.jsxs)("div",{className:"bg-orange-50 p-3 border-t-2 border-orange-100 grid grid-cols-2 gap-3 shrink-0",onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("button",{onClick:()=>D(!1),className:"flex flex-col items-center justify-center gap-1 py-3 bg-white border-2 border-red-100 rounded-xl text-red-400 font-bold hover:bg-red-50 hover:border-red-200 active:scale-95 transition-all shadow-sm group",children:[(0,i.jsx)(eO.Z,{size:24,className:"group-hover:scale-110 transition-transform"}),(0,i.jsx)("span",{className:"text-xs",children:"Retry"})]}),(0,i.jsxs)("button",{onClick:()=>D(!0),className:"flex flex-col items-center justify-center gap-1 py-3 bg-brand-green text-white rounded-xl font-bold shadow-md hover:bg-green-600 active:scale-95 transition-all group",children:[(0,i.jsx)(em.Z,{size:24,className:"group-hover:scale-110 transition-transform"}),(0,i.jsx)("span",{className:"text-xs",children:"Got it!"})]})]})]})]})})]})})]})};var eI=l(8900);let eU=e=>{let{words:t,onComplete:l}=e,[s,r]=(0,o.useState)(0),[a,n]=(0,o.useState)(null),[d,c]=(0,o.useState)(null),[x,u]=(0,o.useState)(!1),m=t[s];(0,o.useEffect)(()=>{x||ed.speak("Where is the ".concat(m.word,"?"))},[s,x,m]);let h=e=>{!0!==d&&(n(e),e===m.id?(c(!0),k(),ed.speak("That's right!"),(0,eg.Z)({particleCount:50,spread:60,origin:{y:.7},disableForReducedMotion:!0}),setTimeout(()=>{s<t.length-1?(r(e=>e+1),n(null),c(null)):(S(),u(!0),ed.speak("Excellent work! You found all the words!"))},2e3)):(c(!1),C(),ed.speak("Oops, try again!"),setTimeout(()=>{n(null),c(null)},1200)))};return x?(0,i.jsxs)("div",{className:"h-full flex flex-col items-center justify-center p-8 animate-pop-in text-center",children:[(0,i.jsx)("div",{className:"w-32 h-32 bg-brand-yellow rounded-full flex items-center justify-center mb-6 shadow-xl animate-bounce-slow",children:(0,i.jsx)(e_.Z,{size:64,className:"text-brand-orange"})}),(0,i.jsx)("h2",{className:"text-4xl font-black text-brand-blue mb-4",children:"Quiz Passed!"}),(0,i.jsx)("p",{className:"text-xl text-slate-500 mb-8 max-w-md",children:"You know all the words from your story. You are a true Word Master!"}),(0,i.jsxs)("button",{onClick:()=>{g(),l()},className:"px-12 py-5 bg-brand-green text-white rounded-full font-bold text-2xl shadow-[0_8px_20px_rgba(22,163,74,0.4)] hover:scale-105 transition-all flex items-center gap-3",children:["Collect Badge & Save ",(0,i.jsx)(E.Z,{strokeWidth:3})]})]}):(0,i.jsxs)("div",{className:"h-full flex flex-col bg-slate-50 relative overflow-hidden",children:[(0,i.jsx)("div",{className:"h-2 bg-slate-200 w-full shrink-0",children:(0,i.jsx)("div",{className:"h-full bg-brand-blue transition-all duration-500",style:{width:"".concat(s/t.length*100,"%")}})}),(0,i.jsxs)("div",{className:"p-6 md:p-8 text-center shrink-0",children:[(0,i.jsxs)("div",{className:"inline-flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow-sm border border-slate-100 mb-4",children:[(0,i.jsx)(eI.Z,{size:16,className:"text-brand-purple"}),(0,i.jsxs)("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:["Question ",s+1," of ",t.length]})]}),(0,i.jsxs)("h2",{className:"text-3xl md:text-5xl font-black text-slate-800 mb-2",children:["Where is ",(0,i.jsx)("span",{className:"text-brand-blue underline decoration-brand-yellow decoration-4 underline-offset-4",children:m.word}),"?"]}),(0,i.jsx)("button",{onClick:()=>{g(),ed.speak(m.word)},className:"mt-2 p-3 bg-brand-orange text-white rounded-full shadow-md hover:scale-110 transition-transform",children:(0,i.jsx)(H.Z,{size:24})})]}),(0,i.jsx)("div",{className:"flex-1 overflow-y-auto p-4 md:p-8",children:(0,i.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 max-w-4xl mx-auto pb-8",children:t.map(e=>{let t=a===e.id,l=t&&!1===d,s=t&&!0===d;return(0,i.jsxs)("button",{onClick:()=>h(e.id),disabled:!0===d,className:"relative aspect-square rounded-3xl overflow-hidden border-4 shadow-sm transition-all duration-300 transform \n                                ".concat(s?"border-brand-green ring-4 ring-green-100 scale-105 z-10":"","\n                                ").concat(l?"border-red-400 animate-pulse":"","\n                                ").concat(t||s?"":"border-white hover:border-brand-blue hover:shadow-xl hover:-translate-y-1","\n                            "),children:[(0,i.jsx)("img",{src:e.imageUrl,alt:"Option",className:"w-full h-full object-cover transition-all ".concat(s?"brightness-110":"")}),s&&(0,i.jsx)("div",{className:"absolute inset-0 bg-green-500/30 flex items-center justify-center animate-pop-in",children:(0,i.jsx)(em.Z,{size:64,className:"text-white drop-shadow-md"})}),l&&(0,i.jsx)("div",{className:"absolute inset-0 bg-red-500/30 flex items-center justify-center",children:(0,i.jsx)(eO.Z,{size:64,className:"text-white drop-shadow-md"})})]},e.id)})})})]})};var eL=l(1998);let eP=e=>{let{stories:t}=e,[l,s]=(0,o.useState)(""),[r,a]=(0,o.useState)(null),[n,d]=(0,o.useState)(!1),[c,x]=(0,o.useState)(!1),[u,m]=(0,o.useState)(null),h=(0,o.useRef)(null),b=(0,o.useRef)([]),p=(0,o.useRef)(null),f=(0,o.useMemo)(()=>{let e=[],l=new Set;return t.forEach(t=>{t.learnedWords&&t.learnedWords.forEach(t=>{l.has(t.word.toLowerCase())||(e.push(t),l.add(t.word.toLowerCase()))})}),e.sort((e,t)=>e.word.localeCompare(t.word))},[t]),w=f.filter(e=>e.word.toLowerCase().includes(l.toLowerCase()));(0,o.useEffect)(()=>()=>{u&&URL.revokeObjectURL(u),y()},[r]);let y=()=>{h.current&&h.current.stream&&h.current.stream.getTracks().forEach(e=>e.stop())},N=(e,t)=>{e.stopPropagation(),ed.speak(t)},k=e=>{j(),a(e),m(null),d(!1),x(!1),ed.speak(e.word)},C=async()=>{try{ed.stopAll(),g();let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);h.current=t,b.current=[],t.ondataavailable=e=>{e.data.size>0&&b.current.push(e.data)},t.onstop=()=>{let e=t.mimeType||"",l=new Blob(b.current,{type:e}),s=URL.createObjectURL(l);m(s),setTimeout(()=>S(s),100)},t.start(),d(!0)}catch(e){console.error("Error accessing microphone:",e),alert("We need microphone permission to record your voice!")}},S=e=>{let t=e||u;if(!t)return;ed.stopAll(),p.current&&(p.current.pause(),p.current=null);let l=new Audio(t);p.current=l,x(!0),l.onended=()=>x(!1);let s=l.play();void 0!==s&&s.catch(e=>{console.error("User Audio Playback Error",e),x(!1)})};return(0,i.jsxs)("div",{className:"h-full flex flex-col bg-slate-50 relative overflow-hidden",children:[(0,i.jsxs)("div",{className:"p-6 md:p-8 bg-white border-b border-slate-100 flex flex-col gap-4 shrink-0 shadow-sm z-10",children:[(0,i.jsx)("div",{className:"flex justify-between items-center",children:(0,i.jsxs)("div",{children:[(0,i.jsxs)("h2",{className:"text-3xl md:text-4xl font-black text-brand-blue flex items-center gap-3",children:[(0,i.jsx)("div",{className:"w-12 h-12 bg-pink-100 rounded-2xl rotate-3 flex items-center justify-center text-pink-500 shadow-sm border-2 border-pink-200",children:(0,i.jsx)(eR.Z,{size:28,strokeWidth:3})}),"Word Cards"]}),(0,i.jsxs)("p",{className:"text-slate-500 font-medium pl-1",children:["Your collection: ",f.length," words"]})]})}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(ep.Z,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:20}),(0,i.jsx)("input",{type:"text",placeholder:"Search your words...",value:l,onChange:e=>s(e.target.value),className:"w-full pl-12 pr-4 py-3 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:border-brand-blue focus:ring-2 focus:ring-blue-100 outline-none transition-all font-bold text-slate-600 placeholder:text-slate-400"})]})]}),(0,i.jsx)("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 pb-24 scrollbar-hide",children:0===f.length?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-center opacity-60 mt-10",children:[(0,i.jsx)("div",{className:"w-24 h-24 bg-slate-200 rounded-full flex items-center justify-center mb-4",children:(0,i.jsx)(eL.Z,{size:40,className:"text-slate-400"})}),(0,i.jsx)("h3",{className:"text-2xl font-bold text-slate-400 mb-2",children:"No words yet!"}),(0,i.jsx)("p",{className:"text-slate-400 max-w-xs mx-auto",children:"Start a new story to find objects and build your collection."})]}):0===w.length?(0,i.jsxs)("div",{className:"text-center py-10 text-slate-400 font-bold",children:['No words match "',l,'"']}):(0,i.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 md:gap-6",children:w.map(e=>(0,i.jsxs)("button",{onClick:()=>k(e),className:"bg-white rounded-2xl shadow-sm border-b-4 border-slate-100 hover:border-brand-blue hover:-translate-y-1 hover:shadow-lg transition-all group overflow-hidden flex flex-col",children:[(0,i.jsxs)("div",{className:"aspect-[4/3] w-full bg-slate-100 relative overflow-hidden",children:[(0,i.jsx)("img",{src:e.imageUrl,alt:e.word,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"}),(0,i.jsx)("div",{className:"absolute top-2 right-2 bg-white/90 p-1.5 rounded-full shadow-sm opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer hover:bg-brand-blue hover:text-white",onClick:t=>N(t,e.word),children:(0,i.jsx)(H.Z,{size:16})})]}),(0,i.jsx)("div",{className:"p-3 w-full text-center bg-white",children:(0,i.jsx)("h3",{className:"font-black text-slate-700 capitalize text-lg truncate",children:e.word})})]},e.id))})}),r&&(0,i.jsx)("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4 animate-pop-in",children:(0,i.jsxs)("div",{className:"bg-white rounded-[2.5rem] w-full max-w-sm md:max-w-md shadow-2xl relative border-8 border-white overflow-hidden flex flex-col max-h-[90dvh]",children:[(0,i.jsx)("button",{onClick:()=>{g(),a(null),m(null),d(!1),x(!1)},className:"absolute top-4 right-4 z-20 w-10 h-10 bg-black/20 hover:bg-black/40 text-white rounded-full flex items-center justify-center backdrop-blur-md transition-colors",children:(0,i.jsx)(ex.Z,{size:24})}),(0,i.jsxs)("div",{className:"h-56 md:h-72 bg-slate-100 shrink-0 relative",children:[(0,i.jsx)("img",{src:r.imageUrl,className:"w-full h-full object-cover",alt:r.word}),(0,i.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-6 pt-12",children:(0,i.jsx)("h2",{className:"text-4xl font-black text-white capitalize tracking-tight drop-shadow-md",children:r.word})})]}),(0,i.jsxs)("div",{className:"p-6 md:p-8 text-center flex-1 overflow-y-auto bg-[radial-gradient(#f1f5f9_1px,transparent_1px)] [background-size:16px_16px]",children:[(0,i.jsxs)("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-slate-100 mb-6 inline-block w-full",children:[(0,i.jsx)("p",{className:"text-slate-500 font-bold uppercase text-xs tracking-widest mb-1",children:"Definition"}),(0,i.jsxs)("p",{className:"text-slate-700 font-medium text-lg leading-relaxed",children:['"',r.definition,'"']})]}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("button",{onClick:e=>N(e,r.word),className:"w-full py-3 bg-brand-orange text-white rounded-2xl font-bold text-lg shadow-[0_4px_0_0_#c2410c] active:translate-y-1 active:shadow-none transition-all flex items-center justify-center gap-3 hover:brightness-110",children:[(0,i.jsx)(H.Z,{size:24})," Listen"]}),(0,i.jsxs)("div",{className:"bg-slate-100 rounded-2xl p-2 flex items-center gap-2 border border-slate-200 mt-4",children:[n?(0,i.jsx)("button",{onClick:()=>{h.current&&n&&(v(),h.current.stop(),d(!1),y())},className:"w-14 h-14 bg-red-500 text-white rounded-xl shadow-md flex items-center justify-center animate-pulse",children:(0,i.jsx)(q.Z,{size:24,fill:"currentColor"})}):(0,i.jsx)("button",{onClick:C,className:"w-14 h-14 bg-white text-red-500 border-2 border-red-100 rounded-xl shadow-sm flex items-center justify-center hover:bg-red-50 transition-colors",children:(0,i.jsx)(Q.Z,{size:28})}),(0,i.jsxs)("div",{className:"flex-1 text-left pl-2",children:[(0,i.jsx)("div",{className:"text-xs font-bold text-slate-400 uppercase mb-0.5",children:"Voice Studio"}),(0,i.jsx)("div",{className:"text-slate-700 font-bold flex items-center gap-2 h-6",children:n?(0,i.jsx)("span",{className:"text-red-500 animate-pulse",children:"Recording..."}):c?(0,i.jsxs)("span",{className:"text-brand-blue flex items-center gap-1",children:[(0,i.jsx)(H.Z,{size:16,className:"animate-bounce"})," Playing..."]}):u?(0,i.jsxs)("span",{className:"text-green-600 flex items-center gap-1",children:[(0,i.jsx)(K.Z,{size:14})," Re-record"]}):"Tap Mic to Say it!"})]}),u&&!n&&(0,i.jsx)("button",{onClick:()=>S(),className:"w-12 h-12 rounded-full flex items-center justify-center transition-all ".concat(c?"bg-brand-blue text-white shadow-inner":"bg-blue-100 text-brand-blue hover:bg-blue-200"),children:c?(0,i.jsx)(H.Z,{size:20}):(0,i.jsx)(X.Z,{size:20,fill:"currentColor"})})]})]})]})]})})]})};var eW=l(39);let eF=e=>{let{stories:t,onSelectStory:l}=e;return(0,i.jsxs)("div",{className:"h-full flex flex-col bg-slate-50 relative overflow-hidden",children:[(0,i.jsx)("div",{className:"p-6 md:p-8 bg-white border-b-4 border-slate-100 flex flex-col md:flex-row justify-between items-center gap-4 shrink-0 shadow-sm z-10",children:(0,i.jsxs)("div",{children:[(0,i.jsxs)("h2",{className:"text-3xl md:text-4xl font-black text-brand-blue flex items-center gap-3",children:[(0,i.jsx)("div",{className:"w-12 h-12 bg-brand-purple rounded-2xl rotate-3 flex items-center justify-center text-white shadow-sm border-2 border-purple-300",children:(0,i.jsx)(eS.Z,{size:28,strokeWidth:3})}),"My Library"]}),(0,i.jsxs)("p",{className:"text-slate-500 font-medium pl-1",children:["You have written ",t.length," stories!"]})]})}),(0,i.jsx)("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 pb-24 scrollbar-hide",children:0===t.length?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-center opacity-60 mt-10",children:[(0,i.jsx)("div",{className:"w-24 h-24 bg-slate-200 rounded-full flex items-center justify-center mb-4",children:(0,i.jsx)(eS.Z,{size:40,className:"text-slate-400"})}),(0,i.jsx)("h3",{className:"text-2xl font-bold text-slate-400 mb-2",children:"Library is Empty"}),(0,i.jsx)("p",{className:"text-slate-400 max-w-xs mx-auto",children:"Create your first story to see it here!"})]}):(0,i.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>{var t;return(0,i.jsxs)("button",{onClick:()=>{j(),l(e)},className:"bg-white rounded-[2rem] shadow-sm border-4 border-slate-100 hover:border-brand-blue hover:shadow-xl hover:-translate-y-1 transition-all group overflow-hidden flex flex-col text-left h-full",children:[(0,i.jsxs)("div",{className:"aspect-[4/3] w-full bg-slate-100 relative overflow-hidden",children:[(null===(t=e.pages[0])||void 0===t?void 0:t.imageUrl)?(0,i.jsx)("img",{src:e.pages[0].imageUrl,alt:e.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"}):(0,i.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-blue-50 text-brand-blue font-bold",children:"No Cover"}),(0,i.jsxs)("div",{className:"absolute top-3 right-3 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-bold text-slate-500 flex items-center gap-1 shadow-sm",children:[(0,i.jsx)(m.Z,{size:12}),new Date(e.date).toLocaleDateString()]})]}),(0,i.jsxs)("div",{className:"p-5 flex flex-col flex-1",children:[(0,i.jsx)("h3",{className:"font-black text-slate-800 text-xl mb-2 line-clamp-2 leading-tight group-hover:text-brand-blue transition-colors",children:e.title}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.wordsUsed.slice(0,3).map((e,t)=>(0,i.jsx)("span",{className:"px-2 py-1 bg-slate-50 border border-slate-200 rounded-lg text-xs font-bold text-slate-500 capitalize",children:e},t)),e.wordsUsed.length>3&&(0,i.jsxs)("span",{className:"px-2 py-1 bg-slate-50 border border-slate-200 rounded-lg text-xs font-bold text-slate-400",children:["+",e.wordsUsed.length-3]})]}),(0,i.jsxs)("div",{className:"mt-auto pt-4 border-t border-slate-50 flex justify-between items-center",children:[(0,i.jsxs)("span",{className:"text-xs font-bold text-slate-400 flex items-center gap-1",children:[(0,i.jsx)(eW.Z,{size:14})," Read Again"]}),(0,i.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-50 text-brand-blue flex items-center justify-center group-hover:bg-brand-blue group-hover:text-white transition-colors",children:(0,i.jsx)(E.Z,{size:16,strokeWidth:3})})]})]})]},e.id)})})})]})};var eV=()=>{let[e,t]=(0,o.useState)(!1),[l,s]=(0,o.useState)(a.HOME),[r,n]=(0,o.useState)(null),[d,c]=(0,o.useState)(null),[x,u]=(0,o.useState)(3),[m,h]=(0,o.useState)([]),[b,p]=(0,o.useState)(null),[f,g]=(0,o.useState)([]),[w,j]=(0,o.useState)({});(0,o.useEffect)(()=>{ed.stopAll()},[l,e]);let v=(e,t)=>{c(e),u(t),s(a.CAMERA_QUEST)},y=e=>{h(e),s(a.STORY_MODE_SELECT)},N=async e=>{if(!d||!r)return;s(a.STORY_SETUP);let t=await ea(m,d,r,e),l=await en(t.pages[0].text,"storybook style",t.mainCharacterVisual);l&&(t.pages[0].imageUrl=l);let n={id:Date.now().toString(),title:t.title,themeId:d.id,date:new Date().toISOString(),pages:t.pages,wordsUsed:m.map(e=>e.word),learnedWords:m};p(n),g(e=>[n,...e]),s(a.STORY_READER),k(n,t.mainCharacterVisual)},k=async(e,t)=>{let l=[...e.pages];for(let s=1;s<l.length;s++){let r=await en(l[s].text,"storybook style",t);r&&(l[s].imageUrl=r,p(e=>e?{...e,pages:l}:null),g(t=>t.map(t=>t.id===e.id?{...t,pages:l}:t)))}},C=(e,t)=>{j(l=>{let s=(l[e]||{level:0,lastReviewed:0}).level;return t&&(s=Math.min(5,s+1)),{...l,[e]:{level:s,lastReviewed:Date.now()}}})},S=e=>{p(e),s(a.STORY_READER)},A=e=>{if(!b)return;let t={...b,learnedWords:[...b.learnedWords||[],e],wordsUsed:[...b.wordsUsed||[],e.word]};p(t),g(e=>e.map(e=>e.id===t.id?t:e))};if(!e)return(0,i.jsx)(D,{onStart:()=>t(!0)});if(!r)return(0,i.jsx)(T,{onHome:()=>{},onCalendar:()=>{},onPassport:()=>{},onMemory:()=>{},onVocab:()=>{},isProfileSetup:!0,children:(0,i.jsx)(eA,{onComplete:e=>n(e)})});let z=l===a.CAMERA_QUEST||l===a.STORY_READER||l===a.STORY_QUIZ?"immersive":"standard";return(0,i.jsx)(T,{onHome:()=>s(a.HOME),onCalendar:()=>s(a.CALENDAR),onPassport:()=>s(a.PASSPORT),onMemory:()=>s(a.WORD_MEMORY),onVocab:()=>s(a.VOCAB_LIST),onBack:l!==a.HOME?()=>s(a.HOME):void 0,variant:z,children:(()=>{switch(l){case a.HOME:case a.THEME_SELECTION:return(0,i.jsx)(L,{onSelectTheme:v});case a.CAMERA_QUEST:return d?(0,i.jsx)(ec,{targetCount:x,theme:d,onComplete:y,onBack:()=>s(a.HOME)}):null;case a.STORY_MODE_SELECT:return d?(0,i.jsx)(ev,{theme:d,onSelectMode:N}):null;case a.STORY_SETUP:return(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-8 animate-pulse",children:[(0,i.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFA8"}),(0,i.jsx)("h2",{className:"text-2xl font-bold text-brand-blue",children:"Painting your story..."}),(0,i.jsx)("p",{className:"text-slate-400",children:"Our magic pencils are working!"})]});case a.STORY_READER:return b?(0,i.jsx)(ew,{story:b,kidProfile:r,onWordAdded:A,onFinish:()=>{s(a.STORY_QUIZ)}}):null;case a.STORY_QUIZ:return b&&b.learnedWords?(0,i.jsx)(eU,{words:b.learnedWords,onComplete:()=>s(a.PASSPORT)}):null;case a.PASSPORT:return(0,i.jsx)(eD,{stories:f});case a.VOCAB_LIST:return(0,i.jsx)(eP,{stories:f});case a.WORD_MEMORY:return(0,i.jsx)(eM,{stories:f,mastery:w,onUpdateMastery:C});case a.CALENDAR:return(0,i.jsx)(eF,{stories:f,onSelectStory:S});default:return(0,i.jsx)(L,{onSelectTheme:v})}})()})}}}]);