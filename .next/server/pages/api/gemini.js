"use strict";(()=>{var e={};e.id=351,e.ids=[351],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5613:e=>{e.exports=import("@google/genai")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},6999:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{config:()=>d,default:()=>c,routeModule:()=>u});var i=a(1802),o=a(7153),r=a(6249),s=a(7701),l=e([s]);s=(l.then?(await l)():l)[0];let c=(0,r.l)(s,"default"),d=(0,r.l)(s,"config"),u=new i.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/gemini",pathname:"/api/gemini",bundlePath:"",filename:""},userland:s});n()}catch(e){n(e)}})},7701:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{default:()=>r});var i=a(5613),o=e([i]);i=(o.then?(await o)():o)[0];let s=process.env.GEMINI_API_KEY||process.env.API_KEY;s||console.warn("Warning: GEMINI_API_KEY is not set. API routes will fail until it is provided.");let l=new i.GoogleGenAI({apiKey:s}),c=e=>{let t=(e||"").trim();return t.startsWith("```json")?t=t.replace(/^```json/,"").replace(/```$/,""):t.startsWith("```")&&(t=t.replace(/^```/,"").replace(/```$/,"")),t.trim()};async function r(e,t){if("POST"!==e.method)return t.status(405).send("Only POST allowed");if(!s)return t.status(500).json({error:"Server missing GEMINI_API_KEY"});let a=e.body||{},n=a.action;try{if("generateSpeech"===n){let e=a.text||"",n=await l.models.generateContent({model:"gemini-2.5-flash-preview-tts",contents:[{parts:[{text:(e||"").trim()}]}],config:{responseModalities:["AUDIO"],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:"Kore"}}}}}),i=n?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;return t.status(200).json({audioBase64:i??null})}if("identifyObject"===n){let e=a.imageBase64,n=a.theme,i=n?`
GAME MODE: "${n.label}"
GAME RULE DESCRIPTION: "${n.description||""}"
YOUR ROLE: You are a strict but friendly referee for a children's scavenger hunt.
OUTPUT: Return JSON with word, definition, visualDetail, matchesTheme(boolean), feedback`:"",o=`Analyze this image for a child's learning app. ${i} Return a JSON object with: word, definition, visualDetail, matchesTheme, feedback.`,r=await l.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:"image/jpeg",data:e}},{text:o}]},config:{responseMimeType:"application/json"}}),s=r?.text||"",d=c(s),u=d?JSON.parse(d):{};return t.status(200).json(u)}if("lookupWord"===n){let{word:e,context:n,ageGroup:i}=a,o=`Explain the word "${e}" to a ${i} year old child. Context: "${n}". Return JSON with definition, funFact, emoji, visualDetail.`,r=await l.models.generateContent({model:"gemini-2.5-flash",contents:o,config:{responseMimeType:"application/json"}}),s=JSON.parse(c(r?.text||"{}"));return t.status(200).json(s)}if("generateStory"===n){let{items:e,theme:n,kidProfile:i,userPrompt:o}=a,r=`You are writing a short story for a child. CHILD PROFILE: ${JSON.stringify(i)} THEME: ${n?.label||""} REQUIRED ITEMS: ${e?.map(e=>e.word).join(",")} USER'S IDEA: "${o||""}". Return JSON with title, mainCharacterVisual, pages (array of {pageNumber,text}).`,s=await l.models.generateContent({model:"gemini-2.5-flash",contents:r,config:{responseMimeType:"application/json"}}),d=JSON.parse(c(s?.text||"{}"));return t.status(200).json(d)}if("generateIllustration"===n){let{prompt:e,style:n,characterVisual:i}=a,o=`Kids book illustration, ${n}. ${i}. Action: ${e}. Colorful, cute, high quality. No text, no words, no letters, no labels.`,r=await l.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{text:o}]},config:{imageConfig:{aspectRatio:"1:1"}}});for(let e of r?.candidates?.[0]?.content?.parts||[])if(e.inlineData)return t.status(200).json({imageBase64:`data:${e.inlineData.mimeType};base64,${e.inlineData.data}`});return t.status(200).json({imageBase64:null})}if("generateSticker"===n){let{imageBase64:e,word:n}=a,i=`Create a die-cut sticker of the "${n}" from this image. 1. Isolate the object on a white background. 2. Add a thick white sticker border. 3. Add a drop shadow. 4. Keep original colors. High quality.`,o=await l.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:"image/jpeg",data:e}},{text:i}]},config:{imageConfig:{aspectRatio:"1:1"}}});for(let e of o?.candidates?.[0]?.content?.parts||[])if(e.inlineData)return t.status(200).json({imageBase64:`data:${e.inlineData.mimeType};base64,${e.inlineData.data}`});return t.status(200).json({imageBase64:null})}return t.status(400).json({error:"Unknown action"})}catch(e){return console.error("API error",e),t.status(500).json({error:e?.message||String(e)})}}n()}catch(e){n(e)}})},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=6999);module.exports=a})();